import{a as X,r as c,A as de,j as e,B as T,M as ue,J as O,C as _,l as xe,t as q,K as he}from"./index-Pe1Nv6hH.js";import{u as Q}from"./useQuery-DDON36P9.js";import{u as A}from"./useMutation-uvHqRPk1.js";import{T as J,v as U,w as $}from"./sidebar-BFSPGCEL.js";import{P as fe,T as ge,u as pe,g as je,c as ye,b as be}from"./react-icons.esm-CiMB90YA.js";import{I as N}from"./input-DW-mBlUw.js";import{D as Ce}from"./faceted-filter-BDTVtMjs.js";import{S as ve}from"./index-BmISbovJ.js";import{D as b,T as Ne,a as Se,b as k,c as De,d as Fe,e as P}from"./column-header-Cfszq_dp.js";import{D as ke}from"./pagination-B86K5cVv.js";import{B as Te}from"./badge-T19Q3klL.js";import{g as we}from"./status-variants-Dh7YK7JP.js";import{C as Ve}from"./confirm-dialog-DmDS_GmK.js";import{u as Ie,a as _e,F as Pe,b as g,c as p,d as j,e as C,f as v,g as G}from"./form-DU65aaqX.js";import{D as Me,a as Re,b as qe,c as Ae,d as Ke,e as ze}from"./dialog-DHifiqsD.js";import{T as Le}from"./textarea-D-N386t0.js";import{S as Ee,a as Be,b as He,c as Oe,d as W}from"./select-Dl4KSF7A.js";import{C as Qe,h as Je}from"./role-xokosi1z.js";import{a as Ue,u as $e,d as Ge,b as We}from"./index-emgquIU-.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-D68Ta3NN.js";import"./index-SpxnGYUf.js";import"./index-C8jai3VV.js";import"./command-D9eDedTW.js";import"./index-DGhUbGt9.js";import"./search-DNOmmJ4K.js";import"./popover-CrxLZKyN.js";import"./separator-Bq1fgMtF.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-4GH7Kv3S.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";const Xe=t=>de({username:_().min(1,t("features.system.admin.form.validation.usernameRequired")),nickname:_().min(1,t("features.system.admin.form.validation.nicknameRequired")),mobile:_().regex(/^1[3-9]\d{9}$/,t("features.system.admin.form.validation.mobileInvalid")),introduction:_().optional(),status:O().min(1).max(2),roleIds:ue(O()).min(1,t("features.system.admin.form.validation.rolesRequired"))});function Ye({open:t,onOpenChange:y,admin:i,onSubmit:u,isLoading:d=!1,roles:f=[]}){const{t:a}=X(),o=!!i,S=c.useMemo(()=>Xe(a),[a]),l=Ie({resolver:_e(S),defaultValues:{username:"",nickname:"",mobile:"",introduction:"",status:1,roleIds:[]}});c.useEffect(()=>{t&&(o&&i?l.reset({username:i.username,nickname:i.nickname,mobile:i.mobile,introduction:i.introduction,status:i.status,roleIds:i.roleIds||[]}):l.reset({username:"",nickname:"",mobile:"",introduction:"",status:1,roleIds:[]}))},[t,o,i,l]);const x=r=>{u({...r,id:i?.id,avatar:i?.avatar||"",roleIds:r.roleIds||[]})};return e.jsx(Me,{open:t,onOpenChange:y,children:e.jsxs(Re,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(qe,{className:"shrink-0",children:[e.jsx(Ae,{children:a(o?"features.system.admin.form.editTitle":"features.system.admin.form.createTitle")}),e.jsx(Ke,{children:a(o?"features.system.admin.form.editDescription":"features.system.admin.form.createDescription")})]}),e.jsx(Pe,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(x),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(g,{control:l.control,name:"username",render:({field:r})=>e.jsxs(p,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(j,{className:"text-right",children:a("features.system.admin.username")}),e.jsx(C,{children:e.jsx(N,{placeholder:a("features.system.admin.form.usernamePlaceholder"),...r})}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(g,{control:l.control,name:"nickname",render:({field:r})=>e.jsxs(p,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(j,{className:"text-right",children:a("features.system.admin.nickname")}),e.jsx(C,{children:e.jsx(N,{placeholder:a("features.system.admin.form.nicknamePlaceholder"),...r})}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(g,{control:l.control,name:"mobile",render:({field:r})=>e.jsxs(p,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(j,{className:"text-right",children:a("features.system.admin.mobile")}),e.jsx(C,{children:e.jsx(N,{placeholder:a("features.system.admin.form.mobilePlaceholder"),...r})}),e.jsx(G,{className:"col-start-2",children:a("features.system.admin.form.mobileDescription")}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(g,{control:l.control,name:"status",render:({field:r})=>e.jsxs(p,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(j,{className:"text-right",children:a("features.system.admin.status")}),e.jsxs(Ee,{onValueChange:h=>r.onChange(Number(h)),value:String(r.value),children:[e.jsx(C,{children:e.jsx(Be,{children:e.jsx(He,{placeholder:a("features.system.admin.form.statusPlaceholder")})})}),e.jsxs(Oe,{children:[e.jsx(W,{value:"1",children:a("features.system.admin.enabled")}),e.jsx(W,{value:"2",children:a("features.system.admin.disabled")})]})]}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(g,{control:l.control,name:"roleIds",render:()=>e.jsxs(p,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(j,{className:"text-right mt-2",children:a("features.system.admin.form.roles")}),e.jsxs("div",{className:"space-y-1",children:[f.length===0?e.jsx("div",{className:"text-sm text-muted-foreground pt-2",children:a("features.system.admin.form.noRoles")}):e.jsx("div",{className:"space-y-3 pt-2",children:f.map(r=>e.jsx(g,{control:l.control,name:"roleIds",render:({field:h})=>e.jsxs(p,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(C,{children:e.jsx(Qe,{checked:h.value?.includes(r.id),onCheckedChange:M=>{const w=h.value||[];return M?h.onChange([...w,r.id]):h.onChange(w.filter(R=>R!==r.id))},disabled:d})}),e.jsx(j,{className:"font-normal cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:r.name}),r.desc&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",r.desc,")"]})]})})]},r.id)},r.id))}),e.jsx(G,{className:"text-xs mt-2",children:a("features.system.admin.form.rolesDescription")}),e.jsx(v,{})]})]})}),e.jsx(g,{control:l.control,name:"introduction",render:({field:r})=>e.jsxs(p,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(j,{className:"text-right mt-2",children:a("features.system.admin.introduction")}),e.jsx(C,{children:e.jsx(Le,{placeholder:a("features.system.admin.form.introductionPlaceholder"),className:"resize-none",...r})}),e.jsx(v,{className:"col-start-2"})]})})]})}),e.jsxs(ze,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(T,{type:"button",variant:"outline",onClick:()=>y(!1),disabled:d,children:a("features.system.admin.form.cancel")}),e.jsx(T,{type:"button",disabled:d,onClick:l.handleSubmit(x),children:a(d?"features.system.admin.form.submitting":o?"features.system.admin.form.save":"features.system.admin.form.create")})]})]})})}function Ze(){const{t}=X(),y=xe(),[i,u]=c.useState(null),[d,f]=c.useState(null),[a,o]=c.useState(null),[S,l]=c.useState([]),[x,r]=c.useState({pageIndex:0,pageSize:10}),[h,M]=c.useState([]),[w,R]=c.useState({}),K=c.useMemo(()=>{const s=me=>{const I=S.find(ce=>ce.id===me);return I?.value&&Array.isArray(I.value)?I.value[0]||"":I?.value||""},n=s("username"),D=s("nickname"),F=s("mobile"),oe=s("status");return{current:1,username:n,nickname:D,mobile:F,status:oe,pageNum:x.pageIndex+1,pageSize:x.pageSize}},[S,x]),{data:z,isPending:Y,error:Z}=Q({queryKey:["adminList",K],queryFn:()=>We(K),placeholderData:he}),{data:ee}=Q({queryKey:["roleList"],queryFn:()=>Je()}),L=z?.admins||[],se=z?.total||0,te=ee?.roles||[],ae=Math.ceil(se/x.pageSize),V=c.useMemo(()=>[{accessorKey:"username",header:({column:s})=>e.jsx(b,{column:s,title:t("features.system.admin.username")}),cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.getValue("username")})},{accessorKey:"nickname",header:({column:s})=>e.jsx(b,{column:s,title:t("features.system.admin.nickname")}),cell:({row:s})=>e.jsx("div",{children:s.getValue("nickname")})},{accessorKey:"status",header:({column:s})=>e.jsx(b,{column:s,title:t("features.system.admin.status")}),cell:({row:s})=>{const n=s.getValue("status");return e.jsx(Te,{variant:we(n,"enabledStatus"),children:t(n===1?"features.system.admin.enabled":"features.system.admin.disabled")})}},{accessorKey:"mobile",header:({column:s})=>e.jsx(b,{column:s,title:t("features.system.admin.mobile")}),cell:({row:s})=>e.jsx("div",{children:s.getValue("mobile")})},{accessorKey:"creator",header:({column:s})=>e.jsx(b,{column:s,title:t("features.system.admin.creator")}),cell:({row:s})=>e.jsx("div",{children:s.getValue("creator")})},{accessorKey:"introduction",header:({column:s})=>e.jsx(b,{column:s,title:t("features.system.admin.introduction")}),cell:({row:s})=>{const n=s.getValue("introduction");return e.jsx("div",{className:"max-w-[200px] truncate",title:n,children:n||"-"})}},{id:"actions",header:t("features.system.admin.actions"),cell:({row:s})=>{const n=s.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>{o(n),u("edit")},children:e.jsx(fe,{className:"h-4 w-4"})})}),e.jsx($,{children:t("features.system.admin.edit")})]}),e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>f(n.id),children:e.jsx(ge,{className:"h-4 w-4 text-destructive"})})}),e.jsx($,{children:t("features.system.admin.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[t,u,f]),m=pe({data:L,columns:V,getCoreRowModel:ye(),getSortedRowModel:je(),manualPagination:!0,pageCount:ae,onSortingChange:M,onColumnFiltersChange:l,onColumnVisibilityChange:R,onPaginationChange:r,state:{sorting:h,columnFilters:S,columnVisibility:w,pagination:x}}),E=A({mutationFn:s=>Ue(s),onSuccess:()=>{q.success(t("features.system.admin.createSuccess")),y.invalidateQueries({queryKey:["adminList"]}),u(null),o(null)},onError:()=>{}}),B=A({mutationFn:s=>$e(s),onSuccess:()=>{q.success(t("features.system.admin.updateSuccess")),y.invalidateQueries({queryKey:["adminList"]}),u(null),o(null)},onError:()=>{}}),H=A({mutationFn:s=>Ge(s),onSuccess:()=>{q.success(t("features.system.admin.deleteSuccess")),y.invalidateQueries({queryKey:["adminList"]}),f(null)}}),ne=()=>{o(null),u("create")},re=s=>{i==="create"?E.mutate(s):i==="edit"&&B.mutate(s)},ie=()=>{d&&H.mutate(d)},le=L.find(s=>s.id===d);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(ve,{title:t("features.system.admin.title"),description:t("features.system.admin.description"),children:e.jsxs(T,{onClick:ne,children:[e.jsx(be,{className:"h-4 w-4"}),t("features.system.admin.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(N,{type:"text",placeholder:t("features.system.admin.searchUsername"),value:m.getColumn("username")?.getFilterValue()??"",onChange:s=>m.getColumn("username")?.setFilterValue(s.target.value),className:"h-8 w-[150px]"}),e.jsx(N,{type:"text",placeholder:t("features.system.admin.searchNickname"),value:m.getColumn("nickname")?.getFilterValue()??"",onChange:s=>m.getColumn("nickname")?.setFilterValue(s.target.value),className:"h-8 w-[150px]"}),e.jsx(N,{type:"text",placeholder:t("features.system.admin.searchMobile"),value:m.getColumn("mobile")?.getFilterValue()??"",onChange:s=>m.getColumn("mobile")?.setFilterValue(s.target.value),className:"h-8 w-[150px]"}),e.jsx(Ce,{column:m.getColumn("status"),title:t("features.system.admin.status"),options:[{label:t("features.system.admin.enabled"),value:"1"},{label:t("features.system.admin.disabled"),value:"2"}],single:!0})]})}),e.jsxs(Ne,{children:[e.jsx(Se,{children:m.getHeaderGroups().map(s=>e.jsx(k,{children:s.headers.map(n=>{const D=n.isPlaceholder?null:typeof n.column.columnDef.header=="function"?n.column.columnDef.header(n.getContext()):n.column.columnDef.header,F=n.column.columnDef.meta;return e.jsx(De,{className:F?.thClassName,children:D},n.id)})},s.id))}),e.jsx(Fe,{children:Y?e.jsx(k,{children:e.jsx(P,{colSpan:V.length,className:"h-24 text-center",children:t("features.system.admin.loading")})}):Z?e.jsx(k,{children:e.jsx(P,{colSpan:V.length,className:"h-24 text-center text-destructive",children:t("features.system.admin.loadError")})}):m.getRowModel().rows?.length?m.getRowModel().rows.map(s=>e.jsx(k,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(n=>{const D=typeof n.column.columnDef.cell=="function"?n.column.columnDef.cell(n.getContext()):n.column.columnDef.cell,F=n.column.columnDef.meta;return e.jsx(P,{className:F?.tdClassName,children:D},n.id)})},s.id)):e.jsx(k,{children:e.jsx(P,{colSpan:V.length,className:"h-24 text-center",children:t("features.system.admin.noData")})})})]}),e.jsx(ke,{table:m})]}),e.jsx(Ye,{open:i!==null,onOpenChange:s=>{s||(u(null),o(null))},admin:a,onSubmit:re,isLoading:i==="create"?E.isPending:B.isPending,roles:te}),e.jsx(Ve,{open:d!==null,onOpenChange:s=>{s||f(null)},title:t("features.system.admin.confirmDelete"),desc:t("features.system.admin.confirmDeleteMessage",{username:le?.username}),handleConfirm:ie,destructive:!0,confirmText:t("features.system.admin.delete"),isLoading:H.isPending})]})}const _s=Ze;export{_s as component};
