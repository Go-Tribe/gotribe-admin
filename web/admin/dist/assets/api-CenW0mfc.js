import{a as G,r as n,A as ie,j as e,B as b,C as D,m as _,l as ne,t as V}from"./index-Pe1Nv6hH.js";import{u as ce}from"./useQuery-DDON36P9.js";import{u as A}from"./useMutation-uvHqRPk1.js";import{T as z,v as L,w as K}from"./sidebar-BFSPGCEL.js";import{P as me,T as de,u as ue,g as pe,c as he,b as ge}from"./react-icons.esm-CiMB90YA.js";import{I as C}from"./input-DW-mBlUw.js";import{D as xe}from"./faceted-filter-BDTVtMjs.js";import{S as fe}from"./index-BmISbovJ.js";import{D as y,T as ye,a as je,b as j,c as be,d as Ce,e as v}from"./column-header-Cfszq_dp.js";import{D as Te}from"./pagination-B86K5cVv.js";import{B as Se}from"./badge-T19Q3klL.js";import{C as Ne}from"./confirm-dialog-DmDS_GmK.js";import{u as De,a as ve,F as Fe,b as F,c as P,d as w,e as E,f as k,g as B}from"./form-DU65aaqX.js";import{D as Pe,a as we,b as Ee,c as ke,d as _e,e as Me}from"./dialog-DHifiqsD.js";import{T as Ve}from"./textarea-D-N386t0.js";import{S as Ae,a as He,b as Ie,c as Oe,d as Re}from"./select-Dl4KSF7A.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-D68Ta3NN.js";import"./index-SpxnGYUf.js";import"./index-C8jai3VV.js";import"./command-D9eDedTW.js";import"./index-DGhUbGt9.js";import"./search-DNOmmJ4K.js";import"./popover-CrxLZKyN.js";import"./separator-Bq1fgMtF.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-4GH7Kv3S.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";const qe=s=>ie({method:D().min(1,s("features.system.api.form.validation.methodRequired")),path:D().min(1,s("features.system.api.form.validation.pathRequired")),category:D().min(1,s("features.system.api.form.validation.categoryRequired")),desc:D().optional()}),ze=["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"];function Le({open:s,onOpenChange:g,api:i,onSubmit:d,isLoading:m=!1}){const{t:r}=G(),u=!!i,p=n.useMemo(()=>qe(r),[r]),l=De({resolver:ve(p),defaultValues:{method:"GET",path:"",category:"",desc:""}});n.useEffect(()=>{s&&(u&&i?l.reset({method:i.method,path:i.path,category:i.category,desc:i.desc||""}):l.reset({method:"GET",path:"",category:"",desc:""}))},[s,u,i,l]);const T=o=>{d({...o,id:i?.id})};return e.jsx(Pe,{open:s,onOpenChange:g,children:e.jsxs(we,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(Ee,{className:"shrink-0",children:[e.jsx(ke,{children:r(u?"features.system.api.form.editTitle":"features.system.api.form.createTitle")}),e.jsx(_e,{children:r(u?"features.system.api.form.editDescription":"features.system.api.form.createDescription")})]}),e.jsx(Fe,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(T),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(F,{control:l.control,name:"method",render:({field:o})=>e.jsxs(P,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(w,{className:"text-right",children:r("features.system.api.method")}),e.jsxs(Ae,{onValueChange:o.onChange,value:o.value,children:[e.jsx(E,{children:e.jsx(He,{children:e.jsx(Ie,{placeholder:r("features.system.api.form.methodPlaceholder")})})}),e.jsx(Oe,{children:ze.map(f=>e.jsx(Re,{value:f,children:f},f))})]}),e.jsx(k,{className:"col-start-2"})]})}),e.jsx(F,{control:l.control,name:"path",render:({field:o})=>e.jsxs(P,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(w,{className:"text-right",children:r("features.system.api.path")}),e.jsx(E,{children:e.jsx(C,{placeholder:r("features.system.api.form.pathPlaceholder"),...o})}),e.jsx(B,{className:"col-start-2",children:r("features.system.api.form.pathDescription")}),e.jsx(k,{className:"col-start-2"})]})}),e.jsx(F,{control:l.control,name:"category",render:({field:o})=>e.jsxs(P,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(w,{className:"text-right",children:r("features.system.api.category")}),e.jsx(E,{children:e.jsx(C,{placeholder:r("features.system.api.form.categoryPlaceholder"),...o})}),e.jsx(B,{className:"col-start-2",children:r("features.system.api.form.categoryDescription")}),e.jsx(k,{className:"col-start-2"})]})}),e.jsx(F,{control:l.control,name:"desc",render:({field:o})=>e.jsxs(P,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(w,{className:"text-right mt-2",children:r("features.system.api.desc")}),e.jsx(E,{children:e.jsx(Ve,{placeholder:r("features.system.api.form.descPlaceholder"),className:"resize-none",...o})}),e.jsx(k,{className:"col-start-2"})]})})]})}),e.jsxs(Me,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>g(!1),disabled:m,children:r("features.system.api.form.cancel")}),e.jsx(b,{type:"button",disabled:m,onClick:l.handleSubmit(T),children:r(m?"features.system.api.form.submitting":u?"features.system.api.form.save":"features.system.api.form.create")})]})]})})}const Ke=async s=>_.get("/api/api/list",{params:s});async function Be(s){return _.post("/api/api/create",s)}async function Ge(s){return _.patch(`/api/api/update/${s.id}`,s)}async function Qe(s){return _.delete("/api/api/menu/delete/batch",{data:{apiIds:[s]}})}const Ue=["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"];function $e(){const{t:s}=G(),g=ne(),[i,d]=n.useState(null),[m,r]=n.useState(null),[u,p]=n.useState(null),[l,T]=n.useState([]),[o,f]=n.useState({pageIndex:0,pageSize:10}),[Q,U]=n.useState([]),[$,J]=n.useState({}),H=n.useMemo(()=>{const t=oe=>{const N=l.find(le=>le.id===oe);return N?.value&&Array.isArray(N.value)?N.value[0]||"":N?.value||""},a=t("path"),x=t("category"),h=t("method"),re=t("creator");return{current:1,path:a,category:x,method:h,creator:re,pageNum:o.pageIndex+1,pageSize:o.pageSize}},[l,o]),{data:M,isLoading:W,error:X}=ce({queryKey:["apiList",H],queryFn:()=>Ke(H)}),I=n.useMemo(()=>M?.apis||[],[M?.apis]),Y=M?.total||0,Z=Math.ceil(Y/o.pageSize),S=n.useMemo(()=>[{accessorKey:"method",header:({column:t})=>e.jsx(y,{column:t,title:s("features.system.api.method")}),cell:({row:t})=>{const a=t.getValue("method"),h={GET:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",POST:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",PUT:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",PATCH:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",DELETE:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}[a]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300";return e.jsx(Se,{className:h,children:a})}},{accessorKey:"path",header:({column:t})=>e.jsx(y,{column:t,title:s("features.system.api.path")}),cell:({row:t})=>e.jsx("div",{className:"font-mono text-sm",children:t.getValue("path")})},{accessorKey:"category",header:({column:t})=>e.jsx(y,{column:t,title:s("features.system.api.category")}),cell:({row:t})=>e.jsx("div",{children:t.getValue("category")})},{accessorKey:"desc",header:({column:t})=>e.jsx(y,{column:t,title:s("features.system.api.desc")}),cell:({row:t})=>{const a=t.getValue("desc");return e.jsx("div",{className:"max-w-[200px] truncate",title:a,children:a||"-"})}},{accessorKey:"creator",header:({column:t})=>e.jsx(y,{column:t,title:s("features.system.api.creator")}),cell:({row:t})=>e.jsx("div",{children:t.getValue("creator")})},{id:"actions",header:s("features.system.api.actions"),cell:({row:t})=>{const a=t.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(z,{children:[e.jsx(L,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>{p(a),d("edit")},children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsx(K,{children:s("features.system.api.edit")})]}),e.jsxs(z,{children:[e.jsx(L,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>r(a.id),children:e.jsx(de,{className:"h-4 w-4 text-destructive"})})}),e.jsx(K,{children:s("features.system.api.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[s]),c=ue({data:I,columns:S,getCoreRowModel:he(),getSortedRowModel:pe(),manualPagination:!0,pageCount:Z,onSortingChange:U,onColumnFiltersChange:T,onColumnVisibilityChange:J,onPaginationChange:f,state:{sorting:Q,columnFilters:l,columnVisibility:$,pagination:o}}),O=A({mutationFn:t=>Be(t),onSuccess:()=>{V.success(s("features.system.api.createSuccess")),g.invalidateQueries({queryKey:["apiList"]}),d(null),p(null)},onError:()=>{}}),R=A({mutationFn:t=>Ge(t),onSuccess:()=>{V.success(s("features.system.api.updateSuccess")),g.invalidateQueries({queryKey:["apiList"]}),d(null),p(null)},onError:()=>{}}),q=A({mutationFn:t=>Qe(t),onSuccess:()=>{V.success(s("features.system.api.deleteSuccess")),g.invalidateQueries({queryKey:["apiList"]}),r(null)}}),ee=()=>{p(null),d("create")},te=t=>{i==="create"?O.mutate(t):i==="edit"&&R.mutate(t)},se=()=>{m&&q.mutate(m)},ae=I.find(t=>t.id===m);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(fe,{title:s("features.system.api.title"),description:s("features.system.api.description"),children:e.jsxs(b,{onClick:ee,children:[e.jsx(ge,{className:"h-4 w-4"}),s("features.system.api.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(C,{type:"text",placeholder:s("features.system.api.searchPath"),value:c.getColumn("path")?.getFilterValue()??"",onChange:t=>c.getColumn("path")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"}),e.jsx(C,{type:"text",placeholder:s("features.system.api.searchCategory"),value:c.getColumn("category")?.getFilterValue()??"",onChange:t=>c.getColumn("category")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"}),e.jsx(xe,{column:c.getColumn("method"),title:s("features.system.api.method"),options:Ue.map(t=>({label:t,value:t})),single:!0}),e.jsx(C,{type:"text",placeholder:s("features.system.api.searchCreator"),value:c.getColumn("creator")?.getFilterValue()??"",onChange:t=>c.getColumn("creator")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"})]})}),e.jsxs(ye,{children:[e.jsx(je,{children:c.getHeaderGroups().map(t=>e.jsx(j,{children:t.headers.map(a=>{const x=a.isPlaceholder?null:typeof a.column.columnDef.header=="function"?a.column.columnDef.header(a.getContext()):a.column.columnDef.header,h=a.column.columnDef.meta;return e.jsx(be,{className:h?.thClassName,children:x},a.id)})},t.id))}),e.jsx(Ce,{children:W?e.jsx(j,{children:e.jsx(v,{colSpan:S.length,className:"h-24 text-center",children:s("features.system.api.loading")})}):X?e.jsx(j,{children:e.jsx(v,{colSpan:S.length,className:"h-24 text-center text-destructive",children:s("features.system.api.loadError")})}):c.getRowModel().rows?.length?c.getRowModel().rows.map(t=>e.jsx(j,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(a=>{const x=typeof a.column.columnDef.cell=="function"?a.column.columnDef.cell(a.getContext()):a.column.columnDef.cell,h=a.column.columnDef.meta;return e.jsx(v,{className:h?.tdClassName,children:x},a.id)})},t.id)):e.jsx(j,{children:e.jsx(v,{colSpan:S.length,className:"h-24 text-center",children:s("features.system.api.noData")})})})]}),e.jsx(Te,{table:c})]}),e.jsx(Le,{open:i!==null,onOpenChange:t=>{t||(d(null),p(null))},api:u,onSubmit:te,isLoading:i==="create"?O.isPending:R.isPending}),e.jsx(Ne,{open:m!==null,onOpenChange:t=>{t||r(null)},title:s("features.system.api.confirmDelete"),desc:s("features.system.api.confirmDeleteMessage",{path:ae?.path}),handleConfirm:se,destructive:!0,confirmText:s("features.system.api.delete"),isLoading:q.isPending})]})}const Nt=$e;export{Nt as component};
