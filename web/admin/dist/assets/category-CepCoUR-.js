import{a as se,r as i,A as de,j as e,f as ue,B as V,J as q,C as E,l as me,t as z}from"./index-Pe1Nv6hH.js";import{u as he}from"./useQuery-DDON36P9.js";import{u as H}from"./useMutation-uvHqRPk1.js";import{P as ge,T as pe,u as fe,d as xe,g as je,c as ye,b as be}from"./react-icons.esm-CiMB90YA.js";import{T as J,v as G,w as X}from"./sidebar-BFSPGCEL.js";import{I as P}from"./input-DW-mBlUw.js";import{D as Ce}from"./faceted-filter-BDTVtMjs.js";import{S as Ne}from"./index-BmISbovJ.js";import{D as j,T as De,a as Se,b as F,c as ve,d as Ie,e as M}from"./column-header-Cfszq_dp.js";import{B as we}from"./badge-T19Q3klL.js";import{g as Te}from"./status-variants-Dh7YK7JP.js";import{C as Fe}from"./confirm-dialog-DmDS_GmK.js";import{u as Ve,a as _e,F as ke,b as y,c as b,d as C,e as N,f as D,g as Ee}from"./form-DU65aaqX.js";import{D as Me,a as Re,b as Pe,c as Ke,d as Be,e as Oe}from"./dialog-DHifiqsD.js";import{T as Le}from"./textarea-D-N386t0.js";import{S as Y,a as Z,b as ee,c as te,d as R}from"./select-Dl4KSF7A.js";import{R as qe}from"./index-B79q5nRO.js";import{I as ze}from"./image-D4KB7jNL.js";import{c as He,u as Qe,b as $e,g as Ue}from"./category-DZrOWX3M.js";import{C as We}from"./index-4GH7Kv3S.js";import{C as Ae}from"./chevron-right-COcvBQ44.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-D68Ta3NN.js";import"./index-SpxnGYUf.js";import"./index-C8jai3VV.js";import"./command-D9eDedTW.js";import"./index-DGhUbGt9.js";import"./search-DNOmmJ4K.js";import"./popover-CrxLZKyN.js";import"./separator-Bq1fgMtF.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-BDzuQ5ZL.js";import"./scroll-area-BCr0FWtA.js";import"./resource-u0oZDgOZ.js";import"./loader-circle-DjNfctPA.js";import"./upload-CE8x_1SM.js";import"./chevron-left-BrCT33MH.js";const Je=r=>de({title:E().min(1,r("features.content.category.form.validation.titleRequired")),description:E().optional(),icon:E().optional(),path:E().optional(),sort:q().int().min(1).max(99),hidden:q().min(1).max(2),parentId:q().int().min(0)});function re(r,g=0,a=[]){for(const u of r)a.push({id:u.id,title:"  ".repeat(g)+u.title}),u.children?.length&&re(u.children,g+1,a);return a}function Ge({open:r,onOpenChange:g,category:a,categoryTree:u=[],onSubmit:f,isLoading:x=!1}){const{t:o}=se(),m=!!a,[I,S]=i.useState(""),[K,w]=i.useState(!1),B=i.useMemo(()=>Je(o),[o]),O=i.useMemo(()=>{const n=re(u);return m&&a?n.filter(c=>c.id!==a.id):n},[u,m,a]),d=Ve({resolver:_e(B),defaultValues:{title:"",description:"",icon:"",path:"",sort:1,hidden:1,parentId:0}});i.useEffect(()=>{if(r)if(m&&a){const n=Math.max(1,Math.min(99,a.sort||1)),c=a.parentID??a.parentId,h=typeof c=="number"?c:Number(c)||0;d.reset({title:a.title,description:a.description||"",icon:a.icon||"",path:a.path??a.route??"",sort:n,hidden:a.hidden||1,parentId:h}),setTimeout(()=>S(String(n)),0)}else d.reset({title:"",description:"",icon:"",path:"",sort:1,hidden:1,parentId:0}),setTimeout(()=>S("1"),0)},[r,m,a,d]);const _=n=>{f({title:n.title,description:n.description,icon:n.icon,path:n.path??"",route:n.path??"",sort:n.sort,hidden:n.hidden,parentId:n.parentId,id:a?.id,categoryID:a?.categoryID})};return e.jsxs(Me,{open:r,onOpenChange:g,children:[e.jsxs(Re,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(Pe,{className:"shrink-0",children:[e.jsx(Ke,{children:o(m?"features.content.category.form.editTitle":"features.content.category.form.createTitle")}),e.jsx(Be,{children:o(m?"features.content.category.form.editDescription":"features.content.category.form.createDescription")})]}),e.jsx(ke,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(_),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(y,{control:d.control,name:"title",render:({field:n})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(C,{className:"text-right",children:o("features.content.category.form.title")}),e.jsx(N,{children:e.jsx(P,{placeholder:o("features.content.category.form.titlePlaceholder"),...n})}),e.jsx(D,{className:"col-start-2"})]})}),e.jsx(y,{control:d.control,name:"parentId",render:({field:n})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(C,{className:"text-right",children:o("features.content.category.form.parent")}),e.jsxs(Y,{onValueChange:c=>n.onChange(Number(c)),value:String(n.value),children:[e.jsx(N,{children:e.jsx(Z,{children:e.jsx(ee,{placeholder:o("features.content.category.form.parentPlaceholder")})})}),e.jsxs(te,{children:[e.jsx(R,{value:"0",children:o("features.content.category.form.rootCategory")}),O.map(c=>e.jsx(R,{value:String(c.id),children:c.title},c.id))]})]}),e.jsx(D,{className:"col-start-2"})]})}),e.jsx(y,{control:d.control,name:"description",render:({field:n})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(C,{className:"text-right pt-2",children:o("features.content.category.form.description")}),e.jsx(N,{children:e.jsx(Le,{placeholder:o("features.content.category.form.descriptionPlaceholder"),className:"resize-none",...n})}),e.jsx(D,{className:"col-start-2"})]})}),e.jsx(y,{control:d.control,name:"icon",render:({field:n})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(C,{className:"text-right",children:o("features.content.category.form.icon")}),e.jsx(N,{children:e.jsx("button",{type:"button",onClick:()=>w(!0),className:ue("flex flex-col items-center justify-center h-20 w-20 rounded-lg border-2 border-dashed border-border bg-muted/30 overflow-hidden transition-all shrink-0","cursor-pointer hover:border-primary/50 hover:bg-muted/50"),children:n.value?e.jsx("img",{src:n.value,alt:"",className:"h-full w-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{className:"h-8 w-8 text-muted-foreground mb-1"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:o("features.content.category.form.selectIcon")})]})})}),e.jsx(D,{className:"col-start-2"})]})}),e.jsx(y,{control:d.control,name:"path",render:({field:n})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(C,{className:"text-right",children:o("features.content.category.form.path")}),e.jsx(N,{children:e.jsx(P,{placeholder:o("features.content.category.form.pathPlaceholder"),...n})}),e.jsx(D,{className:"col-start-2"})]})}),e.jsx(y,{control:d.control,name:"sort",render:({field:n})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(C,{className:"text-right",children:o("features.content.category.form.sort")}),e.jsx(N,{children:e.jsx(P,{type:"number",placeholder:o("features.content.category.form.sortPlaceholder"),value:I,onChange:c=>{const h=c.target.value;S(h)},onBlur:()=>{const c=Number(I);let h=1;!isNaN(c)&&I!==""&&(c>99?h=99:c<1?h=1:h=c),S(String(h)),n.onChange(h),n.onBlur()},min:1,max:99})}),e.jsx(Ee,{className:"col-start-2",children:o("features.content.category.form.sortDescription")}),e.jsx(D,{className:"col-start-2"})]})}),e.jsx(y,{control:d.control,name:"hidden",render:({field:n})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(C,{className:"text-right",children:o("features.content.category.form.hidden")}),e.jsxs(Y,{onValueChange:c=>n.onChange(Number(c)),value:String(n.value),children:[e.jsx(N,{children:e.jsx(Z,{children:e.jsx(ee,{placeholder:o("features.content.category.form.hiddenPlaceholder")})})}),e.jsxs(te,{children:[e.jsx(R,{value:"1",children:o("features.content.category.hiddenStatus.show")}),e.jsx(R,{value:"2",children:o("features.content.category.hiddenStatus.hidden")})]})]}),e.jsx(D,{className:"col-start-2"})]})})]})}),e.jsxs(Oe,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(V,{type:"button",variant:"outline",onClick:()=>g(!1),disabled:x,children:o("features.content.category.form.cancel")}),e.jsx(V,{type:"button",disabled:x,onClick:d.handleSubmit(_),children:o(x?"features.content.category.form.submitting":m?"features.content.category.form.save":"features.content.category.form.create")})]})]}),e.jsx(qe,{open:K,onOpenChange:w,onSelect:n=>{d.setValue("icon",n.url,{shouldValidate:!0}),w(!1)},type:1,title:o("features.content.category.form.selectIconDialogTitle"),description:o("features.content.category.form.selectIconDialogDesc")})]})}function Xe(){"use no memo";const{t:r}=se(),g=me(),[a,u]=i.useState(null),[f,x]=i.useState(null),[o,m]=i.useState(null),[I,S]=i.useState([]),[K,w]=i.useState([]),[B,O]=i.useState({}),[d,_]=i.useState({}),{data:n,isLoading:c,error:h}=he({queryKey:["categoryList"],queryFn:()=>Ue()}),T=n?.categoryTree||[],L=i.useCallback(t=>{const s=[];return t.forEach(l=>{s.push(l),l.children?.length&&s.push(...L(l.children))}),s},[]),ne=i.useMemo(()=>L(T),[T,L]),Q=i.useCallback((t,s)=>{for(const l of t){if(l.categoryID===s)return l;if(l.children?.length){const p=Q(l.children,s);if(p)return p}}return null},[]),$=i.useCallback(t=>{const s=[t.categoryID];return t.children?.length&&t.children.forEach(l=>s.push(...$(l))),s},[]),k=i.useMemo(()=>[{accessorKey:"categoryID",header:({column:t})=>e.jsx(j,{column:t,title:r("features.content.category.columns.id")}),cell:({row:t})=>e.jsx("div",{className:"font-mono text-muted-foreground",children:t.getValue("categoryID")})},{accessorKey:"title",header:({column:t})=>e.jsx(j,{column:t,title:r("features.content.category.columns.title")}),cell:({row:t})=>{const s=t.getCanExpand(),l=t.getIsExpanded(),p=t.depth;return e.jsxs("div",{className:"flex items-center gap-2 font-medium",style:{paddingLeft:`${p*20}px`},children:[s&&e.jsx("button",{type:"button",onClick:ie=>{ie.stopPropagation(),t.toggleExpanded()},className:"flex items-center justify-center w-4 h-4 hover:bg-accent rounded",children:l?e.jsx(We,{className:"h-4 w-4"}):e.jsx(Ae,{className:"h-4 w-4"})}),!s&&e.jsx("div",{className:"w-4"}),e.jsx("span",{children:t.getValue("title")})]})}},{accessorKey:"description",header:({column:t})=>e.jsx(j,{column:t,title:r("features.content.category.columns.description")}),cell:({row:t})=>{const s=t.getValue("description");return e.jsx("div",{className:"max-w-[200px] truncate",title:s,children:s||"-"})}},{accessorKey:"icon",header:({column:t})=>e.jsx(j,{column:t,title:r("features.content.category.columns.icon")}),cell:({row:t})=>{const s=t.getValue("icon");return s?/^https?:\/\//i.test(s)||s.startsWith("/")?e.jsx("img",{src:s,alt:"",className:"h-8 w-8 object-cover rounded border border-border",title:s}):e.jsx("div",{className:"max-w-[100px] truncate",title:s,children:s}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{id:"path",accessorFn:t=>t.path??t.route,header:({column:t})=>e.jsx(j,{column:t,title:r("features.content.category.columns.path")}),cell:({row:t})=>{const s=t.original.path??t.original.route;if(!s)return e.jsx("span",{className:"text-muted-foreground",children:"-"});const l=/^https?:\/\//i.test(s)?s:`${window.location.origin}${s.startsWith("/")?"":"/"}${s}`;return e.jsx("a",{href:l,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline max-w-[150px] truncate inline-block",title:l,children:s})}},{accessorKey:"sort",header:({column:t})=>e.jsx(j,{column:t,title:r("features.content.category.columns.sort")}),cell:({row:t})=>e.jsx("div",{children:t.getValue("sort")})},{accessorKey:"hidden",header:({column:t})=>e.jsx(j,{column:t,title:r("features.content.category.columns.hidden")}),cell:({row:t})=>{const s=t.getValue("hidden");return e.jsx(we,{variant:Te(s,"visibility"),children:r(s===1?"features.content.category.hiddenStatus.show":"features.content.category.hiddenStatus.hidden")})}},{id:"actions",header:r("features.content.category.columns.actions"),cell:({row:t})=>{const s=t.original;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(J,{children:[e.jsx(G,{asChild:!0,children:e.jsx(V,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{m(s),u("edit")},children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsx(X,{children:r("features.content.category.actions.edit")})]}),e.jsxs(J,{children:[e.jsx(G,{asChild:!0,children:e.jsx(V,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>s.categoryID&&x(s.categoryID),children:e.jsx(pe,{className:"h-4 w-4 text-destructive"})})}),e.jsx(X,{children:r("features.content.category.actions.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[r]),v=fe({data:T,columns:k,getCoreRowModel:ye(),getSortedRowModel:je(),getExpandedRowModel:xe(),getSubRows:t=>t.children,onExpandedChange:_,onSortingChange:w,onColumnFiltersChange:S,onColumnVisibilityChange:O,state:{expanded:d,sorting:K,columnFilters:I,columnVisibility:B}}),U=H({mutationFn:t=>He(t),onSuccess:()=>{z.success(r("features.content.category.createSuccess")),g.invalidateQueries({queryKey:["categoryList"]}),u(null),m(null)},onError:()=>{}}),W=H({mutationFn:t=>Qe(t.categoryID,t),onSuccess:()=>{z.success(r("features.content.category.updateSuccess")),g.invalidateQueries({queryKey:["categoryList"]}),u(null),m(null)},onError:()=>{}}),A=H({mutationFn:t=>$e(t),onSuccess:()=>{z.success(r("features.content.category.deleteSuccess")),g.invalidateQueries({queryKey:["categoryList"]}),x(null)},onError:()=>{}}),oe=()=>{m(null),u("create")},ae=t=>{a==="create"?U.mutate(t):a==="edit"&&t.categoryID&&W.mutate({categoryID:t.categoryID,...t})},ce=()=>{if(f==null)return;const t=Q(T,f),s=t?$(t):[f];A.mutate({categoryIds:s.join(",")})},le=ne.find(t=>t.categoryID===f);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(Ne,{title:r("features.content.category.title"),description:r("features.content.category.description"),children:e.jsxs(V,{onClick:oe,children:[e.jsx(be,{className:"h-4 w-4"}),r("features.content.category.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(P,{type:"text",placeholder:r("features.content.category.search.title"),value:v.getColumn("title")?.getFilterValue()??"",onChange:t=>v.getColumn("title")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"}),e.jsx(Ce,{column:v.getColumn("hidden"),title:r("features.content.category.filter.hidden"),options:[{label:r("features.content.category.hiddenStatus.show"),value:"1"},{label:r("features.content.category.hiddenStatus.hidden"),value:"2"}],single:!0})]})}),e.jsxs(De,{children:[e.jsx(Se,{children:v.getHeaderGroups().map(t=>e.jsx(F,{children:t.headers.map(s=>{const l=s.isPlaceholder?null:typeof s.column.columnDef.header=="function"?s.column.columnDef.header(s.getContext()):s.column.columnDef.header,p=s.column.columnDef.meta;return e.jsx(ve,{className:p?.thClassName,children:l},s.id)})},t.id))}),e.jsx(Ie,{children:c?e.jsx(F,{children:e.jsx(M,{colSpan:k.length,className:"h-24 text-center",children:r("features.content.category.loading")})}):h?e.jsx(F,{children:e.jsx(M,{colSpan:k.length,className:"h-24 text-center text-destructive",children:r("features.content.category.loadError")})}):v.getRowModel().rows?.length?v.getRowModel().rows.map(t=>e.jsx(F,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(s=>{const l=typeof s.column.columnDef.cell=="function"?s.column.columnDef.cell(s.getContext()):s.column.columnDef.cell,p=s.column.columnDef.meta;return e.jsx(M,{className:p?.tdClassName,children:l},s.id)})},t.id)):e.jsx(F,{children:e.jsx(M,{colSpan:k.length,className:"h-24 text-center",children:r("features.content.category.noData")})})})]})]}),e.jsx(Ge,{open:a!==null,onOpenChange:t=>{t||(u(null),m(null))},category:o,categoryTree:T,onSubmit:ae,isLoading:a==="create"?U.isPending:W.isPending}),e.jsx(Fe,{open:f!==null,onOpenChange:t=>{t||x(null)},title:r("features.content.category.confirmDelete"),desc:r("features.content.category.confirmDeleteMessage",{title:le?.title??""}),handleConfirm:ce,destructive:!0,confirmText:r("features.content.category.actions.delete"),isLoading:A.isPending})]})}const Rt=Xe;export{Rt as component};
