const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CAgIQmcy.js","assets/index-Pe1Nv6hH.js","assets/index-BoEWxluP.css","assets/slate-markdown-C4u7coMV.js","assets/dropdown-menu-CbU9G1H2.js","assets/index-SpxnGYUf.js","assets/createLucideIcon-BU8aI1FG.js","assets/index-4GH7Kv3S.js","assets/index-C8jai3VV.js","assets/index-D68Ta3NN.js","assets/index-BDzuQ5ZL.js","assets/chevron-right-COcvBQ44.js","assets/dialog-DHifiqsD.js","assets/input-DW-mBlUw.js","assets/form-DU65aaqX.js","assets/index-DGhUbGt9.js","assets/unlink-DFLq-BTp.js","assets/image-D4KB7jNL.js","assets/minus-BV34uZJO.js"])))=>i.map(i=>d[i]);
import{a as ee,r as l,A as de,j as e,f as pe,B as w,C as y,ai as fe,m as F,l as he,t as j,K as xe}from"./index-Pe1Nv6hH.js";import{u as K}from"./useQuery-DDON36P9.js";import{u as B}from"./useMutation-uvHqRPk1.js";import{P as ge,T as je,u as De,g as be,c as ye,b as Ce}from"./react-icons.esm-CiMB90YA.js";import{S as Ne}from"./index-BmISbovJ.js";import{I as te}from"./input-DW-mBlUw.js";import{S as oe,a as ne,b as se,c as re,d as k}from"./select-Dl4KSF7A.js";import{D as V,T as _e,a as ve,b as C,c as Ie,d as Se,e as R}from"./column-header-Cfszq_dp.js";import{D as we}from"./pagination-B86K5cVv.js";import{T as W,v as X,w as Y}from"./sidebar-BFSPGCEL.js";import{C as Fe}from"./confirm-dialog-DmDS_GmK.js";import{u as Te,a as Ee,F as Pe,b as N,c as _,d as v,e as I,f as S}from"./form-DU65aaqX.js";import{D as Ve,a as Re,b as ke,c as Me,d as qe,e as ze}from"./dialog-DHifiqsD.js";import{T as Z}from"./textarea-D-N386t0.js";import{E as Le}from"./editor-error-boundary-8LYWESTP.js";import{R as Ke}from"./index-B79q5nRO.js";import{I as Be}from"./image-D4KB7jNL.js";import{g as Oe}from"./project-_pxXE-N5.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-D68Ta3NN.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./index-DGhUbGt9.js";import"./scroll-area-BCr0FWtA.js";import"./resource-u0oZDgOZ.js";import"./loader-circle-DjNfctPA.js";import"./upload-CE8x_1SM.js";import"./chevron-left-BrCT33MH.js";const Ae=l.lazy(()=>fe(()=>import("./index-CAgIQmcy.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])).then(o=>({default:o.SlateEditor}))),He=o=>de({title:y().min(1,o("features.content.column.form.validation.titleRequired")),info:y().min(1,o("features.content.column.form.validation.infoRequired")),description:y().min(1,o("features.content.column.form.validation.descriptionRequired")),projectID:y(),icon:y().min(1,o("features.content.column.form.validation.iconRequired"))});function Qe({open:o,onOpenChange:m,onSubmit:u,onSubmitUpdate:D,isLoading:T=!1,projectList:x,editColumn:a}){const{t:s}=ee(),i=!!a,[M,h]=l.useState(!1),q=l.useMemo(()=>He(s),[s]),c=Te({resolver:Ee(q),defaultValues:{title:"",info:"",description:"",projectID:"",icon:""}});l.useEffect(()=>{if(o)if(a){const n=(a.projectID??"").trim();c.reset({title:a.title??"",info:a.info??"",description:a.description??"",projectID:n,icon:a.icon??""})}else c.reset({title:"",info:"",description:"",projectID:"",icon:""})},[o,a,c]);function z(n){const p=n.projectID==="__empty__"||!n.projectID?.trim()?"":n.projectID.trim();i&&a?D?.(a.columnID,{title:n.title,info:n.info??"",description:n.description??"",icon:n.icon??"",projectID:p}):u?.({title:n.title,description:n.description??"",info:n.info??"",projectID:p,icon:n.icon??""})}return e.jsxs(Ve,{open:o,onOpenChange:m,children:[e.jsxs(Re,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(ke,{className:"shrink-0",children:[e.jsx(Me,{children:s(i?"features.content.column.form.editTitle":"features.content.column.form.createTitle")}),e.jsx(qe,{children:s(i?"features.content.column.form.editDescription":"features.content.column.form.createDescription")})]}),e.jsx(Pe,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(z),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(N,{control:c.control,name:"title",render:({field:n})=>e.jsxs(_,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(v,{className:"text-right",children:s("features.content.column.form.title")}),e.jsx(I,{children:e.jsx(te,{placeholder:s("features.content.column.form.titlePlaceholder"),...n})}),e.jsx(S,{className:"col-start-2"})]})}),e.jsx(N,{control:c.control,name:"description",render:({field:n})=>e.jsxs(_,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(v,{className:"text-right pt-2",children:s("features.content.column.form.description")}),e.jsx(I,{children:e.jsx(Z,{placeholder:s("features.content.column.form.descriptionPlaceholder"),className:"resize-none",...n})}),e.jsx(S,{className:"col-start-2"})]})}),e.jsx(N,{control:c.control,name:"projectID",render:({field:n})=>{const p=(n.value??"").trim(),E=p||"__empty__";return e.jsxs(_,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(v,{className:"text-right",children:s("features.content.column.form.project")}),e.jsxs(oe,{onValueChange:d=>n.onChange(d==="__empty__"?"":d),value:E,children:[e.jsx(I,{children:e.jsx(ne,{children:e.jsx(se,{placeholder:s("features.content.column.form.projectPlaceholder")})})}),e.jsxs(re,{children:[e.jsx(k,{value:"__empty__",children:s("features.content.column.form.projectPlaceholder")}),x.filter(d=>(d.projectID??"").trim()!=="").map(d=>e.jsx(k,{value:(d.projectID??"").trim(),children:d.title},d.projectID))]})]},`project-${a?.columnID??"create"}-${x.length}-${E}`),e.jsx(S,{className:"col-start-2"})]})}}),e.jsx(N,{control:c.control,name:"icon",render:({field:n})=>e.jsxs(_,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(v,{className:"text-right",children:s("features.content.column.form.icon")}),e.jsx(I,{children:e.jsx("button",{type:"button",disabled:i,onClick:()=>!i&&h(!0),className:pe("flex flex-col items-center justify-center h-20 w-20 rounded-lg border-2 border-dashed border-border bg-muted/30 overflow-hidden transition-all shrink-0",!i&&"cursor-pointer hover:border-primary/50 hover:bg-muted/50",i&&"cursor-default border-solid"),children:n.value?e.jsx("img",{src:n.value,alt:"",className:"h-full w-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{className:"h-8 w-8 text-muted-foreground mb-1"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s("features.content.column.form.selectIcon")})]})})}),e.jsx(S,{className:"col-start-2"})]})}),e.jsx(N,{control:c.control,name:"info",render:({field:n})=>e.jsxs(_,{className:"space-y-2",children:[e.jsx(v,{children:s("features.content.column.form.info")}),e.jsx(I,{children:e.jsx("div",{className:"min-h-[280px] rounded-md border border-border overflow-hidden",children:e.jsx(Le,{fallback:e.jsx(Z,{className:"min-h-[280px] font-mono text-sm resize-none border-0 rounded-md",value:n.value??"",onChange:p=>n.onChange(p.target.value),placeholder:s("features.content.column.form.infoPlaceholder")}),children:e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"min-h-[280px] flex items-center justify-center text-muted-foreground text-sm bg-muted/30",children:s("features.content.column.form.infoLoading")}),children:e.jsx(Ae,{value:n.value??"",onChange:n.onChange,minHeight:"min-h-[280px]",outputMode:"json"})})})})}),e.jsx(S,{})]})}),e.jsxs(ze,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>m(!1),children:s("features.content.column.form.cancel")}),e.jsx(w,{type:"submit",disabled:T,children:s(T?"features.content.column.form.submitting":"features.content.column.form.submit")})]})]})})]}),e.jsx(Ke,{open:M,onOpenChange:h,onSelect:n=>{c.setValue("icon",n.url,{shouldValidate:!0}),h(!1)},type:1,title:s("features.content.column.form.selectIconDialogTitle"),description:s("features.content.column.form.selectIconDialogDesc")})]})}async function $e(o){return await F.get("/api/column",{params:{projectID:o?.projectID??"",title:o?.title??"",pageNum:o?.pageNum??1,pageSize:o?.pageSize??10}})}async function Ue(o){const m=o.trim();return(await F.get(`/api/column/${m}`)).column}async function Ge(o){return await F.post("/api/column",o,{params:{projectID:o.projectID}})??{}}async function Je(o,m){const u=o.trim();await F.patch(`/api/column/${u}`,m)}async function We(o){await F.delete("/api/column",{data:{columnIds:o.trim()}})}function Xe(){"use no memo";const{t:o}=ee(),m=he(),[u,D]=l.useState(null),[T,x]=l.useState(!1),[a,s]=l.useState(null),[i,M]=l.useState("__all__"),[h,q]=l.useState([]),[c,z]=l.useState({pageIndex:0,pageSize:10}),[n,p]=l.useState([]),[E,d]=l.useState({}),O=l.useMemo(()=>{const t=r=>{const f=h.find(b=>b.id===r);return f?.value&&Array.isArray(f.value)?f.value[0]||"":f?.value||""};return{projectID:i&&i!=="__all__"&&i.trim()||void 0,title:t("title")||void 0,pageNum:c.pageIndex+1,pageSize:c.pageSize}},[h,c,i]),{data:A}=K({queryKey:["projectList",{current:1,pageNum:1,pageSize:1e3}],queryFn:()=>Oe({current:1,pageNum:1,pageSize:1e3})}),H=l.useMemo(()=>A?.projects?.map(t=>({projectID:t.projectID,title:t.title??t.projectID}))??[],[A?.projects]),{data:Q,isLoading:ae,error:ce}=K({queryKey:["columnList",O],queryFn:()=>$e(O),placeholderData:xe}),{data:L}=K({queryKey:["columnDetail",a],queryFn:()=>Ue(a),enabled:!!a?.trim()}),$=Q?.columns??[],le=Q?.total??0,ie=Math.ceil(le/c.pageSize),P=l.useMemo(()=>[{accessorKey:"columnID",header:({column:t})=>e.jsx(V,{column:t,title:o("features.content.column.columns.id")}),cell:({row:t})=>e.jsx("div",{className:"font-mono text-muted-foreground",children:t.getValue("columnID")?.trim()??"-"})},{accessorKey:"title",header:({column:t})=>e.jsx(V,{column:t,title:o("features.content.column.columns.title")}),cell:({row:t})=>e.jsx("div",{className:"max-w-[160px] truncate font-medium",title:t.getValue("title"),children:t.getValue("title")??"-"})},{accessorKey:"description",header:({column:t})=>e.jsx(V,{column:t,title:o("features.content.column.columns.description")}),cell:({row:t})=>{const r=t.getValue("description");return e.jsx("div",{className:"max-w-[240px] truncate text-muted-foreground",title:r,children:r??"-"})}},{accessorKey:"createdAt",header:({column:t})=>e.jsx(V,{column:t,title:o("features.content.column.columns.createdAt")}),cell:({row:t})=>e.jsx("div",{className:"text-muted-foreground whitespace-nowrap",children:t.getValue("createdAt")??"-"})},{id:"actions",header:o("features.content.column.columns.actions"),cell:({row:t})=>{const r=t.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>s(r.columnID),children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsx(Y,{children:o("features.content.column.actions.edit")})]}),e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>D(r.columnID),children:e.jsx(je,{className:"h-4 w-4 text-destructive"})})}),e.jsx(Y,{children:o("features.content.column.actions.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[o]),g=De({data:$,columns:P,getCoreRowModel:ye(),getSortedRowModel:be(),manualPagination:!0,pageCount:ie,onSortingChange:p,onColumnFiltersChange:q,onColumnVisibilityChange:d,onPaginationChange:z,state:{sorting:n,columnFilters:h,columnVisibility:E,pagination:c}}),U=B({mutationFn:t=>Ge(t),onSuccess:()=>{j.success(o("features.content.column.createSuccess")),m.invalidateQueries({queryKey:["columnList"]}),x(!1)},onError:t=>{j.error(t instanceof Error?t.message:o("features.content.column.createError"))}}),G=B({mutationFn:({columnID:t,data:r})=>Je(t,r),onSuccess:()=>{j.success(o("features.content.column.updateSuccess")),m.invalidateQueries({queryKey:["columnList"]}),s(null)},onError:t=>{j.error(t instanceof Error?t.message:o("features.content.column.updateError"))}}),J=B({mutationFn:t=>We(t),onSuccess:()=>{j.success(o("features.content.column.deleteSuccess")),m.invalidateQueries({queryKey:["columnList"]}),D(null)},onError:t=>{j.error(t instanceof Error?t.message:o("features.content.column.deleteError"))}}),me=()=>{u&&J.mutate(u)},ue=$.find(t=>t.columnID===u);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(Ne,{title:o("features.content.column.title"),description:o("features.content.column.description"),children:e.jsxs(w,{onClick:()=>x(!0),children:[e.jsx(Ce,{className:"h-4 w-4"}),o("features.content.column.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(te,{type:"text",placeholder:o("features.content.column.search.title"),value:g.getColumn("title")?.getFilterValue()??"",onChange:t=>g.getColumn("title")?.setFilterValue(t.target.value),className:"h-8 w-[180px]"}),e.jsxs(oe,{value:i,onValueChange:M,children:[e.jsx(ne,{className:"h-8 w-[160px]",children:e.jsx(se,{placeholder:o("features.content.column.search.project")})}),e.jsxs(re,{children:[e.jsx(k,{value:"__all__",children:o("features.content.column.search.projectAll")}),H.map(t=>e.jsx(k,{value:(t.projectID??"").trim(),children:t.title},t.projectID))]})]})]})}),e.jsxs(_e,{children:[e.jsx(ve,{children:g.getHeaderGroups().map(t=>e.jsx(C,{children:t.headers.map(r=>{const f=r.isPlaceholder?null:typeof r.column.columnDef.header=="function"?r.column.columnDef.header(r.getContext()):r.column.columnDef.header,b=r.column.columnDef.meta;return e.jsx(Ie,{className:b?.thClassName,children:f},r.id)})},t.id))}),e.jsx(Se,{children:ae?e.jsx(C,{children:e.jsx(R,{colSpan:P.length,className:"h-24 text-center",children:o("features.content.column.loading")})}):ce?e.jsx(C,{children:e.jsx(R,{colSpan:P.length,className:"h-24 text-center text-destructive",children:o("features.content.column.loadError")})}):g.getRowModel().rows?.length?g.getRowModel().rows.map(t=>e.jsx(C,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(r=>{const f=typeof r.column.columnDef.cell=="function"?r.column.columnDef.cell(r.getContext()):r.column.columnDef.cell,b=r.column.columnDef.meta;return e.jsx(R,{className:b?.tdClassName,children:f},r.id)})},t.id)):e.jsx(C,{children:e.jsx(R,{colSpan:P.length,className:"h-24 text-center",children:o("features.content.column.noData")})})})]}),e.jsx(we,{table:g})]}),e.jsx(Qe,{open:T||!!a?.trim()&&!!L,onOpenChange:t=>{t||(x(!1),s(null))},onSubmit:t=>U.mutate(t),onSubmitUpdate:(t,r)=>G.mutate({columnID:t,data:r}),isLoading:U.isPending||G.isPending,projectList:H,editColumn:a&&L?L:null}),e.jsx(Fe,{open:u!==null,onOpenChange:t=>{t||D(null)},title:o("features.content.column.confirmDelete"),desc:o("features.content.column.confirmDeleteDesc",{title:ue?.title??u??""}),handleConfirm:me,destructive:!0,confirmText:o("features.content.column.actions.delete"),isLoading:J.isPending})]})}const Tt=Xe;export{Tt as component};
