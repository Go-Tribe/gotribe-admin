import{m as j,a as Q,l as $,r,t as x,j as o,B as b,K as O}from"./index-Pe1Nv6hH.js";import{u as w}from"./useQuery-DDON36P9.js";import{u as N}from"./useMutation-uvHqRPk1.js";import{e as G,f as J,u as U,g as W,c as X}from"./react-icons.esm-CiMB90YA.js";import{S as Y}from"./index-BmISbovJ.js";import{I as Z}from"./input-DW-mBlUw.js";import{B as ee}from"./badge-T19Q3klL.js";import{g as te}from"./status-variants-Dh7YK7JP.js";import{D as l,T as oe,a as ae,b as d,c as ne,d as se,e as h}from"./column-header-Cfszq_dp.js";import{D as re}from"./pagination-B86K5cVv.js";import{D as ce}from"./faceted-filter-BDTVtMjs.js";import{T as I,v as k,w as T}from"./sidebar-BFSPGCEL.js";import{S as ie,a as me,b as le,c as ue,d as _}from"./select-Dl4KSF7A.js";import{g as de}from"./project-_pxXE-N5.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./index-D68Ta3NN.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./command-D9eDedTW.js";import"./index-DGhUbGt9.js";import"./dialog-DHifiqsD.js";import"./search-DNOmmJ4K.js";import"./popover-CrxLZKyN.js";import"./separator-Bq1fgMtF.js";async function pe(t){const n={pageNum:t?.pageNum??1,pageSize:t?.pageSize??10};return t?.status!=null&&t.status!==""&&(n.status=t.status),t?.nickname!=null&&t.nickname!==""&&(n.nickname=t.nickname),t?.projectID!=null&&t.projectID!==""&&(n.projectID=t.projectID),await j.get("/api/comment",{params:n})}async function ge(t){const n=t.trim();await j.patch(`/api/comment/${n}`,{})}async function xe(t){const n=t.trim();await j.patch(`/api/comment/${n}`,{status:1})}function he(t){return{id:(t.commentID??"").trim()||String(t.id??""),comment:(t.comment??"").trim()||"-",nickname:(t.nickname??"").trim()||"-",userID:(t.userID??"").trim()||"-",objectType:t.objectType??0,status:t.status??1,createdAt:t.createdAt?.trim()||"-"}}function je(){"use no memo";const{t}=Q(),n=$(),[p,V]=r.useState([{id:"status",value:"1"}]),[u,M]=r.useState("__all__"),[m,F]=r.useState({pageIndex:0,pageSize:10}),[P,z]=r.useState([]),[R,K]=r.useState({}),{data:f}=w({queryKey:["projectList",{pageNum:1,pageSize:1e3}],queryFn:()=>de({pageNum:1,pageSize:1e3})}),q=r.useMemo(()=>f?.projects?.map(e=>({projectID:e.projectID,title:e.title??e.projectID}))??[],[f?.projects]),v=r.useMemo(()=>{const e=a=>{const s=p.find(i=>i.id===a);return s?.value&&Array.isArray(s.value)?s.value[0]||"":s?.value||""};return{pageNum:m.pageIndex+1,pageSize:m.pageSize,status:e("status")||void 0,nickname:e("nickname")||void 0,projectID:u&&u!=="__all__"&&u.trim()||void 0}},[m.pageIndex,m.pageSize,p,u]),{data:C,isLoading:L,error:A}=w({queryKey:["commentList",v],queryFn:()=>pe(v),placeholderData:O}),y=C?.comments??[],E=r.useMemo(()=>y.map(e=>he(e)),[y]),B=C?.total??0,H=Math.max(1,Math.ceil(B/m.pageSize)),S=N({mutationFn:e=>ge(e),onSuccess:()=>{x.success(t("features.operation.comment.approveSuccess")),n.invalidateQueries({queryKey:["commentList"]})},onError:e=>{x.error(e instanceof Error?e.message:t("features.operation.comment.approveError"))}}),D=N({mutationFn:e=>xe(e),onSuccess:()=>{x.success(t("features.operation.comment.rejectSuccess")),n.invalidateQueries({queryKey:["commentList"]})},onError:e=>{x.error(e instanceof Error?e.message:t("features.operation.comment.rejectError"))}}),g=r.useMemo(()=>[{accessorKey:"id",header:({column:e})=>o.jsx(l,{column:e,title:t("features.operation.comment.comment.columns.id")}),cell:({row:e})=>o.jsx("div",{className:"font-mono text-muted-foreground max-w-[100px] truncate",children:e.getValue("id")??"-"})},{accessorKey:"comment",header:({column:e})=>o.jsx(l,{column:e,title:t("features.operation.comment.comment.columns.comment")}),cell:({row:e})=>{const a=e.getValue("comment");return o.jsx("div",{className:"max-w-[200px] truncate font-medium",title:a,children:a??"-"})}},{accessorKey:"nickname",header:({column:e})=>o.jsx(l,{column:e,title:t("features.operation.comment.comment.columns.nickname")}),cell:({row:e})=>o.jsx("div",{className:"max-w-[120px] truncate text-muted-foreground",children:e.getValue("nickname")??"-"})},{accessorKey:"userID",header:({column:e})=>o.jsx(l,{column:e,title:t("features.operation.comment.comment.columns.userID")}),cell:({row:e})=>o.jsx("div",{className:"font-mono text-muted-foreground max-w-[80px] truncate",children:e.getValue("userID")??"-"})},{accessorKey:"status",header:({column:e})=>o.jsx(l,{column:e,title:t("features.operation.comment.comment.columns.status")}),cell:({row:e})=>{const a=e.getValue("status");return o.jsx(ee,{variant:te(a,"approvalStatus"),children:t(a===2?"features.operation.comment.comment.status.approved":"features.operation.comment.comment.status.pending")})}},{accessorKey:"createdAt",header:({column:e})=>o.jsx(l,{column:e,title:t("features.operation.comment.comment.columns.createdAt")}),cell:({row:e})=>o.jsx("div",{className:"text-muted-foreground whitespace-nowrap",children:e.getValue("createdAt")??"-"})},{id:"actions",header:t("features.operation.comment.comment.columns.actions"),cell:({row:e})=>{const a=e.original,s=a.status===1,i=a.status===2;return o.jsxs("div",{className:"flex items-center gap-2",children:[s&&o.jsxs(I,{children:[o.jsx(k,{asChild:!0,children:o.jsx(b,{variant:"ghost",size:"sm",onClick:()=>S.mutate(a.id),disabled:S.isPending,children:o.jsx(G,{className:"h-4 w-4 text-green-600"})})}),o.jsx(T,{children:t("features.operation.comment.comment.actions.approve")})]}),i&&o.jsxs(I,{children:[o.jsx(k,{asChild:!0,children:o.jsx(b,{variant:"ghost",size:"sm",onClick:()=>D.mutate(a.id),disabled:D.isPending,children:o.jsx(J,{className:"h-4 w-4 text-red-600"})})}),o.jsx(T,{children:t("features.operation.comment.comment.actions.reject")})]})]})},enableHiding:!1,meta:{thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[t]),c=U({data:E,columns:g,getCoreRowModel:X(),getSortedRowModel:W(),manualPagination:!0,pageCount:H,getRowId:e=>e.id,onSortingChange:z,onColumnFiltersChange:V,onColumnVisibilityChange:K,onPaginationChange:F,state:{sorting:P,columnFilters:p,columnVisibility:R,pagination:m}});return o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:o.jsx(Y,{title:t("features.operation.comment.title"),description:t("features.operation.comment.description")})}),o.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[o.jsx("div",{className:"space-y-2 pb-4",children:o.jsxs("div",{className:"flex flex-wrap gap-2",children:[o.jsxs(ie,{value:u,onValueChange:M,children:[o.jsx(me,{className:"h-8 w-[160px]",children:o.jsx(le,{placeholder:t("features.operation.comment.comment.search.project")})}),o.jsxs(ue,{children:[o.jsx(_,{value:"__all__",children:t("features.operation.comment.comment.search.projectAll")}),q.map(e=>o.jsx(_,{value:(e.projectID??"").trim(),children:e.title},e.projectID))]})]}),o.jsx(Z,{type:"text",placeholder:t("features.operation.comment.comment.search.nicknamePlaceholder"),value:c.getColumn("nickname")?.getFilterValue()??"",onChange:e=>c.getColumn("nickname")?.setFilterValue(e.target.value),className:"h-8 w-[160px]"}),o.jsx(ce,{column:c.getColumn("status"),title:t("features.operation.comment.comment.search.status"),options:[{label:t("features.operation.comment.comment.status.pending"),value:"1"},{label:t("features.operation.comment.comment.status.approved"),value:"2"}],single:!0})]})}),o.jsxs(oe,{children:[o.jsx(ae,{children:c.getHeaderGroups().map(e=>o.jsx(d,{children:e.headers.map(a=>{const s=a.isPlaceholder?null:typeof a.column.columnDef.header=="function"?a.column.columnDef.header(a.getContext()):a.column.columnDef.header,i=a.column.columnDef.meta;return o.jsx(ne,{className:i?.thClassName,children:s},a.id)})},e.id))}),o.jsx(se,{children:L?o.jsx(d,{children:o.jsx(h,{colSpan:g.length,className:"h-24 text-center",children:t("features.operation.comment.comment.loading")})}):A?o.jsx(d,{children:o.jsx(h,{colSpan:g.length,className:"h-24 text-center text-destructive",children:t("features.operation.comment.comment.loadError")})}):c.getRowModel().rows?.length?c.getRowModel().rows.map(e=>o.jsx(d,{children:e.getVisibleCells().map(a=>{const s=typeof a.column.columnDef.cell=="function"?a.column.columnDef.cell(a.getContext()):a.column.columnDef.cell,i=a.column.columnDef.meta;return o.jsx(h,{className:i?.tdClassName,children:s},a.id)})},e.id)):o.jsx(d,{children:o.jsx(h,{colSpan:g.length,className:"h-24 text-center",children:t("features.operation.comment.comment.noData")})})})]}),o.jsx(re,{table:c})]})]})}const Oe=je;export{Oe as component};
