import{a as E,u as Q,l as $,r as o,j as t,B as j,t as G,K as J}from"./index-Pe1Nv6hH.js";import{u as I}from"./useQuery-DDON36P9.js";import{u as U}from"./useMutation-uvHqRPk1.js";import{P as W,T as X,u as Y,g as Z,c as ee,b as te}from"./react-icons.esm-CiMB90YA.js";import{S as se}from"./index-BmISbovJ.js";import{I as N}from"./input-DW-mBlUw.js";import{D as i,T as ae,a as le,b as u,c as ne,d as oe,e as p}from"./column-header-Cfszq_dp.js";import{D as re}from"./pagination-B86K5cVv.js";import{D as ie}from"./faceted-filter-BDTVtMjs.js";import{B as S}from"./badge-T19Q3klL.js";import{T,v as w,w as V}from"./sidebar-BFSPGCEL.js";import{S as ce,a as ue,b as de,c as me,d as P}from"./select-Dl4KSF7A.js";import{g as pe}from"./status-variants-Dh7YK7JP.js";import{C as ge}from"./confirm-dialog-DmDS_GmK.js";import{d as he,g as xe}from"./post-BNqlxPPd.js";import{g as fe}from"./project-_pxXE-N5.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./index-D68Ta3NN.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./command-D9eDedTW.js";import"./index-DGhUbGt9.js";import"./dialog-DHifiqsD.js";import"./search-DNOmmJ4K.js";import"./popover-CrxLZKyN.js";import"./separator-Bq1fgMtF.js";function je(){"use no memo";const{t:a}=E(),g=Q(),F=$(),[d,h]=o.useState(null),[x,_]=o.useState([]),[c,M]=o.useState({pageIndex:0,pageSize:10}),[z,K]=o.useState([]),[k,R]=o.useState({}),D=o.useMemo(()=>{const e=s=>{const n=x.find(r=>r.id===s);return n?.value&&Array.isArray(n.value)?n.value[0]||"":n?.value||""};return{postID:e("postID"),title:e("title"),status:e("status")||void 0,projectID:e("projectID")||void 0,pageNum:c.pageIndex+1,pageSize:c.pageSize}},[x,c]),{data:C}=I({queryKey:["projectList",{current:1,pageNum:1,pageSize:1e3}],queryFn:()=>fe({current:1,pageNum:1,pageSize:1e3})}),f=o.useMemo(()=>C?.projects??[],[C?.projects]),{data:v,isLoading:L,error:q}=I({queryKey:["postList",D],queryFn:()=>xe(D),placeholderData:J}),y=v?.posts??[],B=v?.total??0,A=Math.ceil(B/c.pageSize),m=o.useMemo(()=>[{accessorKey:"postID",header:({column:e})=>t.jsx(i,{column:e,title:a("features.content.article.columns.postID")}),cell:({row:e})=>t.jsx("div",{className:"font-mono text-muted-foreground",children:e.getValue("postID")})},{accessorKey:"title",header:({column:e})=>t.jsx(i,{column:e,title:a("features.content.article.columns.title")}),cell:({row:e})=>t.jsxs("div",{className:"flex items-center gap-2",children:[e.original.isTop===2&&t.jsx(S,{variant:"destructive",className:"px-1 py-0 text-[10px] h-5 whitespace-nowrap",children:"TOP"}),t.jsx("div",{className:"max-w-[200px] truncate font-medium",title:e.getValue("title"),children:e.getValue("title")})]})},{accessorKey:"author",header:({column:e})=>t.jsx(i,{column:e,title:a("features.content.article.columns.author")}),cell:({row:e})=>t.jsx("div",{children:e.getValue("author")})},{accessorKey:"description",header:({column:e})=>t.jsx(i,{column:e,title:a("features.content.article.columns.description")}),cell:({row:e})=>{const s=e.getValue("description");return t.jsx("div",{className:"max-w-[280px] truncate text-muted-foreground",title:s,children:s||"-"})}},{id:"projectID",accessorKey:"projectID",header:({column:e})=>t.jsx(i,{column:e,title:a("features.content.article.filter.project")}),cell:({row:e})=>{const s=e.getValue("projectID"),n=f.find(r=>r.projectID===s);return t.jsx("div",{className:"text-muted-foreground",children:n?.title??s??"-"})}},{accessorKey:"status",header:({column:e})=>t.jsx(i,{column:e,title:a("features.content.article.columns.status")}),cell:({row:e})=>{const s=e.getValue("status");return t.jsx(S,{variant:pe(s,"articlePublish"),children:a(s===2?"features.content.article.status.published":"features.content.article.status.draft")})}},{accessorKey:"createdAt",header:({column:e})=>t.jsx(i,{column:e,title:a("features.content.article.columns.createdAt")}),cell:({row:e})=>{const s=e.original.showTime||e.original.createdAt;return t.jsx("div",{className:"text-muted-foreground",children:s?String(s).slice(0,19):"-"})}},{id:"actions",header:a("features.content.article.columns.actions"),cell:({row:e})=>{const s=e.original;return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(T,{children:[t.jsx(w,{asChild:!0,children:t.jsx(j,{variant:"ghost",size:"sm",onClick:()=>g({to:"/content/article/$postID/edit",params:{postID:s.postID}}),children:t.jsx(W,{className:"h-4 w-4"})})}),t.jsx(V,{children:a("features.content.article.actions.edit")})]}),t.jsxs(T,{children:[t.jsx(w,{asChild:!0,children:t.jsx(j,{variant:"ghost",size:"sm",onClick:()=>h(s.postID),children:t.jsx(X,{className:"h-4 w-4 text-destructive"})})}),t.jsx(V,{children:a("features.content.article.actions.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[a,g,f]),l=Y({data:y,columns:m,getCoreRowModel:ee(),getSortedRowModel:Z(),manualPagination:!0,pageCount:A,onSortingChange:K,onColumnFiltersChange:_,onColumnVisibilityChange:R,onPaginationChange:M,state:{sorting:z,columnFilters:x,columnVisibility:k,pagination:c}}),b=U({mutationFn:e=>he(e),onSuccess:()=>{G.success(a("features.content.article.deleteSuccess")),F.invalidateQueries({queryKey:["postList"]}),h(null)}}),H=()=>{d&&b.mutate(d)},O=y.find(e=>e.postID===d);return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:t.jsx(se,{title:a("features.content.article.title"),description:a("features.content.article.description"),children:t.jsxs(j,{onClick:()=>g({to:"/content/article/new"}),children:[t.jsx(te,{className:"h-4 w-4"}),a("features.content.article.createButton")]})})}),t.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[t.jsx("div",{className:"space-y-2 pb-4",children:t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx(N,{type:"text",placeholder:a("features.content.article.search.postID"),value:l.getColumn("postID")?.getFilterValue()??"",onChange:e=>l.getColumn("postID")?.setFilterValue(e.target.value),className:"h-8 w-[160px]"}),t.jsx(N,{type:"text",placeholder:a("features.content.article.search.title"),value:l.getColumn("title")?.getFilterValue()??"",onChange:e=>l.getColumn("title")?.setFilterValue(e.target.value),className:"h-8 w-[180px]"}),t.jsxs(ce,{value:l.getColumn("projectID")?.getFilterValue()||"all",onValueChange:e=>l.getColumn("projectID")?.setFilterValue(e==="all"?void 0:e),children:[t.jsx(ue,{className:"h-8 w-[180px]",children:t.jsx(de,{placeholder:a("features.content.article.filter.project")})}),t.jsxs(me,{children:[t.jsx(P,{value:"all",children:a("features.content.article.search.allProjects")}),f.map(e=>t.jsx(P,{value:e.projectID,children:e.title},e.projectID))]})]}),t.jsx(ie,{column:l.getColumn("status"),title:a("features.content.article.filter.status"),options:[{label:a("features.content.article.status.draft"),value:"1"},{label:a("features.content.article.status.published"),value:"2"}],single:!0})]})}),t.jsxs(ae,{children:[t.jsx(le,{children:l.getHeaderGroups().map(e=>t.jsx(u,{children:e.headers.map(s=>{const n=s.isPlaceholder?null:typeof s.column.columnDef.header=="function"?s.column.columnDef.header(s.getContext()):s.column.columnDef.header,r=s.column.columnDef.meta;return t.jsx(ne,{className:r?.thClassName,children:n},s.id)})},e.id))}),t.jsx(oe,{children:L?t.jsx(u,{children:t.jsx(p,{colSpan:m.length,className:"h-24 text-center",children:a("features.content.article.loading")})}):q?t.jsx(u,{children:t.jsx(p,{colSpan:m.length,className:"h-24 text-center text-destructive",children:a("features.content.article.loadError")})}):l.getRowModel().rows?.length?l.getRowModel().rows.map(e=>t.jsx(u,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(s=>{const n=typeof s.column.columnDef.cell=="function"?s.column.columnDef.cell(s.getContext()):s.column.columnDef.cell,r=s.column.columnDef.meta;return t.jsx(p,{className:r?.tdClassName,children:n},s.id)})},e.id)):t.jsx(u,{children:t.jsx(p,{colSpan:m.length,className:"h-24 text-center",children:a("features.content.article.noData")})})})]}),t.jsx(re,{table:l})]}),t.jsx(ge,{open:d!==null,onOpenChange:e=>{e||h(null)},title:a("features.content.article.confirmDelete"),desc:a("features.content.article.confirmDeleteDesc",{title:O?.title??""}),handleConfirm:H,destructive:!0,confirmText:a("features.content.article.actions.delete"),isLoading:b.isPending})]})}const Ue=je;export{Ue as component};
