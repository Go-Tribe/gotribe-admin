import{a as H,u as E,l as O,r as l,j as e,B as j,t as Q,K as $}from"./index-Pe1Nv6hH.js";import{u as S}from"./useQuery-DDON36P9.js";import{u as G}from"./useMutation-uvHqRPk1.js";import{P as J,T as U,u as W,g as X,c as Y,b as Z}from"./react-icons.esm-CiMB90YA.js";import{S as ee}from"./index-BmISbovJ.js";import{I as te}from"./input-DW-mBlUw.js";import{D as i,T as se,a as re,b as u,c as oe,d as ae,e as p}from"./column-header-Cfszq_dp.js";import{D as le}from"./pagination-B86K5cVv.js";import{B as ce}from"./badge-T19Q3klL.js";import{T as N,v as I,w as T}from"./sidebar-BFSPGCEL.js";import{S as ne,a as ie,b as ue,c as de,d as w}from"./select-Dl4KSF7A.js";import{C as me}from"./confirm-dialog-DmDS_GmK.js";import{g as pe}from"./status-variants-Dh7YK7JP.js";import{d as ge,g as he}from"./product-Cl-dx2lJ.js";import{g as xe}from"./project-_pxXE-N5.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./index-D68Ta3NN.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";function fe(){"use no memo";const{t:r}=H(),g=E(),V=O(),[d,h]=l.useState(null),[x,P]=l.useState([]),[n,_]=l.useState({pageIndex:0,pageSize:10}),[M,z]=l.useState([]),[F,k]=l.useState({}),D=l.useMemo(()=>{const t=s=>{const o=x.find(c=>c.id===s);return o?.value&&Array.isArray(o.value)?o.value[0]||"":o?.value||""};return{project_id:t("projectID")||void 0,title:t("title")||void 0,pageNum:n.pageIndex+1,pageSize:n.pageSize}},[x,n]),{data:C}=S({queryKey:["projectList",{current:1,pageNum:1,pageSize:1e3}],queryFn:()=>xe({current:1,pageNum:1,pageSize:1e3})}),f=l.useMemo(()=>C?.projects??[],[C?.projects]),{data:b,isLoading:K,error:R}=S({queryKey:["productList",D],queryFn:()=>he(D),placeholderData:$}),v=b?.products??[],L=b?.total??0,q=Math.ceil(L/n.pageSize),m=l.useMemo(()=>[{accessorKey:"productID",header:({column:t})=>e.jsx(i,{column:t,title:r("features.store.product.columns.productID")}),cell:({row:t})=>e.jsx("div",{className:"font-mono text-muted-foreground",children:t.getValue("productID")})},{accessorKey:"title",header:({column:t})=>e.jsx(i,{column:t,title:r("features.store.product.columns.title")}),cell:({row:t})=>e.jsx("div",{className:"max-w-[200px] truncate font-medium",title:t.getValue("title"),children:t.getValue("title")})},{id:"projectID",accessorKey:"projectID",header:({column:t})=>e.jsx(i,{column:t,title:r("features.store.product.filter.project")}),cell:({row:t})=>{const s=t.getValue("projectID"),o=f.find(c=>c.projectID===s);return e.jsx("div",{className:"text-muted-foreground",children:o?.title??s??"-"})}},{id:"cover",header:r("features.store.product.columns.cover"),cell:({row:t})=>{const o=t.original.images?.[0];return o?e.jsx("img",{src:o,alt:"",className:"h-10 w-10 rounded object-cover"}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"enable",header:({column:t})=>e.jsx(i,{column:t,title:r("features.store.product.columns.enable")}),cell:({row:t})=>{const s=t.getValue("enable"),o=r(s===1?"features.store.product.status.enabled":"features.store.product.status.disabled");return e.jsx(ce,{variant:pe(s===1?1:2,"articlePublish"),children:o})}},{accessorKey:"createdAt",header:({column:t})=>e.jsx(i,{column:t,title:r("features.store.product.columns.createdAt")}),cell:({row:t})=>e.jsx("div",{className:"text-muted-foreground",children:t.getValue("createdAt")?String(t.getValue("createdAt")).slice(0,19):"-"})},{id:"actions",header:r("features.store.product.columns.actions"),cell:({row:t})=>{const s=t.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(N,{children:[e.jsx(I,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>g({to:"/store/product/$productID/edit",params:{productID:s.productID}}),children:e.jsx(J,{className:"h-4 w-4"})})}),e.jsx(T,{children:r("features.store.product.actions.edit")})]}),e.jsxs(N,{children:[e.jsx(I,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>h(s.productID),children:e.jsx(U,{className:"h-4 w-4 text-destructive"})})}),e.jsx(T,{children:r("features.store.product.actions.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[r,g,f]),y=G({mutationFn:t=>ge(t),onSuccess:()=>{Q.success(r("features.store.product.deleteSuccess")),V.invalidateQueries({queryKey:["productList"]}),h(null)}}),B=()=>{d&&y.mutate(d)},A=v.find(t=>t.productID===d),a=W({data:v,columns:m,getCoreRowModel:Y(),getSortedRowModel:X(),manualPagination:!0,pageCount:q,onSortingChange:z,onColumnFiltersChange:P,onColumnVisibilityChange:k,onPaginationChange:_,state:{sorting:M,columnFilters:x,columnVisibility:F,pagination:n}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(ee,{title:r("features.store.product.title"),description:r("features.store.product.description"),children:e.jsxs(j,{onClick:()=>g({to:"/store/product/new"}),children:[e.jsx(Z,{className:"h-4 w-4"}),r("features.store.product.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(te,{type:"text",placeholder:r("features.store.product.search.title"),value:a.getColumn("title")?.getFilterValue()??"",onChange:t=>a.getColumn("title")?.setFilterValue(t.target.value),className:"h-8 w-[180px]"}),e.jsxs(ne,{value:a.getColumn("projectID")?.getFilterValue()||"all",onValueChange:t=>a.getColumn("projectID")?.setFilterValue(t==="all"?void 0:t),children:[e.jsx(ie,{className:"h-8 w-[180px]",children:e.jsx(ue,{placeholder:r("features.store.product.filter.project")})}),e.jsxs(de,{children:[e.jsx(w,{value:"all",children:r("features.store.product.search.allProjects")}),f.map(t=>e.jsx(w,{value:t.projectID,children:t.title},t.projectID))]})]})]})}),e.jsxs(se,{children:[e.jsx(re,{children:a.getHeaderGroups().map(t=>e.jsx(u,{children:t.headers.map(s=>{const o=s.isPlaceholder?null:typeof s.column.columnDef.header=="function"?s.column.columnDef.header(s.getContext()):s.column.columnDef.header,c=s.column.columnDef.meta;return e.jsx(oe,{className:c?.thClassName,children:o},s.id)})},t.id))}),e.jsx(ae,{children:K?e.jsx(u,{children:e.jsx(p,{colSpan:m.length,className:"h-24 text-center",children:r("features.store.product.loading")})}):R?e.jsx(u,{children:e.jsx(p,{colSpan:m.length,className:"h-24 text-center text-destructive",children:r("features.store.product.loadError")})}):a.getRowModel().rows?.length?a.getRowModel().rows.map(t=>e.jsx(u,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(s=>{const o=typeof s.column.columnDef.cell=="function"?s.column.columnDef.cell(s.getContext()):s.column.columnDef.cell,c=s.column.columnDef.meta;return e.jsx(p,{className:c?.tdClassName,children:o},s.id)})},t.id)):e.jsx(u,{children:e.jsx(p,{colSpan:m.length,className:"h-24 text-center",children:r("features.store.product.noData")})})})]}),e.jsx(le,{table:a})]}),e.jsx(me,{open:d!==null,onOpenChange:t=>{t||h(null)},title:r("features.store.product.confirmDelete"),desc:r("features.store.product.confirmDeleteDesc",{title:A?.title??""}),handleConfirm:B,destructive:!0,confirmText:r("features.store.product.actions.delete"),isLoading:y.isPending})]})}const Ae=fe;export{Ae as component};
