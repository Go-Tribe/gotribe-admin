import{j as e,e as P,u as R,l as D,d as L,r as N,A as O,C as c,B as Q,t as l}from"./index-Pe1Nv6hH.js";import{S as y}from"./separator-Bq1fgMtF.js";import{u as K}from"./useQuery-DDON36P9.js";import{u as v}from"./useMutation-uvHqRPk1.js";import{u as U,a as z,F as B,b as u,c as f,d as p,e as x,f as g}from"./form-DU65aaqX.js";import{A as T,a as V,b as G}from"./avatar-gJcrYmow.js";import{P as h}from"./password-input-lMMxhBwE.js";import{R as H}from"./index-B79q5nRO.js";import{c as J,u as W,g as X}from"./index-emgquIU-.js";import{L as b}from"./loader-circle-DjNfctPA.js";import"./index-DGhUbGt9.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./eye-TW5NDUHo.js";import"./dialog-DHifiqsD.js";import"./index-D68Ta3NN.js";import"./scroll-area-BCr0FWtA.js";import"./resource-u0oZDgOZ.js";import"./upload-CE8x_1SM.js";import"./chevron-left-BrCT33MH.js";import"./chevron-right-COcvBQ44.js";function Y({title:s,desc:o,children:a}){return e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsxs("div",{className:"flex-none",children:[e.jsx("h3",{className:"text-lg font-medium",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o})]}),e.jsx(y,{className:"my-4 flex-none"}),e.jsx("div",{className:"faded-bottom h-full w-full overflow-y-auto scroll-smooth pe-4 pb-12",children:e.jsx("div",{className:"-mx-1 px-1.5 lg:max-w-xl",children:a})})]})}function Z(s,o){if(Array.isArray(s.roleIds)){const a=s.roleIds.map(t=>Number(t)).filter(t=>!Number.isNaN(t));if(a.length>0)return a}if(Array.isArray(s.roles)){const a=s.roles.map(t=>Number(t?.id)).filter(t=>!Number.isNaN(t));if(a.length>0)return a}if(o?.roleIds&&Array.isArray(o.roleIds)){const a=o.roleIds.map(t=>Number(t)).filter(t=>!Number.isNaN(t));if(a.length>0)return a}return[]}function $(){const{t:s}=P(),o=R(),a=D(),{auth:t}=L(),[A,m]=N.useState(!1),{mutate:_}=v({mutationFn:async r=>{const{admin:i,avatar:q}=r,k=i.status===1||i.status===2?i.status:1,M=Z(i,t.user);return W({...i,avatar:q,status:k,roleIds:M})},onSuccess:(r,{avatar:i})=>{t.user&&t.setUser({...t.user,avatar:i}),a.invalidateQueries({queryKey:["adminInfo"]}),m(!1),l.success(s("features.settings.profile.avatarUpdateSuccess"))},onError:r=>{l.error(r instanceof Error?r.message:s("features.settings.profile.avatarUpdateError"))}}),F=N.useMemo(()=>O({old_password:c().min(1,s("features.settings.validation.oldPasswordRequired")),new_password:c().min(6,s("features.settings.validation.newPasswordMin")).max(20,s("features.settings.validation.newPasswordMax")),confirm_password:c().min(1,s("features.settings.validation.confirmPasswordRequired"))}).refine(r=>r.new_password===r.confirm_password,{message:s("features.settings.validation.passwordMismatch"),path:["confirm_password"]}),[s]),{data:n,isLoading:I,error:S}=K({queryKey:["adminInfo"],queryFn:()=>X({page_num:1,page_size:3})}),d=U({resolver:z(F),defaultValues:{old_password:"",new_password:"",confirm_password:""}}),{mutate:C,isPending:j}=v({mutationFn:r=>J({OldPassword:r.old_password,NewPassword:r.new_password}),onSuccess:()=>{l.success(s("features.settings.changePassword.success")),d.reset(),a.invalidateQueries({queryKey:["adminInfo"]}),t.reset(),o({to:"/sign-in",search:{redirect:"/personal-center"},replace:!0})},onError:r=>{l.error(r instanceof Error?r.message:s("features.settings.changePassword.error"))}});if(I)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(b,{className:"h-8 w-8 animate-spin text-muted-foreground"})});if(S)return e.jsx("div",{className:"rounded-lg border border-destructive/50 bg-destructive/10 px-4 py-3 text-sm text-destructive",children:s("features.settings.profile.loadError")});if(!n)return e.jsx("div",{className:"text-sm text-muted-foreground",children:s("features.settings.profile.noData")});const E=(n.nickname||n.username||"?").slice(0,2).toUpperCase(),w="space-y-4 max-w-sm";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:w,children:[e.jsx("div",{className:"mb-4",children:e.jsx("button",{type:"button",className:"rounded-lg outline-none ring-ring focus-visible:ring-2",onClick:()=>m(!0),"aria-label":s("features.settings.profile.changeAvatar"),children:e.jsxs(T,{className:"h-20 w-20 rounded-lg cursor-pointer",children:[e.jsx(V,{src:n.avatar,alt:n.nickname||n.username}),e.jsx(G,{className:"rounded-lg text-lg",children:E})]})})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s("features.settings.profile.nickname")}),e.jsx("p",{className:"text-base font-medium mt-1",children:n.nickname||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s("features.settings.profile.username")}),e.jsx("p",{className:"text-base font-medium mt-1",children:n.username||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s("features.settings.profile.mobile")}),e.jsx("p",{className:"text-base font-medium mt-1",children:n.mobile||"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s("features.settings.profile.introduction")}),e.jsx("p",{className:"text-base text-muted-foreground mt-1 whitespace-pre-wrap",children:n.introduction||"—"})]})]})]}),e.jsx(y,{className:"my-8"}),e.jsxs("div",{className:w,children:[e.jsx("h4",{className:"text-sm font-medium mb-4",children:s("features.settings.changePassword.title")}),e.jsx(B,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(r=>C(r)),className:"grid gap-4",children:[e.jsx(u,{control:d.control,name:"old_password",render:({field:r})=>e.jsxs(f,{className:"gap-1",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:s("features.settings.changePassword.oldPassword")}),e.jsx(x,{children:e.jsx(h,{placeholder:s("features.settings.changePassword.oldPasswordPlaceholder"),...r})}),e.jsx(g,{})]})}),e.jsx(u,{control:d.control,name:"new_password",render:({field:r})=>e.jsxs(f,{className:"gap-1",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:s("features.settings.changePassword.newPassword")}),e.jsx(x,{children:e.jsx(h,{placeholder:s("features.settings.changePassword.newPasswordPlaceholder"),...r})}),e.jsx(g,{})]})}),e.jsx(u,{control:d.control,name:"confirm_password",render:({field:r})=>e.jsxs(f,{className:"gap-1",children:[e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:s("features.settings.changePassword.confirmPassword")}),e.jsx(x,{children:e.jsx(h,{placeholder:s("features.settings.changePassword.confirmPasswordPlaceholder"),...r})}),e.jsx(g,{})]})}),e.jsxs(Q,{type:"submit",disabled:j,children:[j&&e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),s("features.settings.changePassword.submit")]})]})})]}),e.jsx(H,{open:A,onOpenChange:m,onSelect:r=>_({admin:n,avatar:r.url}),type:1,title:s("features.settings.profile.changeAvatar"),description:s("features.settings.profile.changeAvatarDesc")})]})}function ee(){const{t:s}=P();return e.jsx(Y,{title:s("features.settings.profile.title"),desc:s("features.settings.profile.desc"),children:e.jsx($,{})})}const be=ee;export{be as component};
