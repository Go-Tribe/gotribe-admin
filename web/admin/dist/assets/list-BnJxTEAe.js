import{m as T,a as q,r as u,A as ge,j as e,B as I,J as U,C as pe,l as je,t as ye,K as be}from"./index-Pe1Nv6hH.js";import{u as V}from"./useQuery-DDON36P9.js";import{u as Ne}from"./useMutation-uvHqRPk1.js";import{F as ve,E as Se,P as De,u as we,g as Ce,c as Ie}from"./react-icons.esm-CiMB90YA.js";import{S as Te}from"./index-BmISbovJ.js";import{I as R}from"./input-DW-mBlUw.js";import{D as y,T as ke,a as Pe,b as v,c as Ae,d as Fe,e as C}from"./column-header-Cfszq_dp.js";import{D as Me}from"./pagination-B86K5cVv.js";import{B as J}from"./badge-T19Q3klL.js";import{T as G,v as W,w as X}from"./sidebar-BFSPGCEL.js";import{S as Z,a as ee,b as re,c as se,d as p}from"./select-Dl4KSF7A.js";import{f as Y,D as Le}from"./date-picker-DZceGXqu.js";import{u as _e,a as Oe,F as Ve,b as P,c as A,d as F,e as M,f as L}from"./form-DU65aaqX.js";import{D as te,a as ae,b as le,c as oe,d as Re,e as qe}from"./dialog-DHifiqsD.js";import{T as ze}from"./textarea-D-N386t0.js";import{T as Ee,a as Ke,b as _,c as O}from"./tabs-Dqfr2yce.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./index-D68Ta3NN.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./chevron-left-BrCT33MH.js";import"./popover-CrxLZKyN.js";import"./calendar-DTRwY1QY.js";import"./index-DGhUbGt9.js";const $e=async r=>{const o={pageNum:r?.pageNum??1,pageSize:r?.pageSize??10};return r?.orderNumber&&(o.orderNumber=r.orderNumber),r?.userID&&(o.userID=r.userID),r?.startTime&&(o.startTime=r.startTime),r?.endTime&&(o.endTime=r.endTime),r?.status&&(o.status=r.status),T.get("/api/order",{params:o})},He=async r=>(await T.get(`/api/order/${r}`)).order,Be=async r=>T.get(`/api/order/log/${r}`),Qe=async(r,o)=>T.patch(`/api/order/${r}`,o),Ue=r=>ge({amountPay:U().min(0,r("features.order.form.validation.amountPayMin")),remarkAdmin:pe().optional(),status:U().min(1).max(3)});function Je({open:r,onOpenChange:o,order:d,onSubmit:t,isLoading:a=!1}){const{t:n}=q(),b=u.useMemo(()=>Ue(n),[n]),h=_e({resolver:Oe(b),defaultValues:{amountPay:0,remarkAdmin:"",status:1}});u.useEffect(()=>{r&&d&&h.reset({amountPay:d.amountPay??0,remarkAdmin:d.remarkAdmin??"",status:d.status??1})},[r,d,h]);async function j(i){d&&(await t(d.orderID,i),o(!1))}return e.jsx(te,{open:r,onOpenChange:o,children:e.jsxs(ae,{className:"sm:max-w-[500px] max-h-[90vh] flex flex-col",children:[e.jsxs(le,{className:"shrink-0",children:[e.jsx(oe,{children:n("features.order.form.editTitle")}),e.jsx(Re,{children:n("features.order.form.editDescription")})]}),e.jsx(Ve,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(j),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(P,{control:h.control,name:"amountPay",render:({field:i})=>e.jsxs(A,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(F,{className:"text-right",children:n("features.order.form.amountPay")}),e.jsx(M,{children:e.jsx(R,{type:"number",step:"any",placeholder:n("features.order.form.amountPayPlaceholder"),...i,onChange:g=>{const m=g.target.value===""?0:Number(g.target.value);i.onChange(m)},value:i.value??""})}),e.jsx(L,{className:"col-start-2"})]})}),e.jsx(P,{control:h.control,name:"remarkAdmin",render:({field:i})=>e.jsxs(A,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(F,{className:"text-right pt-2",children:n("features.order.form.remarkAdmin")}),e.jsx(M,{children:e.jsx(ze,{placeholder:n("features.order.form.remarkAdminPlaceholder"),className:"min-h-[80px] resize-y",...i})}),e.jsx(L,{className:"col-start-2"})]})}),e.jsx(P,{control:h.control,name:"status",render:({field:i})=>e.jsxs(A,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(F,{className:"text-right",children:n("features.order.form.status")}),e.jsxs(Z,{value:String(i.value),onValueChange:g=>i.onChange(Number(g)),children:[e.jsx(M,{children:e.jsx(ee,{children:e.jsx(re,{placeholder:n("features.order.filter.status")})})}),e.jsxs(se,{children:[e.jsx(p,{value:"1",children:n("features.order.status.1")}),e.jsx(p,{value:"2",children:n("features.order.status.2")}),e.jsx(p,{value:"3",children:n("features.order.status.3")})]})]}),e.jsx(L,{className:"col-start-2"})]})}),e.jsxs(qe,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>o(!1),disabled:a,children:n("features.order.form.cancel")}),e.jsx(I,{type:"submit",disabled:a,children:n(a?"features.order.form.saving":"features.order.form.save")})]})]})})]})})}function f({title:r,children:o}){return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-1 shrink-0 rounded-full bg-foreground/80"}),e.jsx("span",{className:"text-sm font-semibold",children:r})]}),e.jsx("div",{className:"rounded-lg border bg-card p-4 space-y-0 shadow-sm",children:o})]})}function c({label:r,value:o}){return e.jsxs("div",{className:"grid grid-cols-[100px_1fr] gap-4 py-2.5 border-b border-border/50 last:border-0 items-start",children:[e.jsx("span",{className:"text-sm text-muted-foreground shrink-0 pt-0.5",children:r}),e.jsx("span",{className:"text-sm break-words min-w-0",children:o??"-"})]})}function Ge({open:r,onOpenChange:o,orderID:d}){const{t}=q(),{data:a,isLoading:n,error:b}=V({queryKey:["orderDetail",d],queryFn:()=>He(d),enabled:r&&!!d}),{data:h}=V({queryKey:["orderLog",d],queryFn:()=>Be(d),enabled:r&&!!d}),j=h?.orderLogs??[],i=a?t(`features.order.payStatus.${a.payStatus}`):"",g=a?t(`features.order.payMethod.${a.payMethod}`):"";return e.jsx(te,{open:r,onOpenChange:o,children:e.jsxs(ae,{className:"sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(le,{children:e.jsx(oe,{className:"sr-only",children:t("features.order.detail.title")})}),n&&e.jsx("div",{className:"py-12 text-center text-muted-foreground text-sm",children:t("features.order.loading")}),b&&e.jsx("div",{className:"py-12 text-center text-destructive text-sm",children:t("features.order.loadError")}),a&&!n&&e.jsxs("div",{className:"flex flex-col min-h-0 overflow-y-auto",children:[e.jsxs("div",{className:"rounded-lg border bg-muted/40 p-5 space-y-4 mb-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(ve,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base font-semibold leading-tight",children:a.productName||"-"}),e.jsxs("p",{className:"mt-1.5 text-sm text-muted-foreground font-mono",children:[t("features.order.columns.orderNumber"),"：",a.orderNumber]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-x-6 gap-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:t("features.order.columns.status")}),e.jsx("p",{className:"font-medium mt-0.5",children:i})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:t("features.order.detail.amountPay")}),e.jsxs("p",{className:"font-medium mt-0.5",children:["¥",a.amountPay??a.unitPrice??0]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:t("features.order.detail.payMethodLabel")}),e.jsx("p",{className:"font-medium mt-0.5",children:g})]}),a.payTime?e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:t("features.order.detail.payTime")}),e.jsx("p",{className:"font-medium mt-0.5",children:a.payTime.slice(0,19)})]}):null]})]}),e.jsxs(Ee,{defaultValue:"orderInfo",className:"flex-1 min-h-0 flex flex-col pt-1",children:[e.jsxs(Ke,{className:"w-full grid grid-cols-3",children:[e.jsx(_,{value:"orderInfo",children:t("features.order.detail.tabOrderInfo")}),e.jsx(_,{value:"productInfo",children:t("features.order.detail.tabProductInfo")}),e.jsx(_,{value:"orderLog",children:t("features.order.detail.tabOrderLog")})]}),e.jsxs(O,{value:"orderInfo",className:"mt-4 space-y-4 flex-1 overflow-y-auto",children:[e.jsxs(f,{title:t("features.order.detail.userInfo"),children:[e.jsx(c,{label:t("features.order.detail.userName"),value:a.user?.nickname||a.username||a.userID}),e.jsx(c,{label:t("features.order.detail.email"),value:a.user?.email})]}),e.jsxs(f,{title:t("features.order.detail.consigneeInfo"),children:[e.jsx(c,{label:t("features.order.detail.consigneeName"),value:a.consigneeName}),e.jsx(c,{label:t("features.order.detail.consigneePhone"),value:a.consigneePhone}),e.jsx(c,{label:t("features.order.detail.consigneeAddress"),value:a.consigneeAddress})]}),e.jsxs(f,{title:t("features.order.detail.orderInfo"),children:[e.jsx(c,{label:t("features.order.detail.createdAt"),value:a.createdAt?a.createdAt.slice(0,19):void 0}),e.jsx(c,{label:t("features.order.detail.totalQuantity"),value:String(a.quantity)}),e.jsx(c,{label:t("features.order.detail.totalAmount"),value:a.amount}),e.jsx(c,{label:t("features.order.detail.amountPay"),value:a.amountPay??a.unitPrice})]}),e.jsxs(f,{title:t("features.order.detail.logisticsInfo"),children:[e.jsx(c,{label:t("features.order.detail.logisticsCompany"),value:a.logisticsCompany}),e.jsx(c,{label:t("features.order.detail.logisticsNumber"),value:a.logisticsNumber})]}),e.jsx(f,{title:t("features.order.detail.buyerRemark"),children:e.jsx("div",{className:"py-2 text-sm",children:a.remark||"-"})}),e.jsx(f,{title:t("features.order.detail.orderRemark"),children:e.jsx("div",{className:"py-2 text-sm",children:a.remarkAdmin||"-"})})]}),e.jsxs(O,{value:"productInfo",className:"mt-4 space-y-4",children:[e.jsx(f,{title:t("features.order.detail.productName"),children:e.jsx("div",{className:"py-2 text-sm",children:a.productName||"-"})}),a.productImage&&e.jsx(f,{title:t("features.order.detail.productImage"),children:e.jsx("div",{className:"flex flex-wrap gap-2 py-2",children:a.productImage.split(",").map((m,k)=>e.jsx("img",{src:m.trim(),alt:"",className:"h-20 w-20 rounded object-cover border"},k))})}),e.jsxs(f,{title:t("features.order.detail.sku"),children:[e.jsx(c,{label:t("features.order.detail.sku"),value:a.productSku}),e.jsx(c,{label:t("features.order.detail.unitPrice"),value:a.unitPrice}),e.jsx(c,{label:t("features.order.detail.quantity"),value:String(a.quantity)})]})]}),e.jsx(O,{value:"orderLog",className:"mt-4",children:e.jsx(f,{title:t("features.order.detail.tabOrderLog"),children:j.length===0?e.jsx("div",{className:"py-4 text-center text-muted-foreground text-sm",children:t("features.order.noData")}):e.jsx("div",{className:"space-y-0",children:j.map(m=>e.jsx(c,{label:m.createdAt?m.createdAt.slice(0,19):"-",value:m.remark},m.orderLogID))})})})]})]})]})})}function We(){"use no memo";const{t:r}=q(),[o,d]=u.useState([]),[t,a]=u.useState({pageIndex:0,pageSize:10}),[n,b]=u.useState([]),[h,j]=u.useState({}),[i,g]=u.useState(),[m,k]=u.useState(""),[S,ne]=u.useState(""),[N,ie]=u.useState("all"),[z,E]=u.useState(null),[K,$]=u.useState(null),de=je(),H=Ne({mutationFn:({orderID:s,data:l})=>Qe(s,l),onSuccess:()=>{ye.success(r("features.order.updateSuccess")),de.invalidateQueries({queryKey:["orderList"]})}});u.useEffect(()=>{a(s=>s.pageIndex===0?s:{...s,pageIndex:0})},[m,S,N,i]);const B=u.useMemo(()=>{const s=m.trim()||void 0,l=S.trim()||void 0;return{orderNumber:s,userID:l,startTime:i?.from?Y(i.from,"yyyy-MM-dd"):void 0,endTime:i?.to?Y(i.to,"yyyy-MM-dd"):void 0,status:N==="all"?void 0:N,pageNum:t.pageIndex+1,pageSize:t.pageSize}},[m,S,N,t,i]),{data:Q,isLoading:ce,error:ue}=V({queryKey:["orderList",B],queryFn:()=>$e(B),placeholderData:be}),me=Q?.orders??[],xe=Q?.total??0,he=Math.ceil(xe/t.pageSize),D=u.useMemo(()=>[{accessorKey:"orderID",header:({column:s})=>e.jsx(y,{column:s,title:r("features.order.columns.orderID")}),cell:({row:s})=>e.jsx("div",{className:"font-mono text-muted-foreground text-sm",children:s.getValue("orderID")})},{accessorKey:"orderNumber",header:({column:s})=>e.jsx(y,{column:s,title:r("features.order.columns.orderNumber")}),cell:({row:s})=>e.jsx("div",{className:"font-mono text-muted-foreground text-sm whitespace-nowrap",children:s.getValue("orderNumber")})},{id:"user",header:r("features.order.columns.user"),cell:({row:s})=>{const l=s.original,x=l.user?.nickname||l.username||l.userID;return e.jsx("div",{className:"max-w-[120px] truncate text-muted-foreground",title:String(x),children:x})}},{id:"product",header:r("features.order.columns.product"),cell:({row:s})=>{const l=s.original,x=l.productImage?.split(",")[0]?.trim();return e.jsxs("div",{className:"flex items-center gap-2 max-w-[220px]",children:[x?e.jsx("img",{src:x,alt:"",className:"h-10 w-10 rounded object-cover shrink-0"}):null,e.jsx("span",{className:"truncate text-sm",title:l.productName,children:l.productName||"-"})]})}},{accessorKey:"amountPay",header:({column:s})=>e.jsx(y,{column:s,title:r("features.order.columns.amountPay")}),cell:({row:s})=>e.jsxs("div",{className:"font-medium",children:["¥",s.getValue("amountPay")??s.original.amount??0]})},{accessorKey:"status",header:({column:s})=>e.jsx(y,{column:s,title:r("features.order.columns.status")}),cell:({row:s})=>{const l=s.getValue("status"),x=r(`features.order.status.${l}`)||String(l),fe=l===1?"secondary":l===2?"default":"outline";return e.jsx(J,{variant:fe,children:x})}},{accessorKey:"payStatus",header:({column:s})=>e.jsx(y,{column:s,title:r("features.order.columns.payStatus")}),cell:({row:s})=>{const l=s.getValue("payStatus"),x=r(`features.order.payStatus.${l}`)||String(l);return e.jsx(J,{variant:l===1?"default":"secondary",children:x})}},{accessorKey:"createdAt",header:({column:s})=>e.jsx(y,{column:s,title:r("features.order.columns.createdAt")}),cell:({row:s})=>e.jsx("div",{className:"text-muted-foreground whitespace-nowrap",children:s.getValue("createdAt")?String(s.getValue("createdAt")).slice(0,19):"-"})},{id:"actions",header:r("features.order.columns.actions"),cell:({row:s})=>{const l=s.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{children:[e.jsx(W,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>$(l.orderID),children:e.jsx(Se,{className:"h-4 w-4"})})}),e.jsx(X,{children:r("features.order.actions.view")})]}),e.jsxs(G,{children:[e.jsx(W,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>E(l),children:e.jsx(De,{className:"h-4 w-4"})})}),e.jsx(X,{children:r("features.order.actions.edit")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[r]),w=we({data:me,columns:D,getCoreRowModel:Ie(),getSortedRowModel:Ce(),manualPagination:!0,pageCount:he,onSortingChange:b,onColumnFiltersChange:d,onColumnVisibilityChange:j,onPaginationChange:a,state:{sorting:n,columnFilters:o,columnVisibility:h,pagination:t}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(Te,{title:r("features.order.title"),description:r("features.order.description")})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx(R,{type:"text",placeholder:r("features.order.search.orderNumber"),value:m,onChange:s=>k(s.target.value),className:"h-8 w-[180px]"}),e.jsx(R,{type:"text",placeholder:r("features.order.search.userID"),value:S,onChange:s=>ne(s.target.value),className:"h-8 w-[140px]"}),e.jsx(Le,{selected:i,onSelect:g,placeholder:`${r("features.order.search.startTime")} ~ ${r("features.order.search.endTime")}`}),e.jsxs(Z,{value:N,onValueChange:ie,children:[e.jsx(ee,{className:"h-8 w-[140px]",children:e.jsx(re,{placeholder:r("features.order.filter.status")})}),e.jsxs(se,{children:[e.jsx(p,{value:"all",children:r("features.order.search.statusAll")}),e.jsx(p,{value:"1",children:r("features.order.status.1")}),e.jsx(p,{value:"2",children:r("features.order.status.2")}),e.jsx(p,{value:"3",children:r("features.order.status.3")})]})]})]})}),e.jsxs(ke,{children:[e.jsx(Pe,{children:w.getHeaderGroups().map(s=>e.jsx(v,{children:s.headers.map(l=>{const x=l.isPlaceholder?null:typeof l.column.columnDef.header=="function"?l.column.columnDef.header(l.getContext()):l.column.columnDef.header;return e.jsx(Ae,{children:x},l.id)})},s.id))}),e.jsx(Fe,{children:ce?e.jsx(v,{children:e.jsx(C,{colSpan:D.length,className:"h-24 text-center",children:r("features.order.loading")})}):ue?e.jsx(v,{children:e.jsx(C,{colSpan:D.length,className:"h-24 text-center text-destructive",children:r("features.order.loadError")})}):w.getRowModel().rows?.length?w.getRowModel().rows.map(s=>e.jsx(v,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(l=>{const x=typeof l.column.columnDef.cell=="function"?l.column.columnDef.cell(l.getContext()):l.column.columnDef.cell;return e.jsx(C,{children:x},l.id)})},s.id)):e.jsx(v,{children:e.jsx(C,{colSpan:D.length,className:"h-24 text-center",children:r("features.order.noData")})})})]}),e.jsx(Me,{table:w})]}),e.jsx(Ge,{open:K!==null,onOpenChange:s=>{s||$(null)},orderID:K}),e.jsx(Je,{open:z!==null,onOpenChange:s=>{s||E(null)},order:z,onSubmit:async(s,l)=>{await H.mutateAsync({orderID:s,data:{amountPay:l.amountPay,remarkAdmin:l.remarkAdmin,status:l.status}})},isLoading:H.isPending})]})}const wr=We;export{wr as component};
