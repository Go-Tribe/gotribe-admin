import{r as l,j as e,B as T,f as ue,a as fe,A as Se,J as V,C as k,l as Me,t as te}from"./index-Pe1Nv6hH.js";import{u as de}from"./useQuery-DDON36P9.js";import{u as ne}from"./useMutation-uvHqRPk1.js";import{T as he,v as xe,w as pe}from"./sidebar-BFSPGCEL.js";import{P as De,T as we,u as Ie,d as Pe,g as Te,c as Ee,b as _e}from"./react-icons.esm-CiMB90YA.js";import{S as Fe}from"./index-BmISbovJ.js";import{D as C,T as Ve,a as ke,b as q,c as Ke,d as Re,e as Q}from"./column-header-Cfszq_dp.js";import{B as re}from"./badge-T19Q3klL.js";import{g as ae}from"./status-variants-Dh7YK7JP.js";import{C as qe}from"./confirm-dialog-DmDS_GmK.js";import{u as Le,a as Be,F as ze,b as j,c as y,d as N,e as b,g as R,f as v}from"./form-DU65aaqX.js";import{D as Oe,a as Qe,b as He,c as Ae,d as We,e as $e}from"./dialog-DHifiqsD.js";import{I as P}from"./input-DW-mBlUw.js";import{S as H,a as A,b as W,c as $,d as I}from"./select-Dl4KSF7A.js";import{I as L}from"./lucide-react-CbGgxz8s.js";import{P as Ge,a as Je,b as Ue}from"./popover-CrxLZKyN.js";import{S as Xe}from"./scroll-area-BCr0FWtA.js";import{S as Ye}from"./search-DNOmmJ4K.js";import{X as Ze}from"./index-D68Ta3NN.js";import{C as es}from"./chevron-left-BrCT33MH.js";import{C as ge}from"./chevron-right-COcvBQ44.js";import{c as ss,u as ts,b as ns,g as rs,a as as}from"./menu-B3WTQ4n5.js";import{C as cs}from"./index-4GH7Kv3S.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-SpxnGYUf.js";import"./index-C8jai3VV.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-BDzuQ5ZL.js";import"./index-DGhUbGt9.js";import"./plus-w5piNt_B.js";import"./unlink-DFLq-BTp.js";import"./calendar-DTRwY1QY.js";import"./chevrons-up-down-BrdDDp5G.js";import"./pencil-G2ARerfI.js";import"./eye-TW5NDUHo.js";import"./users-CLYLL3Ez.js";import"./upload-CE8x_1SM.js";import"./folder-cog-CGOOjEf3.js";import"./image-D4KB7jNL.js";import"./log-in-Cf3mpVom.js";import"./loader-circle-DjNfctPA.js";import"./minus-BV34uZJO.js";import"./settings-CTuF3-1m.js";import"./trash-2-DxKhJZhR.js";import"./user-cog-CLQhVDGu.js";import"./video-Bs8fCpLF.js";import"./wand-sparkles-DDvxT50Q.js";const ls=()=>{const r=[],p=new Set(["createLucideIcon","IconNode","Icon","IconProps","LucideProps","LucideIcon","default"]);for(const c in L){const x=L[c],f=x!=null&&typeof x=="object"&&("$$typeof"in x||typeof x=="function");!p.has(c)&&!c.endsWith("Icon")&&c[0]===c[0].toUpperCase()&&!c.startsWith("_")&&f&&r.push(c)}return r.sort()},ce=100;function os({value:r,onValueChange:p,placeholder:c="选择图标",className:x}){const[f,M]=l.useState(!1),[t,h]=l.useState(""),[D,o]=l.useState(1),w=l.useMemo(()=>ls(),[]),a=r&&r in L?L[r]:null,u=l.useMemo(()=>{if(!t)return w;const m=t.toLowerCase();return w.filter(S=>S.toLowerCase().includes(m))},[t,w]);l.useEffect(()=>{o(1)},[t]);const K=Math.ceil(u.length/ce),B=(D-1)*ce,G=B+ce,J=u.slice(B,G),U=m=>{p?.(m),M(!1),h(""),o(1)},E=()=>{o(m=>Math.max(1,m-1))},X=()=>{o(m=>Math.min(K,m+1))};return e.jsxs(Ge,{open:f,onOpenChange:m=>{M(m),m||(h(""),o(1))},children:[e.jsx(Je,{asChild:!0,children:e.jsx(T,{variant:"outline",role:"combobox","aria-expanded":f,className:ue("w-full justify-between",x),children:e.jsx("div",{className:"flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[l.createElement(a,{className:"h-4 w-4"}),e.jsx("span",{className:"truncate",children:r})]}):e.jsx("span",{className:"text-muted-foreground",children:c})})})}),e.jsxs(Ue,{className:"w-[500px] p-0",align:"start",onWheel:m=>{m.stopPropagation()},children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[l.createElement(Ye,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{type:"text",placeholder:"搜索图标...",value:t,onChange:m=>h(m.target.value),className:"pl-8",autoFocus:!0}),t&&e.jsx("button",{type:"button",onClick:()=>h(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground","aria-label":"清除搜索",children:l.createElement(Ze,{className:"h-4 w-4"})})]})}),e.jsx(Xe,{className:"h-[280px]",children:u.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-10 gap-2 p-3",children:J.map(m=>{const S=L[m];if(!S)return null;const _=r===m;return e.jsx("button",{type:"button",onClick:()=>U(m),className:ue("flex h-10 w-10 items-center justify-center rounded-md border transition-colors cursor-pointer",_?"bg-accent border-primary text-primary":"border-border hover:bg-accent hover:border-primary/50"),title:m,children:l.createElement(S,{className:"h-4 w-4"})},m)})}),K>1&&e.jsxs("div",{className:"flex items-center justify-between border-t px-4 py-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["第 ",D," / ",K," 页，共 ",u.length," 个图标"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{variant:"outline",size:"sm",onClick:E,disabled:D===1,className:"h-8 w-8 p-0",children:l.createElement(es,{className:"h-4 w-4"})}),e.jsx(T,{variant:"outline",size:"sm",onClick:X,disabled:D===K,className:"h-8 w-8 p-0",children:l.createElement(ge,{className:"h-4 w-4"})})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-[280px] text-muted-foreground",children:e.jsx("p",{children:"未找到匹配的图标"})})})]})]})}const is=r=>Se({title:k().min(1,r("features.system.menu.form.validation.titleRequired")),name:k().min(1,r("features.system.menu.form.validation.nameRequired")),icon:k().optional(),path:k().min(1,r("features.system.menu.form.validation.pathRequired")),component:k().optional(),redirect:k().optional(),sort:V().int().min(1,r("features.system.menu.form.validation.sortRequired")),status:V().min(1).max(2),hidden:V().min(1).max(2),noCache:V().min(1).max(2),activeMenu:k().optional(),parentID:V().optional(),alwaysShow:V().min(1).max(2),breadcrumb:V().min(1).max(2)});function ms({open:r,onOpenChange:p,menu:c,onSubmit:x,isLoading:f=!1,parentMenus:M=[]}){const{t}=fe(),h=!!c,D=l.useMemo(()=>is(t),[t]),o=Le({resolver:Be(D),defaultValues:{title:"",name:"",icon:"",path:"",component:"",redirect:"",sort:1,status:1,hidden:2,noCache:2,activeMenu:"",parentID:void 0,alwaysShow:2,breadcrumb:1}});l.useEffect(()=>{r&&(h&&c?o.reset({title:c.title,name:c.name,icon:c.icon||"",path:c.path,component:c.component||"",redirect:c.redirect||"",sort:c.sort,status:c.status,hidden:c.hidden,alwaysShow:2,breadcrumb:c.breadcrumb??1,noCache:c.noCache,activeMenu:c.activeMenu||"",parentID:c.parentID||void 0}):o.reset({title:"",name:"",icon:"",path:"",component:"",redirect:"",sort:1,status:1,hidden:2,alwaysShow:2,noCache:2,activeMenu:"",parentID:void 0,breadcrumb:1}))},[r,h,c,o]);const w=a=>{x({...a,parentID:a.parentID||0})};return e.jsx(Oe,{open:r,onOpenChange:p,children:e.jsxs(Qe,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(He,{className:"shrink-0",children:[e.jsx(Ae,{children:t(h?"features.system.menu.form.editTitle":"features.system.menu.form.createTitle")}),e.jsx(We,{children:t(h?"features.system.menu.form.editDescription":"features.system.menu.form.createDescription")})]}),e.jsx(ze,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(w),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(j,{control:o.control,name:"parentID",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.parentMenu")}),e.jsxs(H,{onValueChange:u=>a.onChange(u==="none"?void 0:Number(u)),value:a.value?String(a.value):"none",children:[e.jsx(b,{children:e.jsx(A,{children:e.jsx(W,{placeholder:t("features.system.menu.form.parentMenuPlaceholder")})})}),e.jsxs($,{children:[e.jsx(I,{value:"none",children:t("features.system.menu.form.noParentMenu")}),M.map(u=>e.jsx(I,{value:String(u.id),children:u.title},u.id))]})]}),e.jsx(R,{className:"col-start-2",children:t("features.system.menu.form.parentMenuDescription")}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"title",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.menuTitle")}),e.jsx(b,{children:e.jsx(P,{placeholder:t("features.system.menu.form.titlePlaceholder"),...a})}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"name",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.name")}),e.jsx(b,{children:e.jsx(P,{placeholder:t("features.system.menu.form.namePlaceholder"),...a})}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"icon",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.icon")}),e.jsx(b,{children:e.jsx(os,{value:a.value,onValueChange:a.onChange,placeholder:t("features.system.menu.form.iconPlaceholder")})}),e.jsx(R,{className:"col-start-2",children:t("features.system.menu.form.iconDescription")}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"path",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.path")}),e.jsx(b,{children:e.jsx(P,{placeholder:t("features.system.menu.form.pathPlaceholder"),...a})}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"component",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.component")}),e.jsx(b,{children:e.jsx(P,{placeholder:t("features.system.menu.form.componentPlaceholder"),...a})}),e.jsx(R,{className:"col-start-2",children:t("features.system.menu.form.componentDescription")}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"redirect",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.redirect")}),e.jsx(b,{children:e.jsx(P,{placeholder:t("features.system.menu.form.redirectPlaceholder"),...a})}),e.jsx(R,{className:"col-start-2",children:t("features.system.menu.form.redirectDescription")}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"activeMenu",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.activeMenu")}),e.jsx(b,{children:e.jsx(P,{placeholder:t("features.system.menu.form.activeMenuPlaceholder"),...a})}),e.jsx(R,{className:"col-start-2",children:t("features.system.menu.form.activeMenuDescription")}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"sort",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.sort")}),e.jsx(b,{children:e.jsx(P,{type:"number",min:1,max:99,placeholder:t("features.system.menu.form.sortPlaceholder"),...a,onChange:u=>a.onChange(Number(u.target.value))})}),e.jsx(R,{className:"col-start-2",children:t("features.system.menu.form.sortDescription")}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"noCache",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.cache")}),e.jsxs(H,{onValueChange:u=>a.onChange(Number(u)),value:String(a.value),children:[e.jsx(b,{children:e.jsx(A,{children:e.jsx(W,{placeholder:t("features.system.menu.form.cachePlaceholder")})})}),e.jsxs($,{children:[e.jsx(I,{value:"1",children:t("features.system.menu.noCache")}),e.jsx(I,{value:"2",children:t("features.system.menu.cached")})]})]}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"status",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.status")}),e.jsxs(H,{onValueChange:u=>a.onChange(Number(u)),value:String(a.value),children:[e.jsx(b,{children:e.jsx(A,{children:e.jsx(W,{placeholder:t("features.system.menu.form.statusPlaceholder")})})}),e.jsxs($,{children:[e.jsx(I,{value:"1",children:t("features.system.menu.enabled")}),e.jsx(I,{value:"2",children:t("features.system.menu.disabled")})]})]}),e.jsx(v,{className:"col-start-2"})]})}),e.jsx(j,{control:o.control,name:"hidden",render:({field:a})=>e.jsxs(y,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(N,{className:"text-right",children:t("features.system.menu.hidden")}),e.jsxs(H,{onValueChange:u=>a.onChange(Number(u)),value:String(a.value),children:[e.jsx(b,{children:e.jsx(A,{children:e.jsx(W,{placeholder:t("features.system.menu.form.hiddenPlaceholder")})})}),e.jsxs($,{children:[e.jsx(I,{value:"1",children:t("features.system.menu.hidden")}),e.jsx(I,{value:"2",children:t("features.system.menu.visible")})]})]}),e.jsx(v,{className:"col-start-2"})]})})]})}),e.jsxs($e,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(T,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:f,children:t("features.system.menu.form.cancel")}),e.jsx(T,{type:"button",disabled:f,onClick:o.handleSubmit(w),children:t(f?"features.system.menu.form.submitting":h?"features.system.menu.form.save":"features.system.menu.form.create")})]})]})})}function us(){const{t:r}=fe(),p=Me(),[c,x]=l.useState(null),[f,M]=l.useState(null),[t,h]=l.useState(null),[D,o]=l.useState([]),[w,a]=l.useState({pageIndex:0,pageSize:10}),[u,K]=l.useState([]),[B,G]=l.useState({}),[J,U]=l.useState({}),{data:E,isLoading:X,error:m}=de({queryKey:["menuList"],queryFn:()=>rs()}),{data:S}=de({queryKey:["menuTree"],queryFn:()=>as()}),_=l.useMemo(()=>{if(!E?.menus||E.menus.length===0)return[];const s=new Map,n=[];return E.menus.forEach(i=>{s.set(i.id,{...i,children:[]})}),E.menus.forEach(i=>{const d=s.get(i.id);if(i.parentID===0||!i.parentID)n.push(d);else{const g=s.get(i.parentID);g?(g.children||(g.children=[]),g.children.push(d)):n.push(d)}}),n},[E?.menus]),z=l.useMemo(()=>S?.menus&&S.menus.length>0?S.menus:_,[S?.menus,_]),Y=l.useCallback(s=>{const n=[];return s.forEach(i=>{n.push(i),i.children&&i.children.length>0&&n.push(...Y(i.children))}),n},[]),je=l.useMemo(()=>Y(_),[_,Y]),O=l.useMemo(()=>[{accessorKey:"title",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.menuTitle")}),cell:({row:s})=>{const n=s.getCanExpand(),i=s.getIsExpanded(),d=s.depth;return e.jsxs("div",{className:"flex items-center gap-2 font-medium",style:{paddingLeft:`${d*20}px`},children:[n&&e.jsx("button",{onClick:g=>{g.stopPropagation(),s.toggleExpanded()},className:"flex items-center justify-center w-4 h-4 hover:bg-accent rounded",children:i?e.jsx(cs,{className:"h-4 w-4"}):e.jsx(ge,{className:"h-4 w-4"})}),!n&&e.jsx("div",{className:"w-4"}),e.jsx("span",{children:s.getValue("title")})]})}},{accessorKey:"name",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.name")}),cell:({row:s})=>e.jsx("div",{children:s.getValue("name")})},{accessorKey:"icon",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.icon")}),cell:({row:s})=>{const n=s.getValue("icon");return e.jsx("div",{className:"max-w-[100px] truncate",title:n,children:n||"-"})}},{accessorKey:"path",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.path")}),cell:({row:s})=>{const n=s.getValue("path");return e.jsx("div",{className:"max-w-[150px] truncate",title:n,children:n||"-"})}},{accessorKey:"component",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.component")}),cell:({row:s})=>{const n=s.getValue("component");return e.jsx("div",{className:"max-w-[150px] truncate",title:n,children:n||"-"})}},{accessorKey:"redirect",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.redirect")}),cell:({row:s})=>{const n=s.getValue("redirect");return e.jsx("div",{className:"max-w-[150px] truncate",title:n||"",children:n||"-"})}},{accessorKey:"sort",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.sort")}),cell:({row:s})=>e.jsx("div",{children:s.getValue("sort")})},{accessorKey:"status",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.status")}),cell:({row:s})=>{const n=s.getValue("status");return e.jsx(re,{variant:ae(n,"enabledStatus"),children:r(n===1?"features.system.menu.enabled":"features.system.menu.disabled")})}},{accessorKey:"hidden",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.hidden")}),cell:({row:s})=>{const n=s.getValue("hidden");return e.jsx(re,{variant:ae(n,"visibilityInverse"),children:r(n===1?"features.system.menu.hidden":"features.system.menu.visible")})}},{accessorKey:"noCache",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.cache")}),cell:({row:s})=>{const n=s.getValue("noCache");return e.jsx(re,{variant:ae(n,"visibilityInverse"),children:r(n===1?"features.system.menu.noCache":"features.system.menu.cached")})}},{accessorKey:"activeMenu",header:({column:s})=>e.jsx(C,{column:s,title:r("features.system.menu.activeMenu")}),cell:({row:s})=>{const n=s.getValue("activeMenu");return e.jsx("div",{className:"max-w-[150px] truncate",title:n||"",children:n||"-"})}},{id:"actions",header:r("features.system.menu.actions"),cell:({row:s})=>{const n=s.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>{h(n),x("edit")},children:e.jsx(De,{className:"h-4 w-4"})})}),e.jsx(pe,{children:r("features.system.menu.edit")})]}),e.jsxs(he,{children:[e.jsx(xe,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>M(n.id),children:e.jsx(we,{className:"h-4 w-4 text-destructive"})})}),e.jsx(pe,{children:r("features.system.menu.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[r]),Z=Ie({data:_,columns:O,getCoreRowModel:Ee(),getSortedRowModel:Te(),getExpandedRowModel:Pe(),getSubRows:s=>s.children,onExpandedChange:U,onSortingChange:K,onColumnFiltersChange:o,onColumnVisibilityChange:G,onPaginationChange:a,state:{expanded:J,sorting:u,columnFilters:D,columnVisibility:B,pagination:w}}),le=ne({mutationFn:s=>ss(s),onSuccess:()=>{te.success(r("features.system.menu.createSuccess")),p.invalidateQueries({queryKey:["menuList"]}),p.invalidateQueries({queryKey:["menuTree"]}),x(null),h(null)},onError:()=>{}}),oe=ne({mutationFn:s=>ts(s.id,s),onSuccess:()=>{te.success(r("features.system.menu.updateSuccess")),p.invalidateQueries({queryKey:["menuList"]}),p.invalidateQueries({queryKey:["menuTree"]}),x(null),h(null)},onError:()=>{}}),ie=ne({mutationFn:s=>ns({menuIds:[s]}),onSuccess:()=>{te.success(r("features.system.menu.deleteSuccess")),p.invalidateQueries({queryKey:["menuList"]}),p.invalidateQueries({queryKey:["menuTree"]}),M(null)}}),ye=()=>{h(null),x("create")},Ne=s=>{c==="create"?le.mutate(s):c==="edit"&&t&&oe.mutate({...s,id:t.id})},be=()=>{f&&ie.mutate(f)},ve=je.find(s=>s.id===f),ee=l.useCallback(s=>{const n=[s.id];return s.children&&s.children.length>0&&s.children.forEach(i=>{n.push(...ee(i))}),n},[]),se=l.useCallback((s,n=null,i=0,d=[])=>{const g=[];return s.forEach(F=>{d.includes(F.id)||F.children&&F.children.length>0&&(g.push({id:F.id,title:F.title,parentID:n,level:i}),g.push(...se(F.children,F.id,i+1,d)))}),g},[]),me=l.useMemo(()=>{if(!t)return[];const s=i=>{for(const d of i){if(d.id===t.id)return d;if(d.children&&d.children.length>0){const g=s(d.children);if(g)return g}}return null},n=s(z);return n?ee(n):[t.id]},[t,z,ee]),Ce=l.useMemo(()=>se(z,null,0,me).map(s=>({id:s.id,title:"  ".repeat(s.level)+s.title,parentID:s.parentID})),[z,me,se]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(Fe,{title:r("features.system.menu.title"),description:r("features.system.menu.description"),children:e.jsxs(T,{onClick:ye,children:[e.jsx(_e,{className:"h-4 w-4"}),r("features.system.menu.createButton")]})})}),e.jsx("div",{className:"rounded-md border p-6 mx-4",children:e.jsxs(Ve,{children:[e.jsx(ke,{children:Z.getHeaderGroups().map(s=>e.jsx(q,{children:s.headers.map(n=>{const i=n.isPlaceholder?null:typeof n.column.columnDef.header=="function"?n.column.columnDef.header(n.getContext()):n.column.columnDef.header,d=n.column.columnDef.meta;return e.jsx(Ke,{className:d?.thClassName||d?.className,children:i},n.id)})},s.id))}),e.jsx(Re,{children:X?e.jsx(q,{children:e.jsx(Q,{colSpan:O.length,className:"h-24 text-center",children:r("features.system.menu.loading")})}):m?e.jsx(q,{children:e.jsx(Q,{colSpan:O.length,className:"h-24 text-center text-destructive",children:r("features.system.menu.loadError")})}):Z.getRowModel().rows?.length?Z.getRowModel().rows.map(s=>e.jsx(q,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(n=>{const i=typeof n.column.columnDef.cell=="function"?n.column.columnDef.cell(n.getContext()):n.column.columnDef.cell,d=n.column.columnDef.meta;return e.jsx(Q,{className:d?.tdClassName||d?.className,children:i},n.id)})},s.id)):e.jsx(q,{children:e.jsx(Q,{colSpan:O.length,className:"h-24 text-center",children:r("features.system.menu.noData")})})})]})}),e.jsx(ms,{open:c!==null,onOpenChange:s=>{s||(x(null),h(null))},menu:t,onSubmit:Ne,isLoading:c==="create"?le.isPending:oe.isPending,parentMenus:Ce}),e.jsx(qe,{open:f!==null,onOpenChange:s=>{s||M(null)},title:r("features.system.menu.confirmDelete"),desc:r("features.system.menu.confirmDeleteMessage",{title:ve?.title}),handleConfirm:be,destructive:!0,confirmText:r("features.system.menu.delete"),isLoading:ie.isPending})]})}const at=us;export{at as component};
