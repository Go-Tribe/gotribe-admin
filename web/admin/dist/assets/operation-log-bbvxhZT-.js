import{m as P,a as R,r as l,j as t,K as I}from"./index-Pe1Nv6hH.js";import{u as z}from"./useQuery-DDON36P9.js";import{u as H,g as O,c as q}from"./react-icons.esm-CiMB90YA.js";import{I as h}from"./input-DW-mBlUw.js";import{D as B}from"./faceted-filter-BDTVtMjs.js";import{S as E}from"./index-BmISbovJ.js";import{D as r,T as A,a as k,b as u,c as Q,d as U,e as p}from"./column-header-Cfszq_dp.js";import{D as G}from"./pagination-B86K5cVv.js";import{B as J}from"./badge-T19Q3klL.js";import{a as W}from"./status-variants-Dh7YK7JP.js";import"./command-D9eDedTW.js";import"./index-D68Ta3NN.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-SpxnGYUf.js";import"./index-DGhUbGt9.js";import"./dialog-DHifiqsD.js";import"./search-DNOmmJ4K.js";import"./popover-CrxLZKyN.js";import"./index-C8jai3VV.js";import"./separator-Bq1fgMtF.js";import"./sidebar-BFSPGCEL.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-4GH7Kv3S.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./select-Dl4KSF7A.js";const X=async o=>P.get("/api/log/operation/list",{params:o});function Y(){const{t:o}=R(),[d,j]=l.useState([]),[n,C]=l.useState({pageIndex:0,pageSize:10}),[y,v]=l.useState([]),[L,b]=l.useState({}),x=l.useMemo(()=>{const e=K=>{const g=d.find(M=>M.id===K);return g?.value&&Array.isArray(g.value)?g.value[0]||"":g?.value||""},a=e("username"),i=e("ip"),c=e("path"),w=e("status");return{current:1,username:a,ip:i,path:c,status:w,pageNum:n.pageIndex+1,pageSize:n.pageSize}},[d,n]),{data:f,isPending:N,error:S}=z({queryKey:["logList",x],queryFn:()=>X(x),placeholderData:I}),D=f?.logs||[],V=f?.total||0,F=Math.ceil(V/n.pageSize),T=e=>{try{return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return e}},m=l.useMemo(()=>[{accessorKey:"username",header:({column:e})=>t.jsx(r,{column:e,title:o("features.log.operationLog.username")}),cell:({row:e})=>t.jsx("div",{className:"font-medium",children:e.getValue("username")})},{accessorKey:"ip",header:({column:e})=>t.jsx(r,{column:e,title:o("features.log.operationLog.ip")}),cell:({row:e})=>t.jsx("div",{children:e.getValue("ip")})},{accessorKey:"path",header:({column:e})=>t.jsx(r,{column:e,title:o("features.log.operationLog.path")}),cell:({row:e})=>{const a=e.getValue("path");return t.jsx("div",{className:"max-w-[200px] truncate",title:a,children:a})}},{accessorKey:"status",header:({column:e})=>t.jsx(r,{column:e,title:o("features.log.operationLog.status")}),cell:({row:e})=>{const a=e.getValue("status");return t.jsx(J,{variant:W(a),children:a})}},{accessorKey:"startTime",header:({column:e})=>t.jsx(r,{column:e,title:o("features.log.operationLog.startTime")}),cell:({row:e})=>{const a=e.getValue("startTime");return t.jsx("div",{children:T(a)})}},{accessorKey:"timeCost",header:({column:e})=>t.jsx(r,{column:e,title:o("features.log.operationLog.timeCost")}),cell:({row:e})=>{const a=e.getValue("timeCost");return t.jsxs("div",{children:[a,"ms"]})}},{accessorKey:"desc",header:({column:e})=>t.jsx(r,{column:e,title:o("features.log.operationLog.desc")}),cell:({row:e})=>{const a=e.getValue("desc");return t.jsx("div",{className:"max-w-[200px] truncate",title:a,children:a||"-"})}}],[o]),s=H({data:D,columns:m,getCoreRowModel:q(),getSortedRowModel:O(),manualPagination:!0,pageCount:F,onSortingChange:v,onColumnFiltersChange:j,onColumnVisibilityChange:b,onPaginationChange:C,state:{sorting:y,columnFilters:d,columnVisibility:L,pagination:n}});return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:t.jsx(E,{title:o("features.log.operationLog.title"),description:o("features.log.operationLog.description")})}),t.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[t.jsx("div",{className:"space-y-2 pb-4",children:t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx(h,{type:"text",placeholder:o("features.log.operationLog.searchUsername"),value:s.getColumn("username")?.getFilterValue()??"",onChange:e=>s.getColumn("username")?.setFilterValue(e.target.value),className:"h-8 w-[150px]"}),t.jsx(h,{type:"text",placeholder:o("features.log.operationLog.searchIp"),value:s.getColumn("ip")?.getFilterValue()??"",onChange:e=>s.getColumn("ip")?.setFilterValue(e.target.value),className:"h-8 w-[150px]"}),t.jsx(h,{type:"text",placeholder:o("features.log.operationLog.searchPath"),value:s.getColumn("path")?.getFilterValue()??"",onChange:e=>s.getColumn("path")?.setFilterValue(e.target.value),className:"h-8 w-[150px]"}),t.jsx(B,{column:s.getColumn("status"),title:o("features.log.operationLog.status"),options:[{label:o("features.log.operationLog.statusOptions.200"),value:"200"},{label:o("features.log.operationLog.statusOptions.300"),value:"300"},{label:o("features.log.operationLog.statusOptions.400"),value:"400"},{label:o("features.log.operationLog.statusOptions.500"),value:"500"}],single:!0})]})}),t.jsxs(A,{children:[t.jsx(k,{children:s.getHeaderGroups().map(e=>t.jsx(u,{children:e.headers.map(a=>{const i=a.isPlaceholder?null:typeof a.column.columnDef.header=="function"?a.column.columnDef.header(a.getContext()):a.column.columnDef.header,c=a.column.columnDef.meta;return t.jsx(Q,{className:c?.thClassName,children:i},a.id)})},e.id))}),t.jsx(U,{children:N?t.jsx(u,{children:t.jsx(p,{colSpan:m.length,className:"h-24 text-center",children:o("features.log.operationLog.loading")})}):S?t.jsx(u,{children:t.jsx(p,{colSpan:m.length,className:"h-24 text-center text-destructive",children:o("features.log.operationLog.loadError")})}):s.getRowModel().rows?.length?s.getRowModel().rows.map(e=>t.jsx(u,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(a=>{const i=typeof a.column.columnDef.cell=="function"?a.column.columnDef.cell(a.getContext()):a.column.columnDef.cell,c=a.column.columnDef.meta;return t.jsx(p,{className:c?.tdClassName,children:i},a.id)})},e.id)):t.jsx(u,{children:t.jsx(p,{colSpan:m.length,className:"h-24 text-center",children:o("features.log.operationLog.noData")})})})]}),t.jsx(G,{table:s})]})]})}const be=Y;export{be as component};
