import{a as oe,r as d,A as pe,j as e,f as he,B as V,C as _,J as z,l as ge,t as L}from"./index-Pe1Nv6hH.js";import{u as ae}from"./useQuery-DDON36P9.js";import{u as H}from"./useMutation-uvHqRPk1.js";import{P as xe,T as fe,u as je,d as Ce,g as ye,c as be,b as Ne}from"./react-icons.esm-CiMB90YA.js";import{T as Z,v as ee,w as te}from"./sidebar-BFSPGCEL.js";import{I as M}from"./input-DW-mBlUw.js";import{D as De}from"./faceted-filter-BDTVtMjs.js";import{S as Se}from"./index-BmISbovJ.js";import{D,T as ve,a as Ie,b as F,c as we,d as Te,e as E}from"./column-header-Cfszq_dp.js";import{B as re}from"./badge-T19Q3klL.js";import{g as se}from"./status-variants-Dh7YK7JP.js";import{C as _e}from"./confirm-dialog-DmDS_GmK.js";import{c as Fe,u as Ve,b as Pe,g as ke}from"./product-category-Do59GkcM.js";import{u as Ee,a as Me,F as Re,b as g,c as x,d as f,e as j,f as C,g as Ke}from"./form-DU65aaqX.js";import{D as Be,a as Oe,b as qe,c as ze,d as Le,e as He}from"./dialog-DHifiqsD.js";import{T as Qe}from"./textarea-D-N386t0.js";import{S as Q,a as $,b as U,c as W,d as I}from"./select-Dl4KSF7A.js";import{R as $e}from"./index-B79q5nRO.js";import{g as Ue}from"./project-_pxXE-N5.js";import{I as We}from"./image-D4KB7jNL.js";import{C as Ae}from"./index-4GH7Kv3S.js";import{C as Je}from"./chevron-right-COcvBQ44.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-D68Ta3NN.js";import"./index-SpxnGYUf.js";import"./index-C8jai3VV.js";import"./command-D9eDedTW.js";import"./index-DGhUbGt9.js";import"./search-DNOmmJ4K.js";import"./popover-CrxLZKyN.js";import"./separator-Bq1fgMtF.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-BDzuQ5ZL.js";import"./scroll-area-BCr0FWtA.js";import"./resource-u0oZDgOZ.js";import"./loader-circle-DjNfctPA.js";import"./upload-CE8x_1SM.js";import"./chevron-left-BrCT33MH.js";const Ge=s=>pe({title:_().min(1,s("features.store.productCategory.form.validation.titleRequired")),description:_().optional(),icon:_().optional(),path:_().optional(),sort:z().int().min(1).max(99),hidden:z().min(1).max(2),parentId:z().int().min(0),projectID:_().optional()});function ne(s,p=0,c=[]){for(const u of s)c.push({id:u.id,title:"  ".repeat(p)+u.title}),u.children?.length&&ne(u.children,p+1,c);return c}function Xe({open:s,onOpenChange:p,category:c=null,categoryTree:u=[],onSubmit:y,isLoading:b=!1}){const{t:a}=oe(),m=!!c,[w,S]=d.useState("1"),[R,T]=d.useState(!1),K=d.useMemo(()=>Ge(a),[a]),B=d.useMemo(()=>{const o=ne(u);return m&&c?o.filter(n=>n.id!==c.id):o},[u,m,c]),{data:O}=ae({queryKey:["projectList"],queryFn:()=>Ue({pageNum:1,pageSize:500}),enabled:s}),q=O?.projects??[],i=Ee({resolver:Me(K),defaultValues:{title:"",description:"",icon:"",path:"",sort:1,hidden:1,parentId:0,projectID:""}});d.useEffect(()=>{if(s)if(m&&c){const o=Math.max(1,Math.min(99,c.sort??1)),n=c.parentID??0;i.reset({title:c.title,description:c.description||"",icon:c.icon||"",path:c.path??"",sort:o,hidden:c.hidden??1,parentId:n,projectID:c.projectID?.trim()??""}),S(String(o))}else i.reset({title:"",description:"",icon:"",path:"",sort:1,hidden:1,parentId:0,projectID:""}),S("1")},[s,m,c,i]);const P=o=>{y({title:o.title,description:o.description,icon:o.icon,path:o.path??"",sort:o.sort,hidden:o.hidden,parentId:o.parentId,projectID:o.projectID?.trim()||void 0,productCategoryID:c?.productCategoryID?.trim()})};return e.jsxs(Be,{open:s,onOpenChange:p,children:[e.jsxs(Oe,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(qe,{className:"shrink-0",children:[e.jsx(ze,{children:a(m?"features.store.productCategory.form.editTitle":"features.store.productCategory.form.createTitle")}),e.jsx(Le,{children:a(m?"features.store.productCategory.form.editDescription":"features.store.productCategory.form.createDescription")})]}),e.jsx(Re,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(P),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(g,{control:i.control,name:"title",render:({field:o})=>e.jsxs(x,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(f,{className:"text-right",children:a("features.store.productCategory.form.title")}),e.jsx(j,{children:e.jsx(M,{placeholder:a("features.store.productCategory.form.titlePlaceholder"),...o})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(g,{control:i.control,name:"parentId",render:({field:o})=>e.jsxs(x,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(f,{className:"text-right",children:a("features.store.productCategory.form.parent")}),e.jsxs(Q,{onValueChange:n=>o.onChange(Number(n)),value:String(o.value),children:[e.jsx(j,{children:e.jsx($,{children:e.jsx(U,{placeholder:a("features.store.productCategory.form.parentPlaceholder")})})}),e.jsxs(W,{children:[e.jsx(I,{value:"0",children:a("features.store.productCategory.form.rootCategory")}),B.map(n=>e.jsx(I,{value:String(n.id),children:n.title},n.id))]})]}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(g,{control:i.control,name:"description",render:({field:o})=>e.jsxs(x,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(f,{className:"text-right pt-2",children:a("features.store.productCategory.form.description")}),e.jsx(j,{children:e.jsx(Qe,{placeholder:a("features.store.productCategory.form.descriptionPlaceholder"),className:"resize-none",...o})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(g,{control:i.control,name:"icon",render:({field:o})=>e.jsxs(x,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(f,{className:"text-right",children:a("features.store.productCategory.form.icon")}),e.jsx(j,{children:e.jsx("button",{type:"button",onClick:()=>T(!0),className:he("flex flex-col items-center justify-center h-20 w-20 rounded-lg border-2 border-dashed border-border bg-muted/30 overflow-hidden transition-all shrink-0","cursor-pointer hover:border-primary/50 hover:bg-muted/50"),children:o.value?e.jsx("img",{src:o.value,alt:"",className:"h-full w-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"h-8 w-8 text-muted-foreground mb-1"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("features.store.productCategory.form.selectIcon")})]})})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(g,{control:i.control,name:"path",render:({field:o})=>e.jsxs(x,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(f,{className:"text-right",children:a("features.store.productCategory.form.path")}),e.jsx(j,{children:e.jsx(M,{placeholder:a("features.store.productCategory.form.pathPlaceholder"),...o})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(g,{control:i.control,name:"sort",render:({field:o})=>e.jsxs(x,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(f,{className:"text-right",children:a("features.store.productCategory.form.sort")}),e.jsx(j,{children:e.jsx(M,{type:"number",placeholder:a("features.store.productCategory.form.sortPlaceholder"),value:w,onChange:n=>S(n.target.value),onBlur:()=>{const n=Number(w);let N=1;!isNaN(n)&&w!==""&&(N=Math.max(1,Math.min(99,n))),S(String(N)),o.onChange(N),o.onBlur()},min:1,max:99})}),e.jsx(Ke,{className:"col-start-2",children:a("features.store.productCategory.form.sortDescription")}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(g,{control:i.control,name:"hidden",render:({field:o})=>e.jsxs(x,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(f,{className:"text-right",children:a("features.store.productCategory.form.hidden")}),e.jsxs(Q,{onValueChange:n=>o.onChange(Number(n)),value:String(o.value),children:[e.jsx(j,{children:e.jsx($,{children:e.jsx(U,{placeholder:a("features.store.productCategory.form.hiddenPlaceholder")})})}),e.jsxs(W,{children:[e.jsx(I,{value:"1",children:a("features.store.productCategory.hiddenStatus.show")}),e.jsx(I,{value:"2",children:a("features.store.productCategory.hiddenStatus.hidden")})]})]}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(g,{control:i.control,name:"projectID",render:({field:o})=>e.jsxs(x,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(f,{className:"text-right",children:a("features.store.productCategory.form.projectID")}),e.jsxs(Q,{onValueChange:n=>o.onChange(n==="__none__"?"":n),value:o.value?o.value:"__none__",children:[e.jsx(j,{children:e.jsx($,{children:e.jsx(U,{placeholder:a("features.store.productCategory.form.projectIDPlaceholder")})})}),e.jsxs(W,{children:[e.jsx(I,{value:"__none__",children:a("features.store.productCategory.form.projectIDPlaceholder")}),q.map(n=>e.jsx(I,{value:n.projectID.trim(),children:n.title},n.projectID))]})]}),e.jsx(C,{className:"col-start-2"})]})})]})}),e.jsxs(He,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(V,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:b,children:a("features.store.productCategory.form.cancel")}),e.jsx(V,{type:"button",disabled:b,onClick:i.handleSubmit(P),children:a(b?"features.store.productCategory.form.submitting":m?"features.store.productCategory.form.save":"features.store.productCategory.form.create")})]})]}),e.jsx($e,{open:R,onOpenChange:T,onSelect:o=>{i.setValue("icon",o.url,{shouldValidate:!0}),T(!1)},type:1,title:a("features.store.productCategory.form.selectIconDialogTitle"),description:a("features.store.productCategory.form.selectIconDialogDesc")})]})}function Ye(){"use no memo";const{t:s}=oe(),p=ge(),[c,u]=d.useState(null),[y,b]=d.useState(null),[a,m]=d.useState(null),[w,S]=d.useState([]),[R,T]=d.useState([]),[K,B]=d.useState({}),[O,q]=d.useState({}),{data:i,isLoading:P,error:o}=ae({queryKey:["productCategoryTree"],queryFn:()=>ke()}),n=i?.productCategoryTree??[],N=d.useCallback(t=>{const r=[];return t.forEach(l=>{r.push(l),l.children?.length&&r.push(...N(l.children))}),r},[]),ce=d.useMemo(()=>N(n),[n,N]),A=d.useCallback((t,r)=>{for(const l of t){if(l.productCategoryID?.trim()===r.trim())return l;if(l.children?.length){const h=A(l.children,r);if(h)return h}}return null},[]),J=d.useCallback(t=>{const r=[t.productCategoryID?.trim()].filter(Boolean);return t.children?.length&&t.children.forEach(l=>r.push(...J(l))),r},[]),G=H({mutationFn:t=>Fe(t,{projectID:t.projectID}),onSuccess:()=>{L.success(s("features.store.productCategory.createSuccess")),p.invalidateQueries({queryKey:["productCategoryTree"]}),u(null),m(null)},onError:()=>{}}),X=H({mutationFn:t=>Ve(t.productCategoryID,t),onSuccess:()=>{L.success(s("features.store.productCategory.updateSuccess")),p.invalidateQueries({queryKey:["productCategoryTree"]}),u(null),m(null)},onError:()=>{}}),Y=H({mutationFn:t=>Pe(t),onSuccess:()=>{L.success(s("features.store.productCategory.deleteSuccess")),p.invalidateQueries({queryKey:["productCategoryTree"]}),b(null)},onError:()=>{}}),le=()=>{m(null),u("create")},ie=t=>{c==="create"?G.mutate(t):c==="edit"&&t.productCategoryID&&X.mutate({productCategoryID:t.productCategoryID,...t})},de=()=>{if(y==null)return;const t=A(n,y),r=t?J(t):[y];Y.mutate({productCategoryIds:r.join(",")})},ue=ce.find(t=>t.productCategoryID?.trim()===y),k=d.useMemo(()=>[{accessorKey:"title",header:({column:t})=>e.jsx(D,{column:t,title:s("features.store.productCategory.columns.title")}),cell:({row:t})=>{const r=t.getCanExpand(),l=t.getIsExpanded(),h=t.depth;return e.jsxs("div",{className:"flex items-center gap-2 font-medium",style:{paddingLeft:`${h*20}px`},children:[r&&e.jsx("button",{type:"button",onClick:me=>{me.stopPropagation(),t.toggleExpanded()},className:"flex items-center justify-center w-4 h-4 hover:bg-accent rounded",children:l?e.jsx(Ae,{className:"h-4 w-4"}):e.jsx(Je,{className:"h-4 w-4"})}),!r&&e.jsx("div",{className:"w-4"}),e.jsx("span",{children:t.getValue("title")})]})}},{accessorKey:"description",header:({column:t})=>e.jsx(D,{column:t,title:s("features.store.productCategory.columns.description")}),cell:({row:t})=>{const r=t.getValue("description");return e.jsx("div",{className:"max-w-[200px] truncate",title:r,children:r||"-"})}},{accessorKey:"icon",header:({column:t})=>e.jsx(D,{column:t,title:s("features.store.productCategory.columns.icon")}),cell:({row:t})=>{const r=t.getValue("icon");return r?/^https?:\/\//i.test(r)||r.startsWith("/")?e.jsx("img",{src:r,alt:"",className:"h-8 w-8 object-cover rounded border border-border",title:r}):e.jsx("div",{className:"max-w-[100px] truncate",title:r,children:r}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"path",header:({column:t})=>e.jsx(D,{column:t,title:s("features.store.productCategory.columns.path")}),cell:({row:t})=>{const r=t.original.path;if(!r)return e.jsx("span",{className:"text-muted-foreground",children:"-"});const l=/^https?:\/\//i.test(r)?r:`${window.location.origin}${r.startsWith("/")?"":"/"}${r}`;return e.jsx("a",{href:l,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline max-w-[150px] truncate inline-block",title:l,children:r})}},{accessorKey:"sort",header:({column:t})=>e.jsx(D,{column:t,title:s("features.store.productCategory.columns.sort")}),cell:({row:t})=>e.jsx("div",{children:t.getValue("sort")})},{accessorKey:"hidden",header:({column:t})=>e.jsx(D,{column:t,title:s("features.store.productCategory.columns.hidden")}),cell:({row:t})=>{const r=t.getValue("hidden");return e.jsx(re,{variant:se(r,"visibility"),children:s(r===1?"features.store.productCategory.hiddenStatus.show":"features.store.productCategory.hiddenStatus.hidden")})}},{accessorKey:"status",header:({column:t})=>e.jsx(D,{column:t,title:s("features.store.productCategory.columns.status")}),cell:({row:t})=>{const r=t.getValue("status");return e.jsx(re,{variant:se(r,"enabledStatus"),children:s(r===1?"features.store.productCategory.statusEnum.enable":"features.store.productCategory.statusEnum.disable")})}},{id:"actions",header:s("features.store.productCategory.columns.actions"),cell:({row:t})=>{const r=t.original;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(V,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{m(r),u("edit")},children:e.jsx(xe,{className:"h-4 w-4"})})}),e.jsx(te,{children:s("features.store.productCategory.actions.edit")})]}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(V,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>r.productCategoryID&&b(r.productCategoryID.trim()),children:e.jsx(fe,{className:"h-4 w-4 text-destructive"})})}),e.jsx(te,{children:s("features.store.productCategory.actions.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[s]),v=je({data:n,columns:k,getCoreRowModel:be(),getSortedRowModel:ye(),getExpandedRowModel:Ce(),getSubRows:t=>t.children,onExpandedChange:q,onSortingChange:T,onColumnFiltersChange:S,onColumnVisibilityChange:B,state:{expanded:O,sorting:R,columnFilters:w,columnVisibility:K}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(Se,{title:s("features.store.productCategory.title"),description:s("features.store.productCategory.description"),children:e.jsxs(V,{onClick:le,children:[e.jsx(Ne,{className:"h-4 w-4"}),s("features.store.productCategory.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(M,{type:"text",placeholder:s("features.store.productCategory.search.title"),value:v.getColumn("title")?.getFilterValue()??"",onChange:t=>v.getColumn("title")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"}),e.jsx(De,{column:v.getColumn("hidden"),title:s("features.store.productCategory.filter.hidden"),options:[{label:s("features.store.productCategory.hiddenStatus.show"),value:"1"},{label:s("features.store.productCategory.hiddenStatus.hidden"),value:"2"}],single:!0})]})}),e.jsxs(ve,{children:[e.jsx(Ie,{children:v.getHeaderGroups().map(t=>e.jsx(F,{children:t.headers.map(r=>{const l=r.isPlaceholder?null:typeof r.column.columnDef.header=="function"?r.column.columnDef.header(r.getContext()):r.column.columnDef.header,h=r.column.columnDef.meta;return e.jsx(we,{className:h?.thClassName,children:l},r.id)})},t.id))}),e.jsx(Te,{children:P?e.jsx(F,{children:e.jsx(E,{colSpan:k.length,className:"h-24 text-center",children:s("features.store.productCategory.loading")})}):o?e.jsx(F,{children:e.jsx(E,{colSpan:k.length,className:"h-24 text-center text-destructive",children:s("features.store.productCategory.loadError")})}):v.getRowModel().rows?.length?v.getRowModel().rows.map(t=>e.jsx(F,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(r=>{const l=typeof r.column.columnDef.cell=="function"?r.column.columnDef.cell(r.getContext()):r.column.columnDef.cell,h=r.column.columnDef.meta;return e.jsx(E,{className:h?.tdClassName,children:l},r.id)})},t.id)):e.jsx(F,{children:e.jsx(E,{colSpan:k.length,className:"h-24 text-center",children:s("features.store.productCategory.noData")})})})]})]}),e.jsx(Xe,{open:c!==null,onOpenChange:t=>{t||(u(null),m(null))},category:a,categoryTree:n,onSubmit:ie,isLoading:c==="create"?G.isPending:X.isPending}),e.jsx(_e,{open:y!==null,onOpenChange:t=>{t||b(null)},title:s("features.store.productCategory.confirmDelete"),desc:s("features.store.productCategory.confirmDeleteMessage",{title:ue?.title??""}),handleConfirm:de,destructive:!0,confirmText:s("features.store.productCategory.actions.delete"),isLoading:Y.isPending})]})}const Kt=Ye;export{Kt as component};
