import{a as Z,r as l,A as ie,j as e,f as le,B as v,C as A,Q as ne,J as me,l as ue,t as g,K as de}from"./index-Pe1Nv6hH.js";import{u as pe}from"./useQuery-DDON36P9.js";import{u as K}from"./useMutation-uvHqRPk1.js";import{P as fe,T as xe,u as ge,g as he,c as je,b as Se}from"./react-icons.esm-CiMB90YA.js";import{S as be}from"./index-BmISbovJ.js";import{D as p,T as De,a as Ne,b as j,c as ye,d as ve,e as M}from"./column-header-Cfszq_dp.js";import{D as Ce}from"./pagination-B86K5cVv.js";import{I as L}from"./input-DW-mBlUw.js";import{T as J,v as U,w as Y}from"./sidebar-BFSPGCEL.js";import{C as Te}from"./confirm-dialog-DmDS_GmK.js";import{u as Ie,a as we,F as ke,b as S,c as b,d as D,e as N,f as y}from"./form-DU65aaqX.js";import{D as Fe,a as Me,b as Pe,c as Ee,d as Re,e as _e}from"./dialog-DHifiqsD.js";import{T as Ve}from"./textarea-D-N386t0.js";import{S as Ae,a as Ke,b as Oe,c as Le,d as W}from"./select-Dl4KSF7A.js";import{R as ze}from"./index-B79q5nRO.js";import{I as qe}from"./image-D4KB7jNL.js";import{F as He}from"./resource-u0oZDgOZ.js";import{c as Qe,u as Be,d as Ge,g as $e}from"./product-spec-BGfX0G0n.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./index-D68Ta3NN.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./index-DGhUbGt9.js";import"./scroll-area-BCr0FWtA.js";import"./loader-circle-DjNfctPA.js";import"./upload-CE8x_1SM.js";import"./chevron-left-BrCT33MH.js";const O=1,z=2,Xe=r=>ie({title:A().min(1,r("features.store.productSpec.form.validation.titleRequired")),format:me().min(1).max(2),image:A().optional(),sort:ne().min(0),remark:A().optional()}).refine(m=>m.format===z?(m.image??"").trim().length>0:!0,{message:r("features.store.productSpec.form.validation.imageRequired"),path:["image"]});function Je({open:r,onOpenChange:m,onSubmit:C,onSubmitUpdate:f,isLoading:d=!1,editSpec:i,projectID:x}){const{t:o}=Z(),[n,T]=l.useState(!1),u=!!i,P=l.useMemo(()=>Xe(o),[o]),c=Ie({resolver:we(P),defaultValues:{title:"",format:O,image:"",sort:1,remark:""}}),I=c.watch("format");l.useEffect(()=>{r&&(i?c.reset({title:(i.title??"").trim(),format:i.format??1,image:(i.image??"").trim()||"",sort:i.sort??1,remark:(i.remark??"").trim()||""}):c.reset({title:"",format:O,image:"",sort:1,remark:""}))},[r,i,c]);function E(a){const h=a.format??1,w={title:a.title.trim(),sort:a.sort??1,image:(a.image??"").trim()||void 0,remark:(a.remark??"").trim()||void 0,format:h};u&&i&&f?f(i.productSpecID.trim(),w):C&&C(w)}return e.jsxs(Fe,{open:r,onOpenChange:m,children:[e.jsxs(Me,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(Pe,{className:"shrink-0",children:[e.jsx(Ee,{children:o(u?"features.store.productSpec.form.editTitle":"features.store.productSpec.form.dialogTitle")}),e.jsx(Re,{children:o(u?"features.store.productSpec.form.editDescription":"features.store.productSpec.form.createDescription")})]}),e.jsx(ke,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(E),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(S,{control:c.control,name:"title",render:({field:a})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(D,{className:"text-right",children:o("features.store.productSpec.form.title")}),e.jsx(N,{children:e.jsx(L,{placeholder:o("features.store.productSpec.form.titlePlaceholder"),...a})}),e.jsx(y,{className:"col-start-2"})]})}),e.jsx(S,{control:c.control,name:"format",render:({field:a})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(D,{className:"text-right",children:o("features.store.productSpec.form.format")}),e.jsxs(Ae,{value:String(a.value),onValueChange:h=>a.onChange(Number(h)),children:[e.jsx(N,{children:e.jsx(Ke,{children:e.jsx(Oe,{placeholder:o("features.store.productSpec.form.formatPlaceholder")})})}),e.jsxs(Le,{children:[e.jsx(W,{value:String(O),children:o("features.store.productSpec.form.formatText")}),e.jsx(W,{value:String(z),children:o("features.store.productSpec.form.formatImage")})]})]}),e.jsx(y,{className:"col-start-2"})]})}),I===z&&e.jsx(S,{control:c.control,name:"image",render:({field:a})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(D,{className:"text-right pt-2",children:o("features.store.productSpec.form.image")}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx(N,{children:e.jsx("button",{type:"button",onClick:()=>T(!0),className:le("flex flex-col items-center justify-center h-20 w-20 rounded-lg border-2 border-dashed border-border bg-muted/30 overflow-hidden transition-all shrink-0","cursor-pointer hover:border-primary/50 hover:bg-muted/50"),children:a.value?e.jsx("img",{src:a.value,alt:"",className:"h-full w-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"h-8 w-8 text-muted-foreground mb-1"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:o("features.store.productSpec.form.uploadImage")})]})})}),e.jsx(y,{})]})]})}),e.jsx(S,{control:c.control,name:"sort",render:({field:a})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(D,{className:"text-right",children:o("features.store.productSpec.form.sort")}),e.jsx(N,{children:e.jsx(L,{type:"number",min:0,...a})}),e.jsx(y,{className:"col-start-2"})]})}),e.jsx(S,{control:c.control,name:"remark",render:({field:a})=>e.jsxs(b,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(D,{className:"text-right pt-2",children:o("features.store.productSpec.form.remark")}),e.jsx(N,{children:e.jsx(Ve,{placeholder:o("features.store.productSpec.form.remarkPlaceholder"),className:"min-h-[80px] resize-none",...a})}),e.jsx(y,{className:"col-start-2"})]})}),e.jsxs(_e,{className:"shrink-0",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:d,children:o("features.store.productSpec.form.cancel")}),e.jsx(v,{type:"submit",disabled:d,children:d?"...":o("features.store.productSpec.form.submit")})]})]})})]}),e.jsx(ze,{open:n,onOpenChange:T,type:He.IMAGE,onSelect:a=>{c.setValue("image",a.url??"",{shouldValidate:!0}),T(!1)},title:o("features.store.productSpec.form.selectImageDialogTitle"),description:o("features.store.productSpec.form.selectImageDialogDesc")})]})}const Ue=1,Ye=2;function We(r){return{id:(r.productSpecID??"").trim(),title:(r.title??"").trim()||"-",format:r.format??Ue,sort:r.sort??1,image:(r.image??"").trim()||"",remark:(r.remark??"").trim()||"-",createdAt:(r.createdAt??"").trim()||"-"}}function Ze(){"use no memo";const{t:r}=Z(),m=ue(),[C,f]=l.useState(!1),[d,i]=l.useState(null),[x,o]=l.useState(null),[n,T]=l.useState(""),[u,P]=l.useState(""),[c,I]=l.useState({pageIndex:0,pageSize:10}),[E,a]=l.useState([]),[h,w]=l.useState({}),q=l.useMemo(()=>({pageNum:c.pageIndex+1,pageSize:c.pageSize,projectID:n&&n.trim()!==""?n.trim():void 0,title:u&&u.trim()!==""?u.trim():void 0}),[c.pageIndex,c.pageSize,n,u]),{data:H,isLoading:ee,error:te}=pe({queryKey:["productSpecList",q],queryFn:()=>$e(q),placeholderData:de}),R=H?.productSpecs??[],Q=l.useMemo(()=>R.map(t=>We(t)),[R]),re=H?.total??0,B=d!=null?R.find(t=>(t.productSpecID??"").trim()===d)??null:null,G=K({mutationFn:t=>Qe(t,{projectID:(n??"").trim()!==""?(n??"").trim():void 0}),onSuccess:()=>{g.success(r("features.store.productSpec.createSuccess")),m.invalidateQueries({queryKey:["productSpecList"]}),f(!1)},onError:t=>{g.error(t instanceof Error?t.message:r("features.store.productSpec.createError"))}}),$=K({mutationFn:({productSpecID:t,data:s})=>Be(t,s),onSuccess:()=>{g.success(r("features.store.productSpec.updateSuccess")),m.invalidateQueries({queryKey:["productSpecList"]}),i(null)},onError:t=>{g.error(t instanceof Error?t.message:r("features.store.productSpec.updateError"))}}),X=K({mutationFn:t=>Ge({productSpecIds:t}),onSuccess:()=>{g.success(r("features.store.productSpec.deleteSuccess")),m.invalidateQueries({queryKey:["productSpecList"]}),o(null)},onError:t=>{g.error(t instanceof Error?t.message:r("features.store.productSpec.deleteError"))}}),se=()=>{x&&X.mutate(x)},oe=Q.find(t=>t.id===x),ae=t=>r(t===Ye?"features.store.productSpec.scenario.formatImage":"features.store.productSpec.scenario.formatText"),ce=Math.max(1,Math.ceil(re/c.pageSize)),k=l.useMemo(()=>[{accessorKey:"id",header:({column:t})=>e.jsx(p,{column:t,title:r("features.store.productSpec.scenario.columns.id")}),cell:({row:t})=>e.jsx("div",{className:"font-mono text-muted-foreground",children:t.getValue("id")?.trim()??"-"})},{accessorKey:"title",header:({column:t})=>e.jsx(p,{column:t,title:r("features.store.productSpec.scenario.columns.title")}),cell:({row:t})=>e.jsx("div",{className:"max-w-[160px] truncate font-medium",title:t.getValue("title"),children:t.getValue("title")??"-"})},{accessorKey:"format",header:({column:t})=>e.jsx(p,{column:t,title:r("features.store.productSpec.scenario.columns.format")}),cell:({row:t})=>e.jsx("span",{className:"text-muted-foreground whitespace-nowrap",children:ae(t.getValue("format"))})},{accessorKey:"sort",header:({column:t})=>e.jsx(p,{column:t,title:r("features.store.productSpec.scenario.columns.sort")}),cell:({row:t})=>e.jsx("span",{className:"text-muted-foreground tabular-nums",children:t.getValue("sort")??"-"})},{accessorKey:"image",header:({column:t})=>e.jsx(p,{column:t,title:r("features.store.productSpec.scenario.columns.image")}),cell:({row:t})=>{const s=t.getValue("image");return!s||s.trim()===""?e.jsx("span",{className:"text-muted-foreground",children:"-"}):e.jsx("img",{src:s,alt:"",className:"h-8 w-8 object-cover rounded border border-border",title:s})}},{accessorKey:"remark",header:({column:t})=>e.jsx(p,{column:t,title:r("features.store.productSpec.scenario.columns.remark")}),cell:({row:t})=>{const s=t.getValue("remark");return e.jsx("div",{className:"max-w-[200px] truncate text-muted-foreground",title:s,children:s??"-"})}},{accessorKey:"createdAt",header:({column:t})=>e.jsx(p,{column:t,title:r("features.store.productSpec.scenario.columns.createdAt")}),cell:({row:t})=>e.jsx("div",{className:"text-muted-foreground whitespace-nowrap",children:t.getValue("createdAt")??"-"})},{id:"actions",header:r("features.store.productSpec.scenario.columns.actions"),cell:({row:t})=>{const s=t.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>i(s.id),children:e.jsx(fe,{className:"h-4 w-4"})})}),e.jsx(Y,{children:r("features.store.productSpec.scenario.actions.edit")})]}),e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>o(s.id),children:e.jsx(xe,{className:"h-4 w-4 text-destructive"})})}),e.jsx(Y,{children:r("features.store.productSpec.scenario.actions.delete")})]})]})},enableHiding:!1,meta:{thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[r]),F=ge({data:Q,columns:k,getCoreRowModel:je(),getSortedRowModel:he(),manualPagination:!0,pageCount:ce,getRowId:t=>t.id,onSortingChange:a,onColumnVisibilityChange:w,onPaginationChange:I,state:{sorting:E,columnVisibility:h,pagination:c}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(be,{title:r("features.store.productSpec.title"),description:r("features.store.productSpec.description"),children:e.jsxs(v,{onClick:()=>{i(null),f(!0)},children:[e.jsx(Se,{className:"h-4 w-4"}),r("features.store.productSpec.scenario.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(L,{placeholder:r("features.store.productSpec.scenario.search.title"),className:"h-8 w-[200px]",value:u,onChange:t=>{P(t.target.value),I(s=>({...s,pageIndex:0}))}})})}),e.jsxs(De,{children:[e.jsx(Ne,{children:F.getHeaderGroups().map(t=>e.jsx(j,{children:t.headers.map(s=>{const _=s.isPlaceholder?null:typeof s.column.columnDef.header=="function"?s.column.columnDef.header(s.getContext()):s.column.columnDef.header,V=s.column.columnDef.meta;return e.jsx(ye,{className:V?.thClassName,children:_},s.id)})},t.id))}),e.jsx(ve,{children:ee?e.jsx(j,{children:e.jsx(M,{colSpan:k.length,className:"h-24 text-center",children:r("features.store.productSpec.scenario.loading")})}):te?e.jsx(j,{children:e.jsx(M,{colSpan:k.length,className:"h-24 text-center text-destructive",children:r("features.store.productSpec.scenario.loadError")})}):F.getRowModel().rows?.length?F.getRowModel().rows.map(t=>e.jsx(j,{children:t.getVisibleCells().map(s=>{const _=typeof s.column.columnDef.cell=="function"?s.column.columnDef.cell(s.getContext()):s.column.columnDef.cell,V=s.column.columnDef.meta;return e.jsx(M,{className:V?.tdClassName,children:_},s.id)})},t.id)):e.jsx(j,{children:e.jsx(M,{colSpan:k.length,className:"h-24 text-center",children:r("features.store.productSpec.scenario.noData")})})})]}),e.jsx(Ce,{table:F})]}),e.jsx(Je,{open:C||d!=null&&B!=null,onOpenChange:t=>{t||(f(!1),i(null))},onSubmit:t=>G.mutate(t),onSubmitUpdate:(t,s)=>$.mutate({productSpecID:t,data:s}),isLoading:G.isPending||$.isPending,editSpec:B,projectID:n&&n.trim()!==""?n.trim():void 0}),e.jsx(Te,{open:x!==null,onOpenChange:t=>{t||o(null)},title:r("features.store.productSpec.confirmDelete"),desc:r("features.store.productSpec.confirmDeleteDesc",{name:oe?.title??x??""}),handleConfirm:se,destructive:!0,confirmText:r("features.store.productSpec.scenario.actions.delete"),isLoading:X.isPending})]})}const Mt=Ze;export{Mt as component};
