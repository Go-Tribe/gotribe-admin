import{a as te,r as m,A as ne,j as e,B as C,f as J,C as k,m as V,l as le,t as I,K as de}from"./index-Pe1Nv6hH.js";import{u as O}from"./useQuery-DDON36P9.js";import{u as H}from"./useMutation-uvHqRPk1.js";import{P as ue,T as me,u as pe,g as fe,c as ge,b as he}from"./react-icons.esm-CiMB90YA.js";import{I as re}from"./input-DW-mBlUw.js";import{S as xe}from"./index-BmISbovJ.js";import{D as v,T as ye,a as je,b,c as Te,d as De,e as _}from"./column-header-Cfszq_dp.js";import{D as Ie}from"./pagination-B86K5cVv.js";import{T as W,v as Y,w as Z}from"./sidebar-BFSPGCEL.js";import{C as Ce}from"./confirm-dialog-DmDS_GmK.js";import{u as Ne,a as ve,F as be,b as P,c as F,d as M,e as E,f as q}from"./form-DU65aaqX.js";import{D as Se,a as we,b as ke,c as _e,d as Pe,e as Fe}from"./dialog-DHifiqsD.js";import{T as Me}from"./textarea-D-N386t0.js";import{S as Ee,a as qe,b as Ve,c as Re,d as ee}from"./select-Dl4KSF7A.js";import{P as Le,a as Ke,b as ze}from"./popover-CrxLZKyN.js";import{g as Be,a as Ae,b as He,c as Oe,d as Qe,e as $e}from"./command-D9eDedTW.js";import{B as Ge}from"./badge-T19Q3klL.js";import{g as Ue}from"./product-spec-item-XYjFlwSv.js";import{X as Xe}from"./index-D68Ta3NN.js";import{C as Je}from"./chevrons-up-down-BrdDDp5G.js";import{C as We}from"./index-SpxnGYUf.js";import{g as Ye}from"./product-category-Do59GkcM.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-4GH7Kv3S.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-C8jai3VV.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./index-DGhUbGt9.js";import"./search-DNOmmJ4K.js";const Ze=r=>ne({title:k().min(1,r("features.store.productType.form.validation.titleRequired")),categoryID:k().min(1,r("features.store.productType.form.validation.categoryRequired")),specIds:k().min(1,r("features.store.productType.form.validation.specIdsRequired")),remark:k().optional()});function et({open:r,onOpenChange:i,onSubmit:l,onSubmitUpdate:d,isLoading:g=!1,categoryList:h,editProductType:n}){const{t:o}=te(),T=!!n,{data:R}=O({queryKey:["productSpecItemList"],queryFn:()=>Ue(),enabled:r}),y=R?.productSpecItems??[],L=m.useMemo(()=>Ze(o),[o]),p=Ne({resolver:ve(L),defaultValues:{title:"",categoryID:"",specIds:"",remark:""}});m.useEffect(()=>{r&&(n?p.reset({title:(n.title??"").trim(),categoryID:(n.categoryID??"").trim(),specIds:(n.specIds??"").trim(),remark:(n.remark??"").trim()}):p.reset({title:"",categoryID:"",specIds:"",remark:""}))},[r,n,p]);function K(c){T&&n&&d?d(n.productTypeID.trim(),{title:c.title.trim(),categoryID:(c.categoryID??"").trim()||void 0,specIds:(c.specIds??"").trim()||void 0,remark:(c.remark??"").trim()||void 0}):l&&l({title:c.title.trim(),categoryID:(c.categoryID??"").trim(),specIds:(c.specIds??"").trim()||void 0,remark:(c.remark??"").trim()||void 0})}return e.jsx(Se,{open:r,onOpenChange:i,children:e.jsxs(we,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(ke,{className:"shrink-0",children:[e.jsx(_e,{children:o(T?"features.store.productType.form.editTitle":"features.store.productType.form.dialogTitle")}),e.jsx(Pe,{children:o(T?"features.store.productType.form.editDescription":"features.store.productType.form.createDescription")})]}),e.jsx(be,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(K),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(P,{control:p.control,name:"title",render:({field:c})=>e.jsxs(F,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(M,{className:"text-right",children:o("features.store.productType.form.title")}),e.jsx(E,{children:e.jsx(re,{placeholder:o("features.store.productType.form.titlePlaceholder"),...c})}),e.jsx(q,{className:"col-start-2"})]})}),e.jsx(P,{control:p.control,name:"categoryID",render:({field:c})=>{const j=(c.value??"").trim()||"__empty__";return e.jsxs(F,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(M,{className:"text-right",children:o("features.store.productType.form.category")}),e.jsxs(Ee,{value:j,onValueChange:a=>c.onChange(a==="__empty__"?"":a),children:[e.jsx(E,{children:e.jsx(qe,{children:e.jsx(Ve,{placeholder:o("features.store.productType.form.categoryPlaceholder")})})}),e.jsxs(Re,{children:[e.jsx(ee,{value:"__empty__",children:o("features.store.productType.form.categoryPlaceholder")}),h.filter(a=>(a.categoryID??"").trim()!=="").map(a=>e.jsx(ee,{value:(a.categoryID??"").trim(),children:a.title},a.categoryID))]})]},`category-${n?.productTypeID??"create"}-${h.length}-${j}`),e.jsx(q,{className:"col-start-2"})]})}}),e.jsx(P,{control:p.control,name:"specIds",render:({field:c})=>{const x=(c.value??"").trim()?(c.value??"").split(",").map(a=>a.trim()).filter(Boolean):[],j=y.filter(a=>x.includes((a.productSpecItemID??"").trim()));return e.jsxs(F,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(M,{className:"text-right pt-2",children:o("features.store.productType.form.specIds")}),e.jsxs(Le,{children:[e.jsx(Ke,{asChild:!0,children:e.jsx(E,{children:e.jsxs(C,{variant:"outline",role:"combobox",className:J("w-full justify-between h-auto min-h-10 font-normal",!x.length&&"text-muted-foreground"),children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:j.length>0?j.map(a=>{const u=(a.productSpecItemID??"").trim();return e.jsxs(Ge,{variant:"secondary",className:"mr-1",children:[a.title??u,e.jsx("div",{className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 cursor-pointer",onMouseDown:f=>{f.preventDefault(),f.stopPropagation()},onClick:f=>{f.preventDefault(),f.stopPropagation();const D=x.filter(N=>N!==u);c.onChange(D.length?D.join(","):"")},children:e.jsx(Xe,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},u)}):e.jsx("span",{children:o("features.store.productType.form.specIdsPlaceholder")})}),e.jsx(Je,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(ze,{className:"w-[400px] p-0",align:"start",children:e.jsxs(Be,{children:[e.jsx(Ae,{placeholder:o("features.store.productType.form.specIdsPlaceholder")}),e.jsxs(He,{children:[e.jsx(Oe,{children:o("features.store.productType.form.specIdsEmpty")}),e.jsx(Qe,{children:y.map(a=>{const u=(a.productSpecItemID??"").trim();if(!u)return null;const f=x.includes(u);return e.jsxs($e,{value:a.title??u,onSelect:()=>{const D=f?x.filter(N=>N!==u):[...x,u];c.onChange(D.length?D.join(","):"")},children:[e.jsx(We,{className:J("mr-2 h-4 w-4",f?"opacity-100":"opacity-0")}),a.title??u]},u)})})]})]})})]}),e.jsx(q,{className:"col-start-2"})]})}}),e.jsx(P,{control:p.control,name:"remark",render:({field:c})=>e.jsxs(F,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(M,{className:"text-right pt-2",children:o("features.store.productType.form.remark")}),e.jsx(E,{children:e.jsx(Me,{placeholder:o("features.store.productType.form.remarkPlaceholder"),className:"min-h-[80px] resize-none",...c})}),e.jsx(q,{className:"col-start-2"})]})}),e.jsxs(Fe,{className:"shrink-0",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>i(!1),disabled:g,children:o("features.store.productType.form.cancel")}),e.jsx(C,{type:"submit",disabled:g,children:g?"...":o("features.store.productType.form.submit")})]})]})})]})})}async function tt(r){const i={page_num:r?.pageNum??1,page_size:r?.pageSize??10};return r?.project_id!=null&&r.project_id!==""&&(i.project_id=r.project_id),r?.title!=null&&r.title!==""&&(i.title=r.title),await V.get("/api/product/type",{params:i})}async function rt(r,i){return await V.post("/api/product/type",r,{params:void 0})??{}}async function st(r,i){const l=r.trim();await V.patch(`/api/product/type/${l}`,i)}async function ot(r){await V.delete("/api/product/type",{data:{productTypeIds:r.productTypeIds}})}function se(r,i=[]){for(const l of r){const d=(l.productCategoryID??"").trim();d&&i.push({categoryID:d,title:(l.title??"").trim()||d}),l.children?.length&&se(l.children,i)}return i}function at(r,i){const l=(r.productTypeID??"").trim(),d=(r.categoryID??"").trim(),g=i.find(h=>(h.categoryID??"").trim()===d)?.title??(d||"-");return{id:l,title:(r.title??"").trim()||"-",remark:(r.remark??"").trim()||"-",categoryTitle:g||"-",createdAt:(r.createdAt??"").trim()||"-"}}function ct(){"use no memo";const{t:r}=te(),i=le(),[l,d]=m.useState(!1),[g,h]=m.useState(null),[n,o]=m.useState(null),[T,R]=m.useState(""),[y,L]=m.useState({pageIndex:0,pageSize:10}),[p,K]=m.useState([]),[c,x]=m.useState({}),{data:j}=O({queryKey:["productCategoryTree"],queryFn:()=>Ye()}),a=m.useMemo(()=>{const t=j?.productCategoryTree??[];return se(t)},[j]),u=m.useMemo(()=>({pageNum:y.pageIndex+1,pageSize:y.pageSize,title:T.trim()||void 0}),[y,T]),{data:f,isLoading:D,error:N}=O({queryKey:["productTypeList",u],queryFn:()=>tt(u),placeholderData:de}),z=f?.productTypes??[],Q=m.useMemo(()=>z.map(t=>at(t,a)),[z,a]),oe=f?.total??0,$=g!=null?z.find(t=>(t.productTypeID??"").trim()===g)??null:null,G=H({mutationFn:t=>rt(t),onSuccess:()=>{I.success(r("features.store.productType.createSuccess")),i.invalidateQueries({queryKey:["productTypeList"]}),d(!1)},onError:t=>{I.error(t instanceof Error?t.message:r("features.store.productType.createError"))}}),U=H({mutationFn:({productTypeID:t,data:s})=>st(t,s),onSuccess:()=>{I.success(r("features.store.productType.updateSuccess")),i.invalidateQueries({queryKey:["productTypeList"]}),h(null)},onError:t=>{I.error(t instanceof Error?t.message:r("features.store.productType.updateError"))}}),X=H({mutationFn:t=>ot({productTypeIds:t}),onSuccess:()=>{I.success(r("features.store.productType.deleteSuccess")),i.invalidateQueries({queryKey:["productTypeList"]}),o(null)},onError:t=>{I.error(t instanceof Error?t.message:r("features.store.productType.deleteError"))}}),ae=()=>{n&&X.mutate(n)},ce=Q.find(t=>t.id===n),ie=Math.max(1,Math.ceil(oe/y.pageSize)),S=m.useMemo(()=>[{accessorKey:"id",header:({column:t})=>e.jsx(v,{column:t,title:r("features.store.productType.columns.id")}),cell:({row:t})=>e.jsx("div",{className:"font-mono text-muted-foreground",children:t.getValue("id")?.trim()??"-"})},{accessorKey:"title",header:({column:t})=>e.jsx(v,{column:t,title:r("features.store.productType.columns.title")}),cell:({row:t})=>e.jsx("div",{className:"max-w-[160px] truncate font-medium",title:t.getValue("title"),children:t.getValue("title")??"-"})},{accessorKey:"categoryTitle",header:({column:t})=>e.jsx(v,{column:t,title:r("features.store.productType.columns.category")}),cell:({row:t})=>e.jsx("div",{className:"text-muted-foreground whitespace-nowrap",children:t.getValue("categoryTitle")??"-"})},{accessorKey:"remark",header:({column:t})=>e.jsx(v,{column:t,title:r("features.store.productType.columns.remark")}),cell:({row:t})=>{const s=t.getValue("remark");return e.jsx("div",{className:"max-w-[200px] truncate text-muted-foreground",title:s,children:s??"-"})}},{accessorKey:"createdAt",header:({column:t})=>e.jsx(v,{column:t,title:r("features.store.productType.columns.createdAt")}),cell:({row:t})=>e.jsx("div",{className:"text-muted-foreground whitespace-nowrap",children:t.getValue("createdAt")??"-"})},{id:"actions",header:r("features.store.productType.columns.actions"),cell:({row:t})=>{const s=t.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(W,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>h(s.id),children:e.jsx(ue,{className:"h-4 w-4"})})}),e.jsx(Z,{children:r("features.store.productType.actions.edit")})]}),e.jsxs(W,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>o(s.id),children:e.jsx(me,{className:"h-4 w-4 text-destructive"})})}),e.jsx(Z,{children:r("features.store.productType.actions.delete")})]})]})},enableHiding:!1,meta:{thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[r]),w=pe({data:Q,columns:S,getCoreRowModel:ge(),getSortedRowModel:fe(),manualPagination:!0,pageCount:ie,getRowId:t=>t.id,onSortingChange:K,onColumnVisibilityChange:x,onPaginationChange:L,state:{sorting:p,columnVisibility:c,pagination:y}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(xe,{title:r("features.store.productType.title"),description:r("features.store.productType.description"),children:e.jsxs(C,{onClick:()=>{h(null),d(!0)},children:[e.jsx(he,{className:"h-4 w-4"}),r("features.store.productType.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(re,{className:"h-8 w-[200px]",placeholder:r("features.store.productType.search.title"),value:T,onChange:t=>R(t.target.value)})})}),e.jsxs(ye,{children:[e.jsx(je,{children:w.getHeaderGroups().map(t=>e.jsx(b,{children:t.headers.map(s=>{const B=s.isPlaceholder?null:typeof s.column.columnDef.header=="function"?s.column.columnDef.header(s.getContext()):s.column.columnDef.header,A=s.column.columnDef.meta;return e.jsx(Te,{className:A?.thClassName,children:B},s.id)})},t.id))}),e.jsx(De,{children:D?e.jsx(b,{children:e.jsx(_,{colSpan:S.length,className:"h-24 text-center",children:r("features.store.productType.loading")})}):N?e.jsx(b,{children:e.jsx(_,{colSpan:S.length,className:"h-24 text-center text-destructive",children:r("features.store.productType.loadError")})}):w.getRowModel().rows?.length?w.getRowModel().rows.map(t=>e.jsx(b,{children:t.getVisibleCells().map(s=>{const B=typeof s.column.columnDef.cell=="function"?s.column.columnDef.cell(s.getContext()):s.column.columnDef.cell,A=s.column.columnDef.meta;return e.jsx(_,{className:A?.tdClassName,children:B},s.id)})},t.id)):e.jsx(b,{children:e.jsx(_,{colSpan:S.length,className:"h-24 text-center",children:r("features.store.productType.noData")})})})]}),e.jsx(Ie,{table:w})]}),e.jsx(et,{open:l||g!=null&&$!=null,onOpenChange:t=>{t||(d(!1),h(null))},onSubmit:t=>G.mutate(t),onSubmitUpdate:(t,s)=>U.mutate({productTypeID:t,data:s}),isLoading:G.isPending||U.isPending,categoryList:a,editProductType:$}),e.jsx(Ce,{open:n!==null,onOpenChange:t=>{t||o(null)},title:r("features.store.productType.confirmDelete"),desc:r("features.store.productType.confirmDeleteDesc",{name:ce?.title??n??""}),handleConfirm:ae,destructive:!0,confirmText:r("features.store.productType.actions.delete"),isLoading:X.isPending})]})}const Rt=ct;export{Rt as component};
