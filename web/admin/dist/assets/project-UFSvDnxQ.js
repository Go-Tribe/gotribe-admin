import{a as G,r as f,A as ie,j as e,f as E,B as w,C as n,l as le,t as k,K as ne}from"./index-Pe1Nv6hH.js";import{u as ce}from"./useQuery-DDON36P9.js";import{u as M}from"./useMutation-uvHqRPk1.js";import{P as de,T as me,u as ue,g as pe,c as fe,b as je}from"./react-icons.esm-CiMB90YA.js";import{I as j}from"./input-DW-mBlUw.js";import{S as xe}from"./index-BmISbovJ.js";import{D as R,T as he,a as ge,b as S,c as be,d as Ne,e as F}from"./column-header-Cfszq_dp.js";import{D as ye}from"./pagination-B86K5cVv.js";import{T as H,v as O,w as B}from"./sidebar-BFSPGCEL.js";import{C as ve}from"./confirm-dialog-DmDS_GmK.js";import{u as De,a as Ce,F as Se,b as c,c as d,d as m,e as u,f as p}from"./form-DU65aaqX.js";import{D as we,a as Ie,b as Pe,c as Te,d as Fe,e as _e}from"./dialog-DHifiqsD.js";import{T as V}from"./textarea-D-N386t0.js";import{R as ke}from"./index-B79q5nRO.js";import{I as Q}from"./image-D4KB7jNL.js";import{c as Me,u as Re,d as Ve,g as ze}from"./project-_pxXE-N5.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./index-D68Ta3NN.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./select-Dl4KSF7A.js";import"./index-DGhUbGt9.js";import"./scroll-area-BCr0FWtA.js";import"./resource-u0oZDgOZ.js";import"./loader-circle-DjNfctPA.js";import"./upload-CE8x_1SM.js";import"./chevron-left-BrCT33MH.js";const Ae=o=>ie({title:n().min(1,o("features.business.project.form.validation.titleRequired")),description:n().optional(),name:n().min(1,o("features.business.project.form.validation.nameRequired")),metaTitle:n().optional(),metaDescription:n().optional(),keywords:n().optional(),domain:n().optional(),postUrl:n().optional(),icp:n().optional(),author:n().optional(),baiduAnalytics:n().optional(),favicon:n().optional(),publicSecurity:n().optional(),navImage:n().optional()});function qe({open:o,onOpenChange:v,project:i,onSubmit:N,isLoading:h=!1}){const{t:s}=G(),y=!!i,[x,g]=f.useState(null),_=f.useMemo(()=>Ae(s),[s]),a=De({resolver:Ce(_),defaultValues:{title:"",description:"",name:"",metaTitle:"",metaDescription:"",keywords:"",domain:"",postUrl:"",icp:"",author:"",baiduAnalytics:"",favicon:"",publicSecurity:"",navImage:""}});f.useEffect(()=>{o&&(y&&i?a.reset({title:i.title||"",description:i.description||"",name:i.name||"",metaTitle:i.metaTitle||"",metaDescription:i.metaDescription||i.info||"",keywords:i.keywords||"",domain:i.domain||"",postUrl:i.postUrl||"",icp:i.icp||"",author:i.author||"",baiduAnalytics:i.baiduAnalytics||"",favicon:i.favicon||"",publicSecurity:i.publicSecurity||"",navImage:i.navImage||""}):a.reset({title:"",description:"",name:"",metaTitle:"",metaDescription:"",keywords:"",domain:"",postUrl:"",icp:"",author:"",baiduAnalytics:"",favicon:"",publicSecurity:"",navImage:""}))},[o,y,i,a]);const I=r=>{N({...r,projectID:i?.projectID,info:r.metaDescription})};return e.jsxs(we,{open:o,onOpenChange:v,children:[e.jsxs(Ie,{className:"sm:max-w-[700px] max-h-[90vh] flex flex-col",children:[e.jsxs(Pe,{className:"shrink-0",children:[e.jsx(Te,{children:s(y?"features.business.project.form.editTitle":"features.business.project.form.createTitle")}),e.jsx(Fe,{children:s(y?"features.business.project.form.editDescription":"features.business.project.form.createDescription")})]}),e.jsx(Se,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(I),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(c,{control:a.control,name:"title",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.title")}),e.jsx(u,{children:e.jsx(j,{placeholder:s("features.business.project.form.fields.titlePlaceholder"),...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"description",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-start gap-4 space-y-0",children:[e.jsx(m,{className:"text-right pt-2",children:s("features.business.project.form.fields.description")}),e.jsx(u,{children:e.jsx(V,{placeholder:s("features.business.project.form.fields.descriptionPlaceholder"),className:"resize-none",...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"name",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.name")}),e.jsx(u,{children:e.jsx(j,{placeholder:s("features.business.project.form.fields.namePlaceholder"),...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"metaTitle",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.metaTitle")}),e.jsx(u,{children:e.jsx(j,{placeholder:s("features.business.project.form.fields.metaTitlePlaceholder"),...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"metaDescription",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-start gap-4 space-y-0",children:[e.jsx(m,{className:"text-right pt-2",children:s("features.business.project.form.fields.metaDescription")}),e.jsx(u,{children:e.jsx(V,{placeholder:s("features.business.project.form.fields.metaDescriptionPlaceholder"),className:"resize-none",...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"keywords",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.keywords")}),e.jsx(u,{children:e.jsx(j,{placeholder:s("features.business.project.form.fields.keywordsPlaceholder"),...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"domain",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.domain")}),e.jsx(u,{children:e.jsx(j,{placeholder:s("features.business.project.form.fields.domainPlaceholder"),...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"postUrl",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.postUrl")}),e.jsx(u,{children:e.jsx(j,{placeholder:s("features.business.project.form.fields.postUrlPlaceholder"),...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"icp",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.icp")}),e.jsx(u,{children:e.jsx(j,{placeholder:s("features.business.project.form.fields.icpPlaceholder"),...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"publicSecurity",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.publicSecurity")}),e.jsx(u,{children:e.jsx(j,{placeholder:s("features.business.project.form.fields.publicSecurityPlaceholder"),...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"author",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.author")}),e.jsx(u,{children:e.jsx(j,{placeholder:s("features.business.project.form.fields.authorPlaceholder"),...r})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"favicon",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.favicon")}),e.jsx(u,{children:e.jsx("button",{type:"button",onClick:()=>g("favicon"),className:E("flex flex-col items-center justify-center h-20 w-20 rounded-lg border-2 border-dashed border-border bg-muted/30 overflow-hidden transition-all shrink-0","cursor-pointer hover:border-primary/50 hover:bg-muted/50"),children:r.value?e.jsx("img",{src:r.value,alt:"",className:"h-full w-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-8 w-8 text-muted-foreground mb-1"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s("features.business.project.form.fields.selectImage")})]})})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"navImage",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-center gap-4 space-y-0",children:[e.jsx(m,{className:"text-right",children:s("features.business.project.form.fields.navImage")}),e.jsx(u,{children:e.jsx("button",{type:"button",onClick:()=>g("navImage"),className:E("flex flex-col items-center justify-center h-20 w-20 rounded-lg border-2 border-dashed border-border bg-muted/30 overflow-hidden transition-all shrink-0","cursor-pointer hover:border-primary/50 hover:bg-muted/50"),children:r.value?e.jsx("img",{src:r.value,alt:"",className:"h-full w-full object-cover"}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-8 w-8 text-muted-foreground mb-1"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s("features.business.project.form.fields.selectImage")})]})})}),e.jsx(p,{className:"col-start-2"})]})}),e.jsx(c,{control:a.control,name:"baiduAnalytics",render:({field:r})=>e.jsxs(d,{className:"grid grid-cols-[160px_1fr] items-start gap-4 space-y-0",children:[e.jsx(m,{className:"text-right pt-2",children:s("features.business.project.form.fields.baiduAnalytics")}),e.jsx(u,{children:e.jsx(V,{placeholder:s("features.business.project.form.fields.baiduAnalyticsPlaceholder"),className:"resize-none",...r})}),e.jsx(p,{className:"col-start-2"})]})})]})}),e.jsxs(_e,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>v(!1),disabled:h,children:s("features.business.project.form.cancel")}),e.jsx(w,{type:"button",disabled:h,onClick:a.handleSubmit(I),children:s(h?"features.business.project.form.submitting":y?"features.business.project.form.save":"features.business.project.form.create")})]})]}),e.jsx(ke,{open:x!==null,onOpenChange:r=>!r&&g(null),onSelect:r=>{x&&(a.setValue(x,r.url,{shouldValidate:!0}),g(null))},type:1,title:s("features.business.project.form.fields.selectImage"),description:s("features.business.project.form.fields.favicon")})]})}function Ue(){const{t:o}=G(),v=le(),[i,N]=f.useState(null),[h,s]=f.useState(null),[y,x]=f.useState(null),[g,_]=f.useState([]),[a,I]=f.useState({pageIndex:0,pageSize:10}),[r,J]=f.useState([]),[W,X]=f.useState({}),z=f.useMemo(()=>{const t=C=>{const T=g.find(oe=>oe.id===C);return T?.value&&Array.isArray(T.value)?T.value[0]||"":T?.value||""},l=t("title"),D=t("projectID");return{current:1,title:l,projectID:D,pageNum:a.pageIndex+1,pageSize:a.pageSize}},[g,a]),{data:A,isLoading:Y,error:Z}=ce({queryKey:["projectList",z],queryFn:()=>ze(z),placeholderData:ne}),q=A?.projects||[],$=A?.total||0,ee=Math.ceil($/a.pageSize),P=f.useMemo(()=>[{accessorKey:"projectID",header:({column:t})=>e.jsx(R,{column:t,title:o("features.business.project.columns.id")}),cell:({row:t})=>e.jsx("div",{className:"font-medium",children:t.getValue("projectID")})},{accessorKey:"title",header:({column:t})=>e.jsx(R,{column:t,title:o("features.business.project.columns.projectName")}),cell:({row:t})=>e.jsx("div",{className:"font-medium",children:t.getValue("title")})},{accessorKey:"description",header:({column:t})=>e.jsx(R,{column:t,title:o("features.business.project.columns.projectDescription")}),cell:({row:t})=>{const l=t.getValue("description");return e.jsx("div",{className:"max-w-[300px] truncate",title:l,children:l||"-"})}},{id:"actions",header:o("features.business.project.columns.actions"),cell:({row:t})=>{const l=t.original;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(H,{children:[e.jsx(O,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{x(l),N("edit")},children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsx(B,{children:o("features.business.project.actions.edit")})]}),e.jsxs(H,{children:[e.jsx(O,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>s(l.projectID),children:e.jsx(me,{className:"h-4 w-4 text-destructive"})})}),e.jsx(B,{children:o("features.business.project.actions.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[o]),b=ue({data:q,columns:P,getCoreRowModel:fe(),getSortedRowModel:pe(),manualPagination:!0,pageCount:ee,onSortingChange:J,onColumnFiltersChange:_,onColumnVisibilityChange:X,onPaginationChange:I,state:{sorting:r,columnFilters:g,columnVisibility:W,pagination:a}}),U=M({mutationFn:t=>Me(t),onSuccess:()=>{k.success("创建成功"),v.invalidateQueries({queryKey:["projectList"]}),N(null),x(null)}}),K=M({mutationFn:t=>Re(t),onSuccess:()=>{k.success("更新成功"),v.invalidateQueries({queryKey:["projectList"]}),N(null),x(null)}}),L=M({mutationFn:t=>Ve(t),onSuccess:()=>{k.success("删除成功"),v.invalidateQueries({queryKey:["projectList"]}),s(null)}}),se=()=>{x(null),N("create")},te=t=>{i==="create"?U.mutate(t):i==="edit"&&K.mutate(t)},re=()=>{h&&L.mutate(h)},ae=q.find(t=>t.projectID===h);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(xe,{title:o("features.business.project.title"),description:o("features.business.project.description"),children:e.jsxs(w,{onClick:se,children:[e.jsx(je,{className:"h-4 w-4"}),o("features.business.project.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(j,{type:"text",placeholder:o("features.business.project.search.projectName"),value:b.getColumn("title")?.getFilterValue()??"",onChange:t=>b.getColumn("title")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"}),e.jsx(j,{type:"text",placeholder:o("features.business.project.search.projectID"),value:b.getColumn("projectID")?.getFilterValue()??"",onChange:t=>b.getColumn("projectID")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"})]})}),e.jsxs(he,{children:[e.jsx(ge,{children:b.getHeaderGroups().map(t=>e.jsx(S,{children:t.headers.map(l=>{const D=l.isPlaceholder?null:typeof l.column.columnDef.header=="function"?l.column.columnDef.header(l.getContext()):l.column.columnDef.header,C=l.column.columnDef.meta;return e.jsx(be,{className:C?.thClassName,children:D},l.id)})},t.id))}),e.jsx(Ne,{children:Y?e.jsx(S,{children:e.jsx(F,{colSpan:P.length,className:"h-24 text-center",children:o("features.business.project.loading")})}):Z?e.jsx(S,{children:e.jsx(F,{colSpan:P.length,className:"h-24 text-center text-destructive",children:o("features.business.project.loadError")})}):b.getRowModel().rows?.length?b.getRowModel().rows.map(t=>e.jsx(S,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(l=>{const D=typeof l.column.columnDef.cell=="function"?l.column.columnDef.cell(l.getContext()):l.column.columnDef.cell,C=l.column.columnDef.meta;return e.jsx(F,{className:C?.tdClassName,children:D},l.id)})},t.id)):e.jsx(S,{children:e.jsx(F,{colSpan:P.length,className:"h-24 text-center",children:o("features.business.project.noData")})})})]}),e.jsx(ye,{table:b})]}),e.jsx(qe,{open:i!==null,onOpenChange:t=>{t||(N(null),x(null))},project:y,onSubmit:te,isLoading:i==="create"?U.isPending:K.isPending}),e.jsx(ve,{open:h!==null,onOpenChange:t=>{t||s(null)},title:o("features.business.project.confirmDelete"),desc:o("features.business.project.confirmDeleteMessage",{title:ae?.title}),handleConfirm:re,destructive:!0,confirmText:o("features.business.project.actions.delete"),isLoading:L.isPending})]})}const hs=Ue;export{hs as component};
