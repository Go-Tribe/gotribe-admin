import{a as G,l as B,r as o,A as oe,t as g,j as e,B as f,C as U,K as ce}from"./index-Pe1Nv6hH.js";import{u as Q}from"./useQuery-DDON36P9.js";import{u as P}from"./useMutation-uvHqRPk1.js";import{u as le,c as ie}from"./react-icons.esm-CiMB90YA.js";import{S as ue,a as de,b as me,c as fe,d as xe}from"./select-Dl4KSF7A.js";import{S as pe}from"./index-BmISbovJ.js";import{D as he}from"./pagination-B86K5cVv.js";import{C as ge}from"./confirm-dialog-DmDS_GmK.js";import{a as je,F as a,b as ve,u as Ne,d as ye,g as be}from"./resource-u0oZDgOZ.js";import{u as we,a as Ce,F as Se,L as y,b as A,c as q,d as V,e as $,f as K}from"./form-DU65aaqX.js";import{D as Ee,a as ke,b as Ie,c as Fe,e as De}from"./dialog-DHifiqsD.js";import{I as b}from"./input-DW-mBlUw.js";import{L as I}from"./loader-circle-DjNfctPA.js";import{F as R,U as Pe}from"./upload-CE8x_1SM.js";import{C as w,P as Re}from"./pencil-G2ARerfI.js";import{V as Te}from"./video-Bs8fCpLF.js";import{I as Me}from"./image-D4KB7jNL.js";import{T as Le}from"./trash-2-DxKhJZhR.js";import{X as ze}from"./index-D68Ta3NN.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./sidebar-BFSPGCEL.js";import"./index-DGhUbGt9.js";const Oe=t=>oe({title:U().min(1,t("features.content.resource.form.validation.titleRequired")),description:U().min(1,t("features.content.resource.form.validation.descriptionRequired"))}),Ue=t=>({[a.IMAGE]:t("features.content.resource.filter.image"),[a.VIDEO]:t("features.content.resource.filter.video"),[a.AUDIO]:t("features.content.resource.filter.audio"),[a.ARCHIVE]:t("features.content.resource.filter.archive"),[a.DOCUMENT]:t("features.content.resource.filter.document"),[a.FONT]:t("features.content.resource.filter.font"),[a.APP]:t("features.content.resource.filter.app"),[a.UNKNOWN]:t("features.content.resource.filter.unknown")});function Ae(t){return t==null?"-":t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(2)} KB`:`${(t/(1024*1024)).toFixed(2)} MB`}function H(t,l){const i=(t??"").replace(/\/+$/,""),u=(l??"").replace(/^\/+/,"");return u?`${i}/${u}`:i||""}function qe({open:t,onOpenChange:l,resourceID:i,onSuccess:u}){const{t:r}=G(),c=B(),x=o.useMemo(()=>Oe(r),[r]),p=o.useMemo(()=>Ue(r),[r]),d=we({resolver:Ce(x),defaultValues:{title:"",description:""}}),{data:n,isLoading:v}=Q({queryKey:["resourceDetail",i],queryFn:()=>ve(i),enabled:t&&!!i});o.useEffect(()=>{n&&d.reset({title:(n.title??"").trim(),description:(n.description??"").trim()})},[n,d]);const{mutate:C,isPending:N}=P({mutationFn:m=>je(i,{title:m.title.trim(),description:m.description.trim()}),onSuccess:()=>{g.success(r("features.content.resource.form.saveSuccess")),u?.(),c.invalidateQueries({queryKey:["resourceList"]}),l(!1)},onError:m=>{g.error(m instanceof Error?m.message:r("features.content.resource.form.saveFailed"))}}),S=m=>{navigator.clipboard.writeText(m).then(()=>g.success(r("features.content.resource.copySuccessShort")))},j=m=>{C(m)};return t?e.jsx(Ee,{open:t,onOpenChange:l,children:e.jsxs(ke,{className:"sm:max-w-[500px]",children:[e.jsx(Ie,{children:e.jsx(Fe,{children:r("features.content.resource.form.editTitle")})}),v?e.jsx("div",{className:"flex min-h-[200px] items-center justify-center py-8",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):n?e.jsx(Se,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(j),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{className:"text-muted-foreground",children:r("features.content.resource.form.preview")}),e.jsx("div",{className:"mt-1.5 flex h-20 w-20 items-center justify-center overflow-hidden rounded border bg-muted",children:n.fileType===a.IMAGE?e.jsx("img",{src:H(n.url,n.path),alt:n.title,className:"h-full w-full object-cover"}):e.jsx(R,{className:"h-10 w-10 text-muted-foreground"})})]}),e.jsx(A,{control:d.control,name:"title",render:({field:m})=>e.jsxs(q,{className:"space-y-2",children:[e.jsx(V,{htmlFor:"resource-title",children:r("features.content.resource.form.title")}),e.jsx($,{children:e.jsx(b,{id:"resource-title",placeholder:r("features.content.resource.form.titlePlaceholder"),...m})}),e.jsx(K,{})]})}),e.jsx(A,{control:d.control,name:"description",render:({field:m})=>e.jsxs(q,{className:"space-y-2",children:[e.jsx(V,{htmlFor:"resource-desc",children:r("features.content.resource.form.description")}),e.jsx($,{children:e.jsx(b,{id:"resource-desc",placeholder:r("features.content.resource.form.descriptionPlaceholder"),...m})}),e.jsx(K,{})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(y,{className:"text-muted-foreground",children:r("features.content.resource.form.resourceType")}),e.jsx("p",{className:"text-sm",children:p[n.fileType]??r("features.content.resource.form.typeFallback",{type:n.fileType})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(y,{className:"text-muted-foreground",children:r("features.content.resource.form.uploadTime")}),e.jsx("p",{className:"text-sm",children:n.createdAt??"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(y,{className:"text-muted-foreground",children:r("features.content.resource.form.resourceSize")}),e.jsx("p",{className:"text-sm",children:Ae(n.size)})]})]}),e.jsx(Ve,{detail:n,onCopy:S,t:r}),e.jsxs(De,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>l(!1),children:r("features.content.resource.form.cancel")}),e.jsx(f,{type:"submit",disabled:N,children:N?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 animate-spin"}),r("features.content.resource.form.submitting")]}):r("features.content.resource.form.submit")})]})]})}):e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:r("features.content.resource.loadFailed")})]})}):null}function Ve({detail:t,onCopy:l,t:i}){const u=H(t.url,t.path),r=(t.path??"").trim(),c=(t.title??"").trim(),x=`<img src="${u}" alt="${c.replace(/"/g,"&quot;")}" />`,p=`![${c}](${u})`,d=i("features.content.resource.actions.copy");return e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{className:"text-muted-foreground",children:i("features.content.resource.form.links")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{readOnly:!0,value:r||u,className:"font-mono text-xs"}),e.jsx(f,{type:"button",variant:"outline",size:"icon",onClick:()=>l(r||u),title:d,children:e.jsx(w,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"HTML"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{readOnly:!0,value:x,className:"font-mono text-xs"}),e.jsx(f,{type:"button",variant:"outline",size:"icon",onClick:()=>l(x),title:d,children:e.jsx(w,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Markdown"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{readOnly:!0,value:p,className:"font-mono text-xs"}),e.jsx(f,{type:"button",variant:"outline",size:"icon",onClick:()=>l(p),title:d,children:e.jsx(w,{className:"h-4 w-4"})})]})]})]})]})}const $e=t=>[{value:"0",label:t("features.content.resource.filter.all")},{value:String(a.IMAGE),label:t("features.content.resource.filter.image")},{value:String(a.VIDEO),label:t("features.content.resource.filter.video")},{value:String(a.AUDIO),label:t("features.content.resource.filter.audio")},{value:String(a.ARCHIVE),label:t("features.content.resource.filter.archive")},{value:String(a.DOCUMENT),label:t("features.content.resource.filter.document")},{value:String(a.FONT),label:t("features.content.resource.filter.font")},{value:String(a.APP),label:t("features.content.resource.filter.app")},{value:String(a.UNKNOWN),label:t("features.content.resource.filter.unknown")}];function Ke(t,l=14){return t.length<=l?t:`${t.slice(0,8)}...`}function Ge(){const{t}=G(),l=B(),[i,u]=o.useState("0"),r=o.useMemo(()=>$e(t),[t]),[c,x]=o.useState({pageIndex:0,pageSize:10}),[p,d]=o.useState(null),[n,v]=o.useState(null),[C,N]=o.useState(null),[S,j]=o.useState(0),m=o.useRef(null),T=o.useRef(null),M=o.useMemo(()=>({type:i==="0"?void 0:Number(i),pageNum:c.pageIndex+1,pageSize:c.pageSize}),[i,c.pageIndex,c.pageSize]),{data:F,isLoading:W,error:_}=Q({queryKey:["resourceList",M],queryFn:()=>be(M),placeholderData:ce}),D=o.useMemo(()=>F?.list??[],[F?.list]),X=F?.total??0,Y=Math.max(1,Math.ceil(X/c.pageSize)),J=le({data:D,columns:o.useMemo(()=>[{id:"_placeholder",header:"",cell:()=>null}],[]),getCoreRowModel:ie(),manualPagination:!0,pageCount:Y,state:{pagination:c},onPaginationChange:s=>{const h=typeof s=="function"?s(c):c;x(h.pageSize!==c.pageSize?{...h,pageIndex:0}:h)}}),{mutate:L,isPending:E}=P({mutationFn:({file:s,type:h,onProgress:k})=>Ne(s,h,k),onSuccess:()=>{g.success(t("features.content.resource.uploadSuccess")),l.invalidateQueries({queryKey:["resourceList"]}),j(0)},onError:s=>{g.error(s instanceof Error?s.message:t("features.content.resource.uploadError")),j(0)}}),{mutate:Z,isPending:ee}=P({mutationFn:s=>ye(s),onSuccess:()=>{g.success(t("features.content.resource.deleteSuccess")),d(null),l.invalidateQueries({queryKey:["resourceList"]})},onError:s=>{g.error(s instanceof Error?s.message:t("features.content.resource.deleteError"))}}),z=o.useCallback(s=>{navigator.clipboard.writeText(s).then(()=>g.success(t("features.content.resource.copySuccess")))},[t]),te=o.useCallback(s=>{v(s.id)},[]),se=o.useCallback(s=>{N(s)},[]),re=o.useCallback(s=>{d(s.id)},[]),ae=o.useCallback(()=>{m.current?.click()},[]),ne=o.useCallback(()=>{T.current?.click()},[]),O=o.useCallback((s,h)=>{const k=s.target.files?.[0];k&&(j(0),L({file:k,type:h,onProgress:j}),s.target.value="")},[L]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(pe,{title:t("features.content.resource.title"),description:t("features.content.resource.description")})}),e.jsxs("div",{className:"rounded-md border mx-4 p-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground whitespace-nowrap",children:t("features.content.resource.filter.typeLabel")}),e.jsxs(ue,{value:i,onValueChange:s=>{u(s),x(h=>({...h,pageIndex:0}))},children:[e.jsx(de,{className:"w-[140px] h-9",children:e.jsx(me,{placeholder:t("features.content.resource.filter.placeholder")})}),e.jsx(fe,{children:r.map(s=>e.jsx(xe,{value:s.value,children:s.label},s.value))})]}),e.jsx("div",{className:"flex-1"}),E&&e.jsxs("div",{className:"flex items-center gap-2 w-[180px] shrink-0",children:[e.jsx("div",{className:"h-2 flex-1 min-w-0 rounded-full bg-muted",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all duration-300",style:{width:`${S}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0 tabular-nums",children:[S,"%"]})]}),e.jsx("input",{ref:m,type:"file",className:"hidden",accept:"*/*",onChange:s=>O(s,a.IMAGE)}),e.jsx("input",{ref:T,type:"file",className:"hidden",accept:"video/*",onChange:s=>O(s,a.VIDEO)}),e.jsxs(f,{variant:"default",size:"sm",className:"h-9",onClick:ae,disabled:E,children:[E?e.jsx(I,{className:"h-4 w-4 animate-spin"}):e.jsx(Pe,{className:"h-4 w-4"}),t("features.content.resource.actions.uploadResource")]}),e.jsxs(f,{variant:"default",size:"sm",className:"h-9",onClick:ne,disabled:E,children:[e.jsx(Te,{className:"h-4 w-4"}),t("features.content.resource.actions.uploadVideo")]})]}),e.jsx("div",{className:"min-h-[320px]",children:W?e.jsx("div",{className:"flex h-[320px] items-center justify-center",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):_?e.jsx("div",{className:"flex h-[320px] items-center justify-center text-destructive",children:t("features.content.resource.loadError")}):D.length===0?e.jsxs("div",{className:"flex h-[320px] flex-col items-center justify-center gap-2 text-muted-foreground",children:[e.jsx(Me,{className:"h-12 w-12"}),e.jsx("p",{children:t("features.content.resource.noData")})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:D.map(s=>e.jsx(Be,{resource:s,onCopyUrl:z,onEdit:te,onDelete:re,onPreview:se,t},s.id))})}),e.jsx("div",{className:"border-t pt-4",children:e.jsx(he,{table:J})})]}),e.jsx(qe,{open:n!==null,onOpenChange:s=>!s&&v(null),resourceID:n,onSuccess:()=>v(null)}),C&&e.jsx(Qe,{resource:C,onClose:()=>N(null),onCopyUrl:z,t}),e.jsx(ge,{open:p!==null,onOpenChange:s=>!s&&d(null),title:t("features.content.resource.confirmDelete"),desc:t("features.content.resource.confirmDeleteDesc"),destructive:!0,confirmText:t("features.content.resource.actions.delete"),handleConfirm:()=>p&&Z(p),isLoading:ee})]})}function Be({resource:t,onCopyUrl:l,onEdit:i,onDelete:u,onPreview:r,t:c}){const[x,p]=o.useState(!1),d=t.type===a.IMAGE;return e.jsxs("div",{className:"group flex w-full min-w-0 flex-col rounded-lg border overflow-hidden bg-card",children:[e.jsxs("div",{className:"relative w-full aspect-square min-h-0 overflow-hidden bg-muted cursor-pointer",role:"button",tabIndex:0,onClick:()=>r(t),onKeyDown:n=>n.key==="Enter"&&r(t),"aria-label":c("features.content.resource.actions.preview"),children:[d&&!x?e.jsx("img",{src:t.url,alt:t.name,className:"h-full w-full object-cover object-center",loading:"lazy",onError:()=>p(!0)}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-muted-foreground text-sm",children:d&&x?c("features.content.resource.loadFailed"):e.jsx(R,{className:"h-10 w-10"})}),e.jsxs("div",{className:"absolute top-1.5 right-1.5 flex items-center gap-1 rounded-md bg-black/60 px-1 py-1 backdrop-blur-sm opacity-0 transition-opacity group-hover:opacity-100",children:[e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7 text-white hover:bg-white/20 hover:text-white",onClick:n=>{n.stopPropagation(),i(t)},title:c("features.content.resource.actions.edit"),children:e.jsx(Re,{className:"h-3.5 w-3.5"})}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7 text-white hover:bg-white/20 hover:text-white",onClick:n=>{n.stopPropagation(),l(t.url)},title:c("features.content.resource.actions.copyUrl"),children:e.jsx(w,{className:"h-3.5 w-3.5"})}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7 text-white hover:bg-destructive hover:text-destructive-foreground",onClick:n=>{n.stopPropagation(),u(t)},title:c("features.content.resource.actions.delete"),children:e.jsx(Le,{className:"h-3.5 w-3.5"})})]})]}),e.jsx("div",{className:"h-9 px-2 flex items-center shrink-0",title:t.name,children:e.jsx("span",{className:"truncate text-xs text-muted-foreground w-full",children:Ke(t.name)})})]})}function Qe({resource:t,onClose:l,onCopyUrl:i,t:u}){return o.useEffect(()=>{const r=c=>c.key==="Escape"&&l();return window.addEventListener("keydown",r),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",r),document.body.style.overflow=""}},[l]),e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",onClick:l,role:"dialog","aria-modal":!0,"aria-label":u("features.content.resource.actions.preview"),children:[e.jsx("button",{type:"button",className:"absolute top-4 right-4 z-10 rounded-full p-2 text-white hover:bg-white/20 transition-colors",onClick:l,"aria-label":u("features.content.resource.actions.close"),children:e.jsx(ze,{className:"h-6 w-6"})}),e.jsxs("div",{className:"relative max-h-[90vh] max-w-[90vw] flex items-center justify-center",onClick:r=>r.stopPropagation(),children:[t.type===a.IMAGE&&e.jsx("img",{src:t.url,alt:t.name,className:"max-h-[90vh] max-w-full object-contain"}),t.type===a.VIDEO&&e.jsx("video",{src:t.url,controls:!0,autoPlay:!0,className:"max-h-[90vh] max-w-full",onClick:r=>r.stopPropagation()}),t.type===a.AUDIO&&e.jsxs("div",{className:"rounded-lg bg-card p-6 shadow-xl",children:[e.jsx("audio",{src:t.url,controls:!0,autoPlay:!0}),e.jsx("p",{className:"mt-2 text-center text-sm text-muted-foreground",children:t.name})]}),![a.IMAGE,a.VIDEO,a.AUDIO].includes(t.type)&&e.jsxs("div",{className:"rounded-lg bg-card p-8 shadow-xl text-center",children:[e.jsx(R,{className:"mx-auto h-16 w-16 text-muted-foreground"}),e.jsx("p",{className:"mt-4 max-w-xs truncate font-medium",title:t.name,children:t.name}),e.jsxs(f,{type:"button",variant:"outline",size:"sm",className:"mt-4",onClick:r=>{r.stopPropagation(),i(t.url)},children:[e.jsx(w,{className:"h-4 w-4"}),u("features.content.resource.actions.copyLink")]})]})]})]})}const jt=Ge;export{jt as component};
