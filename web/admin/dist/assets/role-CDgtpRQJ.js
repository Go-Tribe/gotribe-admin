import{a as Y,r as d,A as Me,j as e,B as w,C as se,J as de,f as G,t as O,l as Te}from"./index-Pe1Nv6hH.js";import{u as $}from"./useQuery-DDON36P9.js";import{u as te}from"./useMutation-uvHqRPk1.js";import{C as me,a as he,P as Fe,T as Ae,u as Re,b as ze,g as Ve,c as Pe}from"./react-icons.esm-CiMB90YA.js";import{T as W,v as Z,w as J}from"./sidebar-BFSPGCEL.js";import{I as H}from"./input-DW-mBlUw.js";import{D as Le}from"./faceted-filter-BDTVtMjs.js";import{S as Ee}from"./index-BmISbovJ.js";import{D as A,T as _e,a as qe,b as E,c as Ke,d as Ie,e as U}from"./column-header-Cfszq_dp.js";import{D as Be}from"./pagination-B86K5cVv.js";import{B as Oe}from"./badge-T19Q3klL.js";import{g as He}from"./status-variants-Dh7YK7JP.js";import{C as $e}from"./confirm-dialog-DmDS_GmK.js";import{u as Qe,a as We,F as Ze,b as _,c as q,d as K,e as I,f as B,g as Je}from"./form-DU65aaqX.js";import{D as re,a as ae,b as ne,c as le,d as Ue,e as ie}from"./dialog-DHifiqsD.js";import{T as Ge}from"./textarea-D-N386t0.js";import{S as Xe,a as Ye,b as es,c as ss,d as ue}from"./select-Dl4KSF7A.js";import{C as fe,u as ts,g as rs,a as as,b as ns,c as ls,d as is,e as os,f as cs,h as ds}from"./role-xokosi1z.js";import{S as xe}from"./scroll-area-BCr0FWtA.js";import{g as us}from"./menu-B3WTQ4n5.js";import{S as ms}from"./settings-CTuF3-1m.js";import{F as hs}from"./folder-cog-CGOOjEf3.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-D68Ta3NN.js";import"./index-SpxnGYUf.js";import"./index-C8jai3VV.js";import"./command-D9eDedTW.js";import"./index-DGhUbGt9.js";import"./search-DNOmmJ4K.js";import"./popover-CrxLZKyN.js";import"./separator-Bq1fgMtF.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-4GH7Kv3S.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";const fs=s=>Me({name:se().min(1,s("features.system.role.form.validation.nameRequired")),keyword:se().min(1,s("features.system.role.form.validation.keywordRequired")).regex(/^[a-zA-Z0-9]+$/,s("features.system.role.form.validation.keywordInvalid")),sort:de().int().min(1).max(99),status:de().min(1).max(2),desc:se().optional()});function xs({open:s,onOpenChange:n,role:r,onSubmit:g,isLoading:l=!1}){const{t:a}=Y(),i=!!r,[S,C]=d.useState(""),m=d.useMemo(()=>fs(a),[a]),N=Qe({resolver:We(m),defaultValues:{name:"",keyword:"",sort:1,status:1,desc:""}});d.useEffect(()=>{if(s)if(i&&r){const o=Math.max(1,Math.min(99,r.sort||1));N.reset({name:r.name,keyword:r.keyword,sort:o,status:r.status,desc:r.desc}),setTimeout(()=>C(String(o)),0)}else N.reset({name:"",keyword:"",sort:1,status:1,desc:""}),setTimeout(()=>C("1"),0)},[s,i,r,N]);const h=o=>{g({...o,id:r?.id})};return e.jsx(re,{open:s,onOpenChange:n,children:e.jsxs(ae,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(ne,{className:"shrink-0",children:[e.jsx(le,{children:a(i?"features.system.role.form.editTitle":"features.system.role.form.createTitle")}),e.jsx(Ue,{children:a(i?"features.system.role.form.editDescription":"features.system.role.form.createDescription")})]}),e.jsx(Ze,{...N,children:e.jsxs("form",{onSubmit:N.handleSubmit(h),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(_,{control:N.control,name:"name",render:({field:o})=>e.jsxs(q,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(K,{className:"text-right",children:a("features.system.role.name")}),e.jsx(I,{children:e.jsx(H,{placeholder:a("features.system.role.form.namePlaceholder"),...o})}),e.jsx(B,{className:"col-start-2"})]})}),e.jsx(_,{control:N.control,name:"keyword",render:({field:o})=>e.jsxs(q,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(K,{className:"text-right",children:a("features.system.role.keyword")}),e.jsx(I,{children:e.jsx(H,{placeholder:a("features.system.role.form.keywordPlaceholder"),...o,onChange:y=>{const f=y.target.value.replace(/[^a-zA-Z0-9]/g,"");o.onChange(f)}})}),e.jsx(B,{className:"col-start-2"})]})}),e.jsx(_,{control:N.control,name:"sort",render:({field:o})=>e.jsxs(q,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(K,{className:"text-right",children:a("features.system.role.sort")}),e.jsx(I,{children:e.jsx(H,{type:"number",placeholder:a("features.system.role.form.sortPlaceholder"),value:S,onChange:y=>{const f=y.target.value;C(f)},onBlur:()=>{const y=Number(S);let f=1;!isNaN(y)&&S!==""&&(y>99?f=99:y<1?f=1:f=y),C(String(f)),o.onChange(f),o.onBlur()},min:1,max:99})}),e.jsx(Je,{className:"col-start-2",children:a("features.system.role.form.sortDescription")}),e.jsx(B,{className:"col-start-2"})]})}),e.jsx(_,{control:N.control,name:"status",render:({field:o})=>e.jsxs(q,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(K,{className:"text-right",children:a("features.system.role.status")}),e.jsxs(Xe,{onValueChange:y=>o.onChange(Number(y)),value:String(o.value),children:[e.jsx(I,{children:e.jsx(Ye,{children:e.jsx(es,{placeholder:a("features.system.role.form.statusPlaceholder")})})}),e.jsxs(ss,{children:[e.jsx(ue,{value:"1",children:a("features.system.role.enabled")}),e.jsx(ue,{value:"2",children:a("features.system.role.disabled")})]})]}),e.jsx(B,{className:"col-start-2"})]})}),e.jsx(_,{control:N.control,name:"desc",render:({field:o})=>e.jsxs(q,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(K,{className:"text-right pt-2",children:a("features.system.role.desc")}),e.jsx(I,{children:e.jsx(Ge,{placeholder:a("features.system.role.form.descPlaceholder"),className:"resize-none",...o})}),e.jsx(B,{className:"col-start-2"})]})})]})}),e.jsxs(ie,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:l,children:a("features.system.role.form.cancel")}),e.jsx(w,{type:"button",disabled:l,onClick:N.handleSubmit(h),children:a(l?"features.system.role.form.submitting":i?"features.system.role.form.save":"features.system.role.form.create")})]})]})})}function pe(s){const n=[];return s.children&&s.children.forEach(r=>{n.push(r.id),n.push(...pe(r))}),n}function ps(s,n){const r=[];let g=s;for(;n.has(g);){const l=n.get(g);r.push(l),g=l}return r}function X(s,n){return!s.children||s.children.length===0?!0:s.children.every(r=>n.has(Number(r.id))&&X(r,n))}function ge(s,n){return!s.children||s.children.length===0?!1:s.children.some(r=>n.has(Number(r.id))||ge(r,n))}function ye({menu:s,selectedMenuIds:n,onToggleWithChildren:r,level:g=0}){const[l,a]=d.useState(!0),i=s.children&&s.children.length>0,S=Number(s.id),C=n.has(S),m=d.useMemo(()=>{if(!i)return!1;const h=ge(s,n),o=X(s,n);return h&&!o},[s,n,i]),N=h=>{const o=h===!0,y=i?pe(s):[];r(Number(s.id),o,y)};return e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:G("flex items-center gap-2 py-1.5 px-2 rounded-md hover:bg-accent transition-colors",g>0&&"ml-4"),style:{paddingLeft:`${g*16+8}px`},children:[i?e.jsx("button",{type:"button",onClick:()=>a(!l),className:"flex items-center justify-center w-4 h-4 hover:bg-accent rounded",children:l?e.jsx(me,{className:"h-3 w-3"}):e.jsx(he,{className:"h-3 w-3"})}):e.jsx("div",{className:"w-4"}),e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx(fe,{checked:C,onCheckedChange:N,className:G(m&&!C&&"border-primary bg-primary/50")}),m&&!C&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-2 h-0.5 bg-primary-foreground rounded"})})]}),e.jsx("label",{className:"flex-1 cursor-pointer text-sm",onClick:()=>N(!C),children:s.title||s.name})]}),i&&l&&e.jsx("div",{children:s.children.map(h=>e.jsx(ye,{menu:h,selectedMenuIds:n,onToggleWithChildren:r,level:g+1},h.id))})]})}function gs({open:s,onOpenChange:n,roleId:r,roleName:g}){const{t:l}=Y(),[a,i]=d.useState(new Set),[S,C]=d.useState(!1),{data:m,isLoading:N}=$({queryKey:["menuList"],queryFn:()=>us(),enabled:s}),{data:h,isLoading:o}=$({queryKey:["roleMenus",r],queryFn:()=>r?rs(r):Promise.resolve({menus:[]}),enabled:s&&r!==null}),{menuTree:y,menuMap:f,parentMap:M}=d.useMemo(()=>{if(!m?.menus||m.menus.length===0)return{menuTree:[],menuMap:new Map,parentMap:new Map};const j=new Map,u=new Map,x=[];return m.menus.forEach(c=>{j.set(c.id,{...c,children:[]})}),m.menus.forEach(c=>{const b=j.get(c.id);if(c.parentID===0||!c.parentID)x.push(b);else{const T=j.get(c.parentID);T?(T.children||(T.children=[]),T.children.push(b),u.set(c.id,c.parentID)):x.push(b)}}),{menuTree:x,menuMap:j,parentMap:u}},[m?.menus]),D=d.useCallback(j=>{if(f.size===0)return j;const u=new Set(j);return f.forEach((x,c)=>{x.children&&x.children.length>0&&(X(x,u)?u.add(c):u.delete(c))}),u},[f]);d.useEffect(()=>{if(!s){i(new Set);return}if(!r){i(new Set);return}if(!o&&f.size>0)if(h?.menus&&Array.isArray(h.menus)){const j=h.menus.map(c=>Number(c.id)).filter(c=>!isNaN(c)&&c>0),u=new Set(j),x=D(u);i(x)}else i(new Set)},[h,s,o,r,f.size,D]);const R=d.useCallback((j,u,x)=>{i(c=>{const b=new Set(c);return u?b.add(j):b.delete(j),x.forEach(v=>{u?b.add(Number(v)):b.delete(Number(v))}),ps(j,M).forEach(v=>{const k=f.get(v);k&&(X(k,b)?b.add(v):b.delete(v))}),b})},[M,f]),z=d.useCallback(()=>{if(!m?.menus)return;const j=new Set(m.menus.map(u=>Number(u.id)));a.size===j.size?i(new Set):i(j)},[m?.menus,a.size]),V=async()=>{if(r){C(!0);try{await ts(r,{menuIds:Array.from(a)}),O.success(l("features.system.role.permission.updateSuccess")),n(!1)}catch{}finally{C(!1)}}},F=N||o;return e.jsx(re,{open:s,onOpenChange:n,children:e.jsxs(ae,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsx(ne,{className:"shrink-0",children:e.jsx(le,{children:l("features.system.role.permission.title",{name:g||""})})}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between shrink-0",children:[e.jsx(w,{type:"button",variant:"outline",size:"sm",onClick:z,disabled:F,children:a.size===m?.menus?.length?l("features.system.role.permission.unselectAll"):l("features.system.role.permission.selectAll")}),e.jsx("span",{className:"text-sm text-muted-foreground",children:l("features.system.role.permission.selectedCount",{count:a.size,total:m?.menus?.length||0})})]}),e.jsx("div",{className:"flex-1 h-full border rounded-md overflow-hidden overflow-y-auto",children:e.jsx(xe,{className:"h-full",children:F?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:l("features.system.role.loading")}):y.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:l("features.system.role.permission.noMenus")}):e.jsx("div",{className:"p-4",children:y.map(j=>e.jsx(ye,{menu:j,selectedMenuIds:a,onToggleWithChildren:R},j.id))})})})]}),e.jsxs(ie,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:S,children:l("features.system.role.form.cancel")}),e.jsx(w,{type:"button",disabled:S||!r,onClick:V,children:l(S?"features.system.role.form.submitting":"features.system.role.permission.save")})]})]})})}function je(s){const n=[];return s.children&&s.children.length>0&&s.children.forEach(r=>{r.id>0&&n.push(r.id),n.push(...je(r))}),n}function be(s,n){if(!(s.children&&s.children.length>0))return n.has(s.id)?"checked":"unchecked";const g=s.children.map(i=>be(i,n)),l=g.every(i=>i==="checked"),a=g.every(i=>i==="unchecked");return l?"checked":a?"unchecked":"indeterminate"}function Ne({api:s,selectedApiIds:n,onToggle:r,onToggleWithChildren:g,level:l=0}){const[a,i]=d.useState(!0),S=s.children&&s.children.length>0,C=d.useMemo(()=>be(s,n),[s,n]),m=C==="checked",N=C==="indeterminate",h=y=>{g(s,y===!0)},o=s.desc||s.category||`${s.method} ${s.path}`;return e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:G("flex items-center gap-2 py-1.5 px-2 rounded-md hover:bg-accent transition-colors",l>0&&"ml-4"),style:{paddingLeft:`${l*16+8}px`},children:[S?e.jsx("button",{type:"button",onClick:()=>i(!a),className:"flex items-center justify-center w-4 h-4 hover:bg-accent rounded",children:a?e.jsx(me,{className:"h-3 w-3"}):e.jsx(he,{className:"h-3 w-3"})}):e.jsx("div",{className:"w-4"}),e.jsxs("div",{className:"relative flex items-center justify-center",children:[e.jsx(fe,{checked:m,onCheckedChange:h,className:G(N&&!m&&"border-primary bg-primary/50")}),N&&!m&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-2 h-0.5 bg-primary-foreground rounded"})})]}),e.jsx("label",{className:"flex-1 cursor-pointer text-sm",onClick:()=>h(!m),children:o})]}),S&&a&&e.jsx("div",{children:s.children.map(y=>e.jsx(Ne,{api:y,selectedApiIds:n,onToggle:r,onToggleWithChildren:g,level:l+1},y.id))})]})}function ys({open:s,onOpenChange:n,roleId:r,roleName:g}){const{t:l}=Y(),[a,i]=d.useState(new Set),[S,C]=d.useState(!1),{data:m,isLoading:N}=$({queryKey:["apiList"],queryFn:()=>ns(),enabled:s}),{data:h,isLoading:o,isFetched:y}=$({queryKey:["roleApis",r],queryFn:()=>r?ls(r):Promise.resolve({apis:[]}),enabled:s&&r!==null,staleTime:0}),f=d.useMemo(()=>!m?.apis||m.apis.length===0?[]:m.apis,[m?.apis]),M=d.useCallback(u=>{const x=[];return u.forEach(c=>{c.id>0&&x.push(c.id),c.children&&c.children.length>0&&x.push(...M(c.children))}),x},[]),D=d.useMemo(()=>m?.apis?M(m.apis):[],[m?.apis,M]);d.useEffect(()=>{if(!s){i(new Set);return}if(!r){i(new Set);return}if(y&&!o)if(h?.apis&&Array.isArray(h.apis)){const u=h.apis.map(x=>Number(x.id)).filter(x=>!isNaN(x)&&x>0);i(new Set(u))}else i(new Set)},[h,s,o,y,r]);const R=d.useCallback((u,x)=>{u<=0||i(c=>{const b=new Set(c);return x?b.add(u):b.delete(u),b})},[]),z=d.useCallback((u,x)=>{i(c=>{const b=new Set(c);return u.id>0&&(x?b.add(u.id):b.delete(u.id)),je(u).forEach(v=>{x?b.add(v):b.delete(v)}),b})},[]),V=d.useCallback(()=>{D.length!==0&&(a.size===D.length?i(new Set):i(new Set(D)))},[D,a.size]),F=async()=>{if(r){C(!0);try{await as(r,{apiIds:Array.from(a)}),O.success(l("features.system.role.permission.updateSuccess")),n(!1)}catch{}finally{C(!1)}}},j=N||o;return e.jsx(re,{open:s,onOpenChange:n,children:e.jsxs(ae,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsx(ne,{className:"shrink-0",children:e.jsx(le,{children:l("features.system.role.permission.apiTitle",{name:g||""})})}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between shrink-0",children:[e.jsx(w,{type:"button",variant:"outline",size:"sm",onClick:V,disabled:j,children:a.size===D.length?l("features.system.role.permission.unselectAll"):l("features.system.role.permission.selectAll")}),e.jsx("span",{className:"text-sm text-muted-foreground",children:l("features.system.role.permission.selectedCount",{count:a.size,total:D.length})})]}),e.jsx("div",{className:"flex-1 h-full border rounded-md overflow-hidden overflow-y-auto",children:e.jsx(xe,{className:"h-full",children:j?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:l("features.system.role.loading")}):f.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:l("features.system.role.permission.noMenus")}):e.jsx("div",{className:"p-4",children:f.map(u=>e.jsx(Ne,{api:u,selectedApiIds:a,onToggle:R,onToggleWithChildren:z},u.id||u.category))})})})]}),e.jsxs(ie,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:S,children:l("features.system.role.form.cancel")}),e.jsx(w,{type:"button",disabled:S||!r,onClick:F,children:l(S?"features.system.role.form.submitting":"features.system.role.permission.save")})]})]})})}function js(){const{t:s}=Y(),n=Te(),[r,g]=d.useState(null),[l,a]=d.useState(null),[i,S]=d.useState(null),[C,m]=d.useState(null),[N,h]=d.useState(null),[o,y]=d.useState([]),[f,M]=d.useState({pageIndex:0,pageSize:10}),[D,R]=d.useState([]),[z,V]=d.useState({}),F=d.useMemo(()=>{const t=ke=>{const Q=o.find(De=>De.id===ke);return Q?.value&&Array.isArray(Q.value)?Q.value[0]||"":Q?.value||""},p=t("name"),P=t("keyword"),L=t("status");return{current:1,name:p,keyword:P,status:L,pageNum:f.pageIndex+1,pageSize:f.pageSize}},[o,f]),{data:j,isLoading:u,error:x}=$({queryKey:["roleList",F],queryFn:()=>ds(F)}),c=j?.roles||[],b=j?.total||0,T=Math.ceil(b/f.pageSize),v=d.useMemo(()=>[{accessorKey:"name",header:({column:t})=>e.jsx(A,{column:t,title:s("features.system.role.name")}),cell:({row:t})=>e.jsx("div",{className:"font-medium",children:t.getValue("name")})},{accessorKey:"keyword",header:({column:t})=>e.jsx(A,{column:t,title:s("features.system.role.keyword")}),cell:({row:t})=>e.jsx("div",{children:t.getValue("keyword")})},{accessorKey:"sort",header:({column:t})=>e.jsx(A,{column:t,title:s("features.system.role.sort")}),cell:({row:t})=>e.jsx("div",{children:t.getValue("sort")})},{accessorKey:"status",header:({column:t})=>e.jsx(A,{column:t,title:s("features.system.role.status")}),cell:({row:t})=>{const p=t.getValue("status");return e.jsx(Oe,{variant:He(p,"enabledStatus"),children:s(p===1?"features.system.role.enabled":"features.system.role.disabled")})}},{accessorKey:"creator",header:({column:t})=>e.jsx(A,{column:t,title:s("features.system.role.creator")}),cell:({row:t})=>e.jsx("div",{children:t.getValue("creator")})},{accessorKey:"desc",header:({column:t})=>e.jsx(A,{column:t,title:s("features.system.role.desc")}),cell:({row:t})=>{const p=t.getValue("desc");return e.jsx("div",{className:"max-w-[200px] truncate",title:p,children:p||"-"})}},{id:"actions",header:s("features.system.role.actions"),cell:({row:t})=>{const p=t.original;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(W,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{h(p),g("edit")},children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsx(J,{children:s("features.system.role.edit")})]}),e.jsxs(W,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{S(p.id)},children:e.jsx(ms,{className:"h-4 w-4"})})}),e.jsx(J,{children:s("features.system.role.permissionSetting")})]}),e.jsxs(W,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{m(p.id)},children:e.jsx(hs,{className:"h-4 w-4"})})}),e.jsx(J,{children:s("features.system.role.apiSetting")})]}),e.jsxs(W,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>a(p.id),children:e.jsx(Ae,{className:"h-4 w-4 text-destructive"})})}),e.jsx(J,{children:s("features.system.role.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[s,g,a]),k=Re({data:c,columns:v,getCoreRowModel:Pe(),getSortedRowModel:Ve(),manualPagination:!0,pageCount:T,onSortingChange:R,onColumnFiltersChange:y,onColumnVisibilityChange:V,onPaginationChange:M,state:{sorting:D,columnFilters:o,columnVisibility:z,pagination:f}}),ee=te({mutationFn:t=>is(t),onSuccess:()=>{O.success(s("features.system.role.createSuccess")),n.invalidateQueries({queryKey:["roleList"]}),g(null),h(null)},onError:()=>{}}),oe=te({mutationFn:t=>os(t),onSuccess:()=>{O.success(s("features.system.role.updateSuccess")),n.invalidateQueries({queryKey:["roleList"]}),g(null),h(null)},onError:()=>{}}),ce=te({mutationFn:t=>cs(t),onSuccess:()=>{O.success(s("features.system.role.deleteSuccess")),n.invalidateQueries({queryKey:["roleList"]}),a(null)},onError:()=>{}}),Ce=()=>{h(null),g("create")},Se=t=>{r==="create"?ee.mutate(t):r==="edit"&&oe.mutate(t)},ve=()=>{l&&ce.mutate(l)},we=c.find(t=>t.id===l);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(Ee,{title:s("features.system.role.title"),description:s("features.system.role.description"),children:e.jsxs(w,{onClick:Ce,children:[e.jsx(ze,{className:"h-4 w-4"}),s("features.system.role.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(H,{type:"text",placeholder:s("features.system.role.searchName"),value:k.getColumn("name")?.getFilterValue()??"",onChange:t=>k.getColumn("name")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"}),e.jsx(H,{type:"text",placeholder:s("features.system.role.searchKeyword"),value:k.getColumn("keyword")?.getFilterValue()??"",onChange:t=>k.getColumn("keyword")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"}),e.jsx(Le,{column:k.getColumn("status"),title:s("features.system.role.status"),options:[{label:s("features.system.role.enabled"),value:"1"},{label:s("features.system.role.disabled"),value:"2"}],single:!0})]})}),e.jsxs(_e,{children:[e.jsx(qe,{children:k.getHeaderGroups().map(t=>e.jsx(E,{children:t.headers.map(p=>{const P=p.isPlaceholder?null:typeof p.column.columnDef.header=="function"?p.column.columnDef.header(p.getContext()):p.column.columnDef.header,L=p.column.columnDef.meta;return e.jsx(Ke,{className:L?.thClassName,children:P},p.id)})},t.id))}),e.jsx(Ie,{children:u?e.jsx(E,{children:e.jsx(U,{colSpan:v.length,className:"h-24 text-center",children:s("features.system.role.loading")})}):x?e.jsx(E,{children:e.jsx(U,{colSpan:v.length,className:"h-24 text-center text-destructive",children:s("features.system.role.loadError")})}):k.getRowModel().rows?.length?k.getRowModel().rows.map(t=>e.jsx(E,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(p=>{const P=typeof p.column.columnDef.cell=="function"?p.column.columnDef.cell(p.getContext()):p.column.columnDef.cell,L=p.column.columnDef.meta;return e.jsx(U,{className:L?.tdClassName,children:P},p.id)})},t.id)):e.jsx(E,{children:e.jsx(U,{colSpan:v.length,className:"h-24 text-center",children:s("features.system.role.noData")})})})]}),e.jsx(Be,{table:k})]}),e.jsx(xs,{open:r!==null,onOpenChange:t=>{t||(g(null),h(null))},role:N,onSubmit:Se,isLoading:r==="create"?ee.isPending:oe.isPending}),e.jsx($e,{open:l!==null,onOpenChange:t=>{t||a(null)},title:s("features.system.role.confirmDelete"),desc:s("features.system.role.confirmDeleteMessage",{name:we?.name}),handleConfirm:ve,destructive:!0,confirmText:s("features.system.role.delete"),isLoading:ce.isPending}),e.jsx(gs,{open:i!==null,onOpenChange:t=>{t||S(null)},roleId:i,roleName:c.find(t=>t.id===i)?.name}),e.jsx(ys,{open:C!==null,onOpenChange:t=>{t||m(null)},roleId:C,roleName:c.find(t=>t.id===C)?.name})]})}const st=js;export{st as component};
