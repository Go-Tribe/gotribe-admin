import{a as X,r as c,A as ce,j as e,B as D,C as M,l as le,t as x}from"./index-Pe1Nv6hH.js";import{u as G}from"./useQuery-DDON36P9.js";import{u as V}from"./useMutation-uvHqRPk1.js";import{P as me,T as de,u as ue,g as pe,c as fe,b as je}from"./react-icons.esm-CiMB90YA.js";import{S as xe}from"./index-BmISbovJ.js";import{S as Y,a as Z,b as ee,c as te,d as _}from"./select-Dl4KSF7A.js";import{D as h,T as he,a as ge,b as g,c as De,d as Se,e as b}from"./column-header-Cfszq_dp.js";import{D as ye}from"./pagination-B86K5cVv.js";import{T as J,v as U,w as W}from"./sidebar-BFSPGCEL.js";import{g as Ce}from"./project-_pxXE-N5.js";import{C as Ie}from"./confirm-dialog-DmDS_GmK.js";import{u as Ne,a as be,F as _e,b as E,c as R,d as q,e as z,f as L}from"./form-DU65aaqX.js";import{D as ve,a as Te,b as we,c as Fe,d as Pe,e as Me}from"./dialog-DHifiqsD.js";import{I as Ve}from"./input-DW-mBlUw.js";import{T as Ee}from"./textarea-D-N386t0.js";import{c as Re,u as qe,d as ze,g as Le}from"./service-C5Ec2Sbd.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-D68Ta3NN.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./index-DGhUbGt9.js";const ke=s=>ce({title:M().min(1,s("features.operation.scene.form.validation.titleRequired")),description:M().min(1,s("features.operation.scene.form.validation.descriptionRequired")),projectID:M().min(1,s("features.operation.scene.form.validation.projectRequired"))});function Ke({open:s,onOpenChange:p,onSubmit:j,onSubmitUpdate:m,isLoading:f=!1,projectList:d,editScene:a}){const{t:o}=X(),u=!!a,v=c.useMemo(()=>ke(o),[o]),n=Ne({resolver:be(v),defaultValues:{title:"",description:"",projectID:""}});c.useEffect(()=>{s&&(a?n.reset({title:(a.title??"").trim(),description:(a.description??"").trim(),projectID:(a.projectID??"").trim()}):n.reset({title:"",description:"",projectID:""}))},[s,a,n]);function T(i){if(u&&a&&m)m(a.adSceneID.trim(),{title:i.title.trim(),description:i.description.trim(),projectID:(i.projectID??"").trim()||void 0});else if(j){const S=(i.projectID??"").trim();j({title:i.title.trim(),description:i.description.trim(),projectID:S})}}return e.jsx(ve,{open:s,onOpenChange:p,children:e.jsxs(Te,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(we,{className:"shrink-0",children:[e.jsx(Fe,{children:o(u?"features.operation.scene.form.editTitle":"features.operation.scene.form.dialogTitle")}),e.jsx(Pe,{children:o(u?"features.operation.scene.form.editDescription":"features.operation.scene.form.createDescription")})]}),e.jsx(_e,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(T),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(E,{control:n.control,name:"title",render:({field:i})=>e.jsxs(R,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(q,{className:"text-right",children:o("features.operation.scene.form.title")}),e.jsx(z,{children:e.jsx(Ve,{placeholder:o("features.operation.scene.form.titlePlaceholder"),...i})}),e.jsx(L,{className:"col-start-2"})]})}),e.jsx(E,{control:n.control,name:"description",render:({field:i})=>e.jsxs(R,{className:"grid grid-cols-[140px_1fr] items-start gap-4 space-y-0",children:[e.jsx(q,{className:"text-right pt-2",children:o("features.operation.scene.form.description")}),e.jsx(z,{children:e.jsx(Ee,{placeholder:o("features.operation.scene.form.descriptionPlaceholder"),className:"min-h-[80px] resize-none",...i})}),e.jsx(L,{className:"col-start-2"})]})}),e.jsx(E,{control:n.control,name:"projectID",render:({field:i})=>{const y=(i.value??"").trim()||"__empty__";return e.jsxs(R,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(q,{className:"text-right",children:o("features.operation.scene.form.project")}),e.jsxs(Y,{value:y,onValueChange:l=>i.onChange(l==="__empty__"?"":l),children:[e.jsx(z,{children:e.jsx(Z,{children:e.jsx(ee,{placeholder:o("features.operation.scene.form.projectPlaceholder")})})}),e.jsxs(te,{children:[e.jsx(_,{value:"__empty__",children:o("features.operation.scene.form.projectPlaceholder")}),d.filter(l=>(l.projectID??"").trim()!=="").map(l=>e.jsx(_,{value:(l.projectID??"").trim(),children:l.title},l.projectID))]})]},`project-${a?.adSceneID??"create"}-${d.length}-${y}`),e.jsx(L,{className:"col-start-2"})]})}}),e.jsxs(Me,{className:"shrink-0",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:f,children:o("features.operation.scene.form.cancel")}),e.jsx(D,{type:"submit",disabled:f,children:f?"...":o("features.operation.scene.form.submit")})]})]})})]})})}function Ae(s,p){const j=(s.adSceneID??"").trim(),m=(s.projectID??"").trim(),d=(s.projectTitle??"").trim()||(p.find(a=>(a.projectID??"").trim()===m)?.title??"")||m||"-";return{id:j,name:(s.title??"").trim()||"-",description:(s.description??"").trim()||"-",project:d,createdAt:(s.createdAt??"").trim()||"-"}}function He(){"use no memo";const{t:s}=X(),p=le(),[j,m]=c.useState(!1),[f,d]=c.useState(null),[a,o]=c.useState(null),[u,v]=c.useState("__all__"),[n,T]=c.useState({pageIndex:0,pageSize:10}),[i,S]=c.useState([]),[y,l]=c.useState({}),{data:k}=G({queryKey:["projectList",{current:1,pageNum:1,pageSize:1e3}],queryFn:()=>Ce({current:1,pageNum:1,pageSize:1e3})}),C=c.useMemo(()=>k?.projects?.map(t=>({projectID:t.projectID,title:t.title??t.projectID}))??[],[k?.projects]),K=c.useMemo(()=>({pageNum:n.pageIndex+1,pageSize:n.pageSize,ProjectID:u&&u!=="__all__"&&u.trim()||void 0}),[n.pageIndex,n.pageSize,u]),{data:A,isLoading:se,error:re}=G({queryKey:["adSceneList",K],queryFn:()=>Le(K)}),w=A?.adScenes??[],H=c.useMemo(()=>w.map(t=>Ae(t,C)),[w,C]),oe=A?.total??0,O=f!=null?w.find(t=>(t.adSceneID??"").trim()===f)??null:null,B=V({mutationFn:t=>Re(t,{project_id:t.projectID?.trim()||void 0}),onSuccess:()=>{x.success(s("features.operation.scene.createSuccess")),p.invalidateQueries({queryKey:["adSceneList"]}),m(!1)},onError:t=>{x.error(t instanceof Error?t.message:s("features.operation.scene.createError"))}}),Q=V({mutationFn:({adSceneID:t,data:r})=>qe(t,r),onSuccess:()=>{x.success(s("features.operation.scene.updateSuccess")),p.invalidateQueries({queryKey:["adSceneList"]}),d(null)},onError:t=>{x.error(t instanceof Error?t.message:s("features.operation.scene.updateError"))}}),$=V({mutationFn:t=>ze(t),onSuccess:()=>{x.success(s("features.operation.scene.deleteSuccess")),p.invalidateQueries({queryKey:["adSceneList"]}),o(null)},onError:t=>{x.error(t instanceof Error?t.message:s("features.operation.scene.deleteError"))}}),ae=()=>{a&&$.mutate(a)},ne=H.find(t=>t.id===a),ie=Math.max(1,Math.ceil(oe/n.pageSize)),I=c.useMemo(()=>[{accessorKey:"id",header:({column:t})=>e.jsx(h,{column:t,title:s("features.operation.scene.scenario.columns.id")}),cell:({row:t})=>e.jsx("div",{className:"font-mono text-muted-foreground",children:t.getValue("id")?.trim()??"-"})},{accessorKey:"name",header:({column:t})=>e.jsx(h,{column:t,title:s("features.operation.scene.scenario.columns.name")}),cell:({row:t})=>e.jsx("div",{className:"max-w-[160px] truncate font-medium",title:t.getValue("name"),children:t.getValue("name")??"-"})},{accessorKey:"description",header:({column:t})=>e.jsx(h,{column:t,title:s("features.operation.scene.scenario.columns.description")}),cell:({row:t})=>{const r=t.getValue("description");return e.jsx("div",{className:"max-w-[240px] truncate text-muted-foreground",title:r,children:r??"-"})}},{accessorKey:"project",header:({column:t})=>e.jsx(h,{column:t,title:s("features.operation.scene.scenario.columns.project")}),cell:({row:t})=>e.jsx("div",{className:"text-muted-foreground whitespace-nowrap",children:t.getValue("project")??"-"})},{accessorKey:"createdAt",header:({column:t})=>e.jsx(h,{column:t,title:s("features.operation.scene.scenario.columns.createdAt")}),cell:({row:t})=>e.jsx("div",{className:"text-muted-foreground whitespace-nowrap",children:t.getValue("createdAt")??"-"})},{id:"actions",header:s("features.operation.scene.scenario.columns.actions"),cell:({row:t})=>{const r=t.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>d(r.id),children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsx(W,{children:s("features.operation.scene.scenario.actions.edit")})]}),e.jsxs(J,{children:[e.jsx(U,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>o(r.id),children:e.jsx(de,{className:"h-4 w-4 text-destructive"})})}),e.jsx(W,{children:s("features.operation.scene.scenario.actions.delete")})]})]})},enableHiding:!1,meta:{thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[s]),N=ue({data:H,columns:I,getCoreRowModel:fe(),getSortedRowModel:pe(),manualPagination:!0,pageCount:ie,getRowId:t=>t.id,onSortingChange:S,onColumnVisibilityChange:l,onPaginationChange:T,state:{sorting:i,columnVisibility:y,pagination:n}});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(xe,{title:s("features.operation.scene.title"),description:s("features.operation.scene.description"),children:e.jsxs(D,{onClick:()=>{d(null),m(!0)},children:[e.jsx(je,{className:"h-4 w-4"}),s("features.operation.scene.scenario.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsxs(Y,{value:u,onValueChange:v,children:[e.jsx(Z,{className:"h-8 w-[160px]",children:e.jsx(ee,{placeholder:s("features.operation.scene.scenario.search.project")})}),e.jsxs(te,{children:[e.jsx(_,{value:"__all__",children:s("features.operation.scene.scenario.search.projectAll")}),C.map(t=>e.jsx(_,{value:(t.projectID??"").trim(),children:t.title},t.projectID))]})]})})}),e.jsxs(he,{children:[e.jsx(ge,{children:N.getHeaderGroups().map(t=>e.jsx(g,{children:t.headers.map(r=>{const F=r.isPlaceholder?null:typeof r.column.columnDef.header=="function"?r.column.columnDef.header(r.getContext()):r.column.columnDef.header,P=r.column.columnDef.meta;return e.jsx(De,{className:P?.thClassName,children:F},r.id)})},t.id))}),e.jsx(Se,{children:se?e.jsx(g,{children:e.jsx(b,{colSpan:I.length,className:"h-24 text-center",children:s("features.operation.scene.scenario.loading")})}):re?e.jsx(g,{children:e.jsx(b,{colSpan:I.length,className:"h-24 text-center text-destructive",children:s("features.operation.scene.scenario.loadError")})}):N.getRowModel().rows?.length?N.getRowModel().rows.map(t=>e.jsx(g,{children:t.getVisibleCells().map(r=>{const F=typeof r.column.columnDef.cell=="function"?r.column.columnDef.cell(r.getContext()):r.column.columnDef.cell,P=r.column.columnDef.meta;return e.jsx(b,{className:P?.tdClassName,children:F},r.id)})},t.id)):e.jsx(g,{children:e.jsx(b,{colSpan:I.length,className:"h-24 text-center",children:s("features.operation.scene.scenario.noData")})})})]}),e.jsx(ye,{table:N})]}),e.jsx(Ke,{open:j||f!=null&&O!=null,onOpenChange:t=>{t||(m(!1),d(null))},onSubmit:t=>B.mutate(t),onSubmitUpdate:(t,r)=>Q.mutate({adSceneID:t,data:r}),isLoading:B.isPending||Q.isPending,projectList:C,editScene:O}),e.jsx(Ie,{open:a!==null,onOpenChange:t=>{t||o(null)},title:s("features.operation.scene.confirmDelete"),desc:s("features.operation.scene.confirmDeleteDesc",{name:ne?.name??a??""}),handleConfirm:ae,destructive:!0,confirmText:s("features.operation.scene.scenario.actions.delete"),isLoading:$.isPending})]})}const ft=He;export{ft as component};
