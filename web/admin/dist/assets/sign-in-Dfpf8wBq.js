import{a as S,e as C,j as e,m as F,r as L,u as N,d as A,A as P,C as g,f as y,B as U,t as k,E as B,F as R}from"./index-Pe1Nv6hH.js";import{A as T,C as q,a as E,b as V,e as z}from"./auth-brand-tSoSfpp-.js";import{S as H,a as M,b as D,c as G,d as J}from"./select-Dl4KSF7A.js";import{a as K,L as O}from"./log-in-Cf3mpVom.js";import{u as Q,a as W,F as X,b as f,c as x,d as j,e as w,f as I}from"./form-DU65aaqX.js";import{I as Y}from"./input-DW-mBlUw.js";import{P as Z}from"./password-input-lMMxhBwE.js";import{L as _}from"./loader-circle-DjNfctPA.js";import"./useQuery-DDON36P9.js";import"./logo-7-bOXUaH.js";import"./config-Bb2IP3LG.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./index-DGhUbGt9.js";import"./eye-TW5NDUHo.js";function $(){const{language:r,setLanguage:d}=S(),{t:o}=C(),i=[{value:"zh",label:o("components.languageSwitcher.chinese")},{value:"en",label:o("components.languageSwitcher.english")}],l=i.find(a=>a.value===r);return e.jsxs(H,{value:r,onValueChange:a=>d(a),children:[e.jsxs(M,{className:"w-[140px]",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),e.jsx(D,{placeholder:l?.label||o("components.languageSwitcher.chinese")})]}),e.jsx(G,{children:i.map(a=>e.jsx(J,{value:a.value,children:a.label},a.value))})]})}async function ee(r){return F.post("/api/base/login",r)}function se({className:r,redirectTo:d,...o}){const[i,l]=L.useState(!1),a=N(),{auth:u}=A(),{t:s}=S(),b=P({username:g().min(1,s("features.auth.validation.usernameRequired")),password:g().min(1,s("features.auth.validation.passwordRequired"))}),m=Q({resolver:W(b),defaultValues:{username:"",password:""}});function v(n){l(!0),k.promise(ee({username:n.username,password:n.password}).then(async c=>{u.setAccessToken(c.token);let h=n.username;try{const t=await B();if(t&&t.admin){const p=t.admin;h=p.nickname?.trim()||p.username||n.username,u.setUser({...t.admin})}else u.setUser({})}catch(t){u.setUser({}),console.error("Failed to get user info:",t)}return a({to:d||"/",replace:!0}),s("features.auth.signIn.welcomeBack",{username:h})}),{loading:s("features.auth.signIn.loggingIn"),success:c=>(l(!1),c),error:c=>(l(!1),c?.message||s("features.auth.signIn.error"))})}return e.jsx(X,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(v),className:y("grid gap-3",r),...o,children:[e.jsx(f,{control:m.control,name:"username",render:({field:n})=>e.jsxs(x,{children:[e.jsx(j,{children:s("features.auth.signIn.account")}),e.jsx(w,{children:e.jsx(Y,{placeholder:s("features.auth.signIn.accountPlaceholder"),...n})}),e.jsx(I,{})]})}),e.jsx(f,{control:m.control,name:"password",render:({field:n})=>e.jsxs(x,{className:"relative",children:[e.jsx(j,{children:s("features.auth.signIn.password")}),e.jsx(w,{children:e.jsx(Z,{placeholder:s("features.auth.signIn.passwordPlaceholder"),...n})}),e.jsx(I,{})]})}),e.jsxs(U,{className:"mt-2",disabled:i,children:[i?e.jsx(_,{className:"animate-spin"}):e.jsx(O,{}),s("features.auth.signIn.login")]})]})})}function ae(){const{redirect:r}=R({from:"/(auth)/sign-in"});return e.jsxs(T,{children:[e.jsx("div",{className:"absolute right-4 top-4 z-10",children:e.jsx($,{})}),e.jsxs(q,{className:"w-full border shadow-sm",children:[e.jsx(E,{className:"pb-4 pt-6",children:e.jsx(V,{})}),e.jsx(z,{className:"pb-6 pt-0",children:e.jsx(se,{redirectTo:r})})]})]})}const Se=ae;export{Se as component};
