import{a as A,r as i,A as ae,j as e,B as b,C as T,l as ne,t as w,K as oe}from"./index-Pe1Nv6hH.js";import{u as le}from"./useQuery-DDON36P9.js";import{u as F}from"./useMutation-uvHqRPk1.js";import{P as re,T as ie,u as ce,g as ue,c as de,b as me}from"./react-icons.esm-CiMB90YA.js";import{I as C}from"./input-DW-mBlUw.js";import{S as ge}from"./index-BmISbovJ.js";import{D as I,T as fe,a as he,b as j,c as xe,d as pe,e as y}from"./column-header-Cfszq_dp.js";import{D as je}from"./pagination-B86K5cVv.js";import{T as H,v as O,w as Q}from"./sidebar-BFSPGCEL.js";import{C as be}from"./confirm-dialog-DmDS_GmK.js";import{u as Ce,a as ve,F as De,b as k,c as M,d as P,e as _,f as V}from"./form-DU65aaqX.js";import{D as Ne,a as ye,b as Se,c as Te,d as we,e as Fe}from"./dialog-DHifiqsD.js";import{T as Ie}from"./textarea-D-N386t0.js";import{c as ke,u as Me,d as Pe,g as _e}from"./tag-BQ1zh2fc.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-SpxnGYUf.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-4GH7Kv3S.js";import"./index-C8jai3VV.js";import"./index-D68Ta3NN.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./select-Dl4KSF7A.js";import"./index-DGhUbGt9.js";const Ve=s=>ae({title:T().min(1,s("features.content.tag.form.validation.titleRequired")),description:T().optional(),color:T().optional()});function Re({open:s,onOpenChange:f,tag:r,onSubmit:d,isLoading:c=!1}){const{t:n}=A(),m=!!r,g=i.useMemo(()=>Ve(n),[n]),l=Ce({resolver:ve(g),defaultValues:{title:"",description:"",color:"#3b82f6"}});i.useEffect(()=>{s&&(m&&r?l.reset({title:r.title||"",description:r.description||"",color:r.color||"#3b82f6"}):l.reset({title:"",description:"",color:"#3b82f6"}))},[s,m,r,l]);const v=o=>{d({...o,tagID:r?.tagID})};return e.jsx(Ne,{open:s,onOpenChange:f,children:e.jsxs(ye,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(Se,{className:"shrink-0",children:[e.jsx(Te,{children:n(m?"features.content.tag.form.editTitle":"features.content.tag.form.createTitle")}),e.jsx(we,{children:n(m?"features.content.tag.form.editDescription":"features.content.tag.form.createDescription")})]}),e.jsx(De,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(v),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[e.jsx(k,{control:l.control,name:"title",render:({field:o})=>e.jsxs(M,{className:"flex flex-row items-start gap-4",children:[e.jsx(P,{className:"w-20 pt-2 text-right shrink-0",children:n("features.content.tag.form.title")}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(_,{children:e.jsx(C,{placeholder:n("features.content.tag.form.titlePlaceholder"),...o})}),e.jsx(V,{})]})]})}),e.jsx(k,{control:l.control,name:"description",render:({field:o})=>e.jsxs(M,{className:"flex flex-row items-start gap-4",children:[e.jsx(P,{className:"w-20 pt-2 text-right shrink-0",children:n("features.content.tag.form.description")}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(_,{children:e.jsx(Ie,{placeholder:n("features.content.tag.form.descriptionPlaceholder"),className:"resize-none",...o})}),e.jsx(V,{})]})]})}),e.jsx(k,{control:l.control,name:"color",render:({field:o})=>e.jsxs(M,{className:"flex flex-row items-start gap-4",children:[e.jsx(P,{className:"w-20 pt-2 text-right shrink-0",children:n("features.content.tag.form.color")}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{children:e.jsx(C,{type:"color",className:"h-10 w-20 cursor-pointer",...o})}),e.jsx(C,{type:"text",placeholder:"#3b82f6",value:o.value||"#3b82f6",onChange:S=>{const h=S.target.value;(/^#[0-9A-Fa-f]{0,6}$/.test(h)||h==="")&&o.onChange(h||"#3b82f6")},className:"flex-1"})]}),e.jsx(V,{})]})]})})]})}),e.jsxs(Fe,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>f(!1),disabled:c,children:n("features.content.tag.form.cancel")}),e.jsx(b,{type:"button",disabled:c,onClick:l.handleSubmit(v),children:n(c?"features.content.tag.form.submitting":m?"features.content.tag.form.save":"features.content.tag.form.create")})]})]})})}function ze(){const{t:s}=A(),f=ne(),[r,d]=i.useState(null),[c,n]=i.useState(null),[m,g]=i.useState(null),[l,v]=i.useState([]),[o,S]=i.useState({pageIndex:0,pageSize:10}),[h,B]=i.useState([]),[$,G]=i.useState({}),R=i.useMemo(()=>{const t=p=>{const N=l.find(se=>se.id===p);return N?.value&&Array.isArray(N.value)?N.value[0]||"":N?.value||""},a=t("title"),x=t("description");return{current:1,title:a,description:x,pageNum:o.pageIndex+1,pageSize:o.pageSize}},[l,o]),{data:z,isLoading:J,error:U}=le({queryKey:["tagList",R],queryFn:()=>_e(R),placeholderData:oe}),q=z?.tags||[],W=z?.total||0,X=Math.ceil(W/o.pageSize),D=i.useMemo(()=>[{accessorKey:"tagID",header:({column:t})=>e.jsx(I,{column:t,title:s("features.content.tag.columns.id")}),cell:({row:t})=>{const a=t.getValue("tagID");return e.jsx("div",{className:"font-medium",children:a})}},{accessorKey:"title",header:({column:t})=>e.jsx(I,{column:t,title:s("features.content.tag.columns.title")}),cell:({row:t})=>{const a=t.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[a.color&&e.jsx("div",{className:"h-4 w-4 rounded-full border border-border",style:{backgroundColor:a.color}}),e.jsx("div",{className:"font-medium",children:t.getValue("title")})]})}},{accessorKey:"description",header:({column:t})=>e.jsx(I,{column:t,title:s("features.content.tag.columns.description")}),cell:({row:t})=>{const a=t.getValue("description");return e.jsx("div",{className:"max-w-[300px] truncate",title:a,children:a||"-"})}},{id:"actions",header:s("features.content.tag.columns.actions"),cell:({row:t})=>{const a=t.original;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(H,{children:[e.jsx(O,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{g(a),d("edit")},children:e.jsx(re,{className:"h-4 w-4"})})}),e.jsx(Q,{children:s("features.content.tag.actions.edit")})]}),e.jsxs(H,{children:[e.jsx(O,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>n(a.tagID),children:e.jsx(ie,{className:"h-4 w-4 text-destructive"})})}),e.jsx(Q,{children:s("features.content.tag.actions.delete")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[s]),u=ce({data:q,columns:D,getCoreRowModel:de(),getSortedRowModel:ue(),manualPagination:!0,pageCount:X,onSortingChange:B,onColumnFiltersChange:v,onColumnVisibilityChange:G,onPaginationChange:S,state:{sorting:h,columnFilters:l,columnVisibility:$,pagination:o}}),K=F({mutationFn:t=>ke(t),onSuccess:()=>{w.success(s("features.content.tag.createSuccess")),f.invalidateQueries({queryKey:["tagList"]}),d(null),g(null)}}),E=F({mutationFn:t=>{if(!t.tagID)throw new Error(s("features.content.tag.form.validation.titleRequired"));return Me(t.tagID,t)},onSuccess:()=>{w.success(s("features.content.tag.updateSuccess")),f.invalidateQueries({queryKey:["tagList"]}),d(null),g(null)}}),L=F({mutationFn:t=>Pe(t),onSuccess:()=>{w.success(s("features.content.tag.deleteSuccess")),f.invalidateQueries({queryKey:["tagList"]}),n(null)}}),Y=()=>{g(null),d("create")},Z=t=>{r==="create"?K.mutate(t):r==="edit"&&E.mutate(t)},ee=()=>{c&&L.mutate(c)},te=q.find(t=>t.tagID===c);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(ge,{title:s("features.content.tag.title"),description:s("features.content.tag.description"),children:e.jsxs(b,{onClick:Y,children:[e.jsx(me,{className:"h-4 w-4"}),s("features.content.tag.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(C,{type:"text",placeholder:s("features.content.tag.search.title"),value:u.getColumn("title")?.getFilterValue()??"",onChange:t=>u.getColumn("title")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"}),e.jsx(C,{type:"text",placeholder:s("features.content.tag.search.description"),value:u.getColumn("description")?.getFilterValue()??"",onChange:t=>u.getColumn("description")?.setFilterValue(t.target.value),className:"h-8 w-[150px]"})]})}),e.jsxs(fe,{children:[e.jsx(he,{children:u.getHeaderGroups().map(t=>e.jsx(j,{children:t.headers.map(a=>{const x=a.isPlaceholder?null:typeof a.column.columnDef.header=="function"?a.column.columnDef.header(a.getContext()):a.column.columnDef.header,p=a.column.columnDef.meta;return e.jsx(xe,{className:p?.thClassName,children:x},a.id)})},t.id))}),e.jsx(pe,{children:J?e.jsx(j,{children:e.jsx(y,{colSpan:D.length,className:"h-24 text-center",children:s("features.content.tag.loading")})}):U?e.jsx(j,{children:e.jsx(y,{colSpan:D.length,className:"h-24 text-center text-destructive",children:s("features.content.tag.loadError")})}):u.getRowModel().rows?.length?u.getRowModel().rows.map(t=>e.jsx(j,{"data-state":t.getIsSelected()&&"selected",children:t.getVisibleCells().map(a=>{const x=typeof a.column.columnDef.cell=="function"?a.column.columnDef.cell(a.getContext()):a.column.columnDef.cell,p=a.column.columnDef.meta;return e.jsx(y,{className:p?.tdClassName,children:x},a.id)})},t.id)):e.jsx(j,{children:e.jsx(y,{colSpan:D.length,className:"h-24 text-center",children:s("features.content.tag.noData")})})})]}),e.jsx(je,{table:u})]}),e.jsx(Re,{open:r!==null,onOpenChange:t=>{t||(d(null),g(null))},tag:m,onSubmit:Z,isLoading:r==="create"?K.isPending:E.isPending}),e.jsx(be,{open:c!==null,onOpenChange:t=>{t||n(null)},title:s("features.content.tag.confirmDelete"),desc:s("features.content.tag.confirmDeleteDesc",{title:te?.title??""}),handleConfirm:ee,destructive:!0,confirmText:s("features.content.tag.actions.delete"),isLoading:L.isPending})]})}const rt=ze;export{rt as component};
