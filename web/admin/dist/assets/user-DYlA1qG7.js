import{a as q,r as d,A as ve,j as e,B as F,C as p,l as De,t as V,K as ye}from"./index-Pe1Nv6hH.js";import{u as T}from"./useQuery-DDON36P9.js";import{u as O}from"./useMutation-uvHqRPk1.js";import{T as Q,v as Z,w as $}from"./sidebar-BFSPGCEL.js";import{P as Ne,u as Ce,g as Ie,c as we,b as Se}from"./react-icons.esm-CiMB90YA.js";import{I as L}from"./input-DW-mBlUw.js";import{S as ke}from"./index-BmISbovJ.js";import{D as b,T as Le,a as Fe,b as k,c as Re,d as Ue,e as _}from"./column-header-Cfszq_dp.js";import{D as Pe}from"./pagination-B86K5cVv.js";import{A as G,a as J,b as W}from"./avatar-gJcrYmow.js";import{S as X,a as Y,b as ee,c as se,d as M}from"./select-Dl4KSF7A.js";import{u as Ve,a as _e,F as Te,b as v,c as D,d as y,e as N,f as C}from"./form-DU65aaqX.js";import{D as re,a as ae,b as te,c as ne,d as Ae,e as Ke}from"./dialog-DHifiqsD.js";import{P as Me}from"./password-input-lMMxhBwE.js";import{R as qe}from"./index-B79q5nRO.js";import{g as ie}from"./project-_pxXE-N5.js";import{I as ze}from"./image-D4KB7jNL.js";import{a as Ee,c as He,u as Be,g as Oe}from"./user-D0YkkhRV.js";import{E as Qe}from"./eye-TW5NDUHo.js";import"./createLucideIcon-BU8aI1FG.js";import"./index-D68Ta3NN.js";import"./index-SpxnGYUf.js";import"./index-C8jai3VV.js";import"./dropdown-menu-CbU9G1H2.js";import"./index-4GH7Kv3S.js";import"./index-BDzuQ5ZL.js";import"./chevron-right-COcvBQ44.js";import"./index-DGhUbGt9.js";import"./scroll-area-BCr0FWtA.js";import"./resource-u0oZDgOZ.js";import"./loader-circle-DjNfctPA.js";import"./upload-CE8x_1SM.js";import"./chevron-left-BrCT33MH.js";const Ze=/^[a-zA-Z0-9]+$/,$e=(r,m)=>ve({avatarURL:p().optional(),username:m?p().optional():p().min(2,r("features.business.user.form.validation.usernameLength")).max(20,r("features.business.user.form.validation.usernameLength")).regex(Ze,r("features.business.user.form.validation.usernamePattern")),nickname:p().min(2,r("features.business.user.form.validation.nicknameLength")).max(20,r("features.business.user.form.validation.nicknameLength")),password:m?p().optional():p().min(6,r("features.business.user.form.validation.passwordLength")).max(20,r("features.business.user.form.validation.passwordLength")),phone:p().min(1,r("features.business.user.form.validation.phoneRequired")),email:p().min(1,r("features.business.user.form.validation.emailRequired")),projectID:m?p().optional():p().min(2,r("features.business.user.form.validation.projectIDLength")).max(20,r("features.business.user.form.validation.projectIDLength"))});function Ge({open:r,onOpenChange:m,user:c,onSubmit:i,isLoading:l=!1}){const{t}=q(),o=!!c,[I,f]=d.useState(!1),A=d.useMemo(()=>$e(t,o),[t,o]),{data:g}=T({queryKey:["projectList",{current:1,pageNum:1,pageSize:1e3}],queryFn:()=>ie({current:1,pageNum:1,pageSize:1e3})}),K=g?.projects||[],u=Ve({resolver:_e(A),defaultValues:{avatarURL:"",username:"",nickname:"",password:"",phone:"",email:"",projectID:""}});d.useEffect(()=>{if(r)if(o&&c){const a=c;u.reset({avatarURL:a.avatarURL||"",username:a.username||"",nickname:a.nickname||"",password:"",phone:a.phone,email:a.email,projectID:a.projectID||""})}else u.reset({avatarURL:"",username:"",nickname:"",password:"",phone:"",email:"",projectID:""})},[r,o,c,u]);const R=a=>{if(o&&c){const x={userID:c.userID,nickname:a.nickname,email:a.email?.trim()||void 0,phone:a.phone?.trim()||void 0};a.avatarURL?.trim()&&(x.avatarURL=a.avatarURL.trim()),a.password?.trim()&&(x.password=a.password),i(x)}else i({username:a.username.trim(),nickname:a.nickname.trim(),email:a.email?.trim()||void 0,phone:a.phone?.trim()||void 0,projectID:a.projectID.trim(),password:a.password.trim(),avatarURL:a.avatarURL?.trim()})};return e.jsxs(re,{open:r,onOpenChange:m,children:[e.jsxs(ae,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(te,{className:"shrink-0",children:[e.jsx(ne,{children:t(o?"features.business.user.form.editTitle":"features.business.user.form.createTitle")}),e.jsx(Ae,{children:t(o?"features.business.user.form.editDescription":"features.business.user.form.createDescription")})]}),e.jsx(Te,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(R),className:"flex-1 overflow-y-auto pr-2 space-y-4 min-h-0",children:[!o&&e.jsx(v,{control:u.control,name:"avatarURL",render:({field:a})=>e.jsxs(D,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(y,{className:"text-right",children:t("features.business.user.form.fields.avatarURL")}),e.jsx(N,{children:e.jsx("button",{type:"button",onClick:()=>f(!0),className:"flex items-center justify-center h-14 w-14 rounded-full border-2 border-dashed border-muted-foreground/30 bg-muted/50 hover:border-primary/50 hover:bg-muted transition-colors cursor-pointer overflow-hidden focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2",children:a.value?e.jsx("img",{src:a.value,alt:"",className:"h-full w-full object-cover"}):e.jsx(ze,{className:"h-7 w-7 text-muted-foreground"})})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(v,{control:u.control,name:"username",render:({field:a})=>e.jsxs(D,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(y,{className:"text-right",children:t("features.business.user.form.fields.username")}),e.jsx(N,{children:e.jsx(L,{placeholder:t("features.business.user.form.fields.usernamePlaceholder"),...a,disabled:o})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(v,{control:u.control,name:"nickname",render:({field:a})=>e.jsxs(D,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(y,{className:"text-right",children:t("features.business.user.form.fields.nickname")}),e.jsx(N,{children:e.jsx(L,{placeholder:t("features.business.user.form.fields.nicknamePlaceholder"),...a})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(v,{control:u.control,name:"password",render:({field:a})=>e.jsxs(D,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(y,{className:"text-right",children:t("features.business.user.form.fields.password")}),e.jsx(N,{children:e.jsx(Me,{placeholder:t(o?"features.business.user.form.fields.passwordEditPlaceholder":"features.business.user.form.fields.passwordPlaceholder"),...a})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(v,{control:u.control,name:"phone",render:({field:a})=>e.jsxs(D,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(y,{className:"text-right",children:t("features.business.user.form.fields.phone")}),e.jsx(N,{children:e.jsx(L,{placeholder:t("features.business.user.form.fields.phonePlaceholder"),...a})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(v,{control:u.control,name:"email",render:({field:a})=>e.jsxs(D,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(y,{className:"text-right",children:t("features.business.user.form.fields.email")}),e.jsx(N,{children:e.jsx(L,{type:"email",placeholder:t("features.business.user.form.fields.emailPlaceholder"),...a})}),e.jsx(C,{className:"col-start-2"})]})}),e.jsx(v,{control:u.control,name:"projectID",render:({field:a})=>e.jsxs(D,{className:"grid grid-cols-[140px_1fr] items-center gap-4 space-y-0",children:[e.jsx(y,{className:"text-right",children:t("features.business.user.form.fields.project")}),e.jsxs(X,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,disabled:o,children:[e.jsx(N,{children:e.jsx(Y,{children:e.jsx(ee,{placeholder:t("features.business.user.form.fields.projectPlaceholder")})})}),e.jsx(se,{children:K.map(x=>e.jsx(M,{value:x.projectID,children:x.title},x.projectID))})]}),e.jsx(C,{className:"col-start-2"})]})})]})}),e.jsxs(Ke,{className:"shrink-0 pt-4 border-t mt-4",children:[e.jsx(F,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:l,children:t("features.business.user.form.cancel")}),e.jsx(F,{type:"button",disabled:l,onClick:u.handleSubmit(R),children:t(l?"features.business.user.form.submitting":o?"features.business.user.form.save":"features.business.user.form.create")})]})]}),e.jsx(qe,{open:I,onOpenChange:f,onSelect:a=>{u.setValue("avatarURL",a.url,{shouldValidate:!0}),f(!1)},type:1,title:t("features.business.user.form.fields.selectAvatarDialogTitle"),description:t("features.business.user.form.fields.selectAvatarDialogDesc")})]})}function h({label:r,value:m}){return e.jsxs("div",{className:"flex py-2 border-b border-border/50 last:border-0",children:[e.jsx("span",{className:"w-24 shrink-0 text-muted-foreground text-sm",children:r}),e.jsx("span",{className:"text-sm break-all",children:m??"-"})]})}function Je({open:r,onOpenChange:m,userID:c}){const{t:i}=q(),{data:l,isLoading:t,error:o}=T({queryKey:["userDetail",c],queryFn:()=>Ee(c),enabled:r&&!!c});function I(f){return i(f==="M"?"features.business.user.sex.male":f==="F"?"features.business.user.sex.female":"features.business.user.sex.unknown")}return e.jsx(re,{open:r,onOpenChange:m,children:e.jsxs(ae,{className:"sm:max-w-[425px] max-h-[80vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsx(ne,{children:i("features.business.user.detail.title")})}),t&&e.jsx("div",{className:"py-8 text-center text-muted-foreground text-sm",children:i("features.business.user.loading")}),o&&e.jsx("div",{className:"py-8 text-center text-destructive text-sm",children:i("features.business.user.loadError")}),l&&!t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs(G,{className:"h-20 w-20",children:[e.jsx(J,{src:l.avatarURL,alt:l.nickname}),e.jsx(W,{className:"text-lg",children:l.username?.charAt(0)?.toUpperCase()||"U"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-lg",children:l.nickname}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["@",l.username]})]})]}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-0",children:[e.jsx(h,{label:i("features.business.user.detail.userID"),value:l.userID}),e.jsx(h,{label:i("features.business.user.detail.email"),value:l.email}),e.jsx(h,{label:i("features.business.user.detail.phone"),value:l.phone}),e.jsx(h,{label:i("features.business.user.detail.sex"),value:I(l.sex||"")}),e.jsx(h,{label:i("features.business.user.detail.projectID"),value:l.projectID}),e.jsx(h,{label:i("features.business.user.detail.status"),value:l.status}),e.jsx(h,{label:i("features.business.user.detail.birthday"),value:l.birthday}),e.jsx(h,{label:i("features.business.user.detail.point"),value:l.point}),e.jsx(h,{label:i("features.business.user.detail.createdAt"),value:l.createdAt})]})]})]})})}function We(){const{t:r}=q(),m=De(),[c,i]=d.useState(null),[l,t]=d.useState(null),[o,I]=d.useState(null),[f,A]=d.useState([]),[g,K]=d.useState({pageIndex:0,pageSize:10}),[u,R]=d.useState([]),[a,x]=d.useState({projectID:!1}),{data:le}=T({queryKey:["projectList",{current:1,pageNum:1,pageSize:1e3}],queryFn:()=>ie({current:1,pageNum:1,pageSize:1e3})}),oe=le?.projects||[],z=d.useMemo(()=>{const s=S=>{const P=f.find(be=>be.id===S);return P?.value&&Array.isArray(P.value)?P.value[0]||"":P?.value||""},n=s("userID"),w=s("projectID");return{current:1,userID:n||void 0,projectID:w||void 0,pageNum:g.pageIndex+1,pageSize:g.pageSize}},[f,g]),{data:E,isLoading:ue,error:ce}=T({queryKey:["userList",z],queryFn:()=>Oe(z),placeholderData:ye}),me=E?.users||[],de=E?.total||0,fe=Math.ceil(de/g.pageSize),pe=s=>{if(!s)return"-";try{return s.replace(" "," ")}catch{return s}},xe=s=>s||"-",he=s=>r(s==="M"?"features.business.user.sex.male":s==="F"?"features.business.user.sex.female":"features.business.user.sex.unknown"),U=d.useMemo(()=>[{accessorKey:"projectID",header:()=>null,cell:()=>null,enableHiding:!1,enableSorting:!1,enableColumnFilter:!0},{accessorKey:"avatarURL",header:r("features.business.user.columns.avatar"),cell:({row:s})=>{const n=s.getValue("avatarURL");return e.jsxs(G,{className:"h-10 w-10",children:[e.jsx(J,{src:n,alt:r("features.business.user.columns.avatar")}),e.jsx(W,{children:s.original.username?.charAt(0)?.toUpperCase()||"U"})]})}},{accessorKey:"userID",header:({column:s})=>e.jsx(b,{column:s,title:r("features.business.user.columns.id")}),cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.getValue("userID")})},{accessorKey:"createdAt",header:({column:s})=>e.jsx(b,{column:s,title:r("features.business.user.columns.createdAt")}),cell:({row:s})=>{const n=s.getValue("createdAt");return e.jsx("div",{children:pe(n)})}},{accessorKey:"username",header:({column:s})=>e.jsx(b,{column:s,title:r("features.business.user.columns.username")}),cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.getValue("username")})},{accessorKey:"nickname",header:({column:s})=>e.jsx(b,{column:s,title:r("features.business.user.columns.nickname")}),cell:({row:s})=>e.jsx("div",{children:s.getValue("nickname")})},{accessorKey:"point",header:({column:s})=>e.jsx(b,{column:s,title:r("features.business.user.columns.point")}),cell:({row:s})=>{const n=s.getValue("point");return e.jsx("div",{children:n||0})}},{accessorKey:"birthday",header:({column:s})=>e.jsx(b,{column:s,title:r("features.business.user.columns.birthday")}),cell:({row:s})=>{const n=s.getValue("birthday");return e.jsx("div",{children:xe(n)})}},{accessorKey:"sex",header:({column:s})=>e.jsx(b,{column:s,title:r("features.business.user.columns.sex")}),cell:({row:s})=>{const n=s.getValue("sex");return e.jsx("div",{children:he(n)})}},{id:"actions",header:r("features.business.user.columns.actions"),cell:({row:s})=>{const n=s.original;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Q,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>I(n.userID),children:e.jsx(Qe,{className:"h-4 w-4"})})}),e.jsx($,{children:r("features.business.user.actions.view")})]}),e.jsxs(Q,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>{t(n),i("edit")},children:e.jsx(Ne,{className:"h-4 w-4"})})}),e.jsx($,{children:r("features.business.user.actions.edit")})]})]})},enableHiding:!1,meta:{className:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",thClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]",tdClassName:"sticky right-0 bg-background z-10 shadow-[inset_-1px_0_0_0_hsl(var(--border))]"}}],[i,r]),j=Ce({data:me,columns:U,getCoreRowModel:we(),getSortedRowModel:Ie(),manualPagination:!0,pageCount:fe,onSortingChange:R,onColumnFiltersChange:A,onColumnVisibilityChange:x,onPaginationChange:K,state:{sorting:u,columnFilters:f,columnVisibility:a,pagination:g}}),H=O({mutationFn:s=>He(s),onSuccess:()=>{V.success(r("features.business.user.createSuccess")),m.invalidateQueries({queryKey:["userList"]}),i(null),t(null)},onError:s=>{V.error(r("features.business.user.createError",{error:s.message}))}}),B=O({mutationFn:s=>Be(s),onSuccess:()=>{V.success(r("features.business.user.updateSuccess")),m.invalidateQueries({queryKey:["userList"]}),i(null),t(null)},onError:s=>{V.error(r("features.business.user.updateError",{error:s.message}))}}),je=()=>{t(null),i("create")},ge=s=>{c==="create"?H.mutate(s):c==="edit"&&B.mutate(s)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between px-4 pt-4",children:e.jsx(ke,{title:r("features.business.user.title"),description:r("features.business.user.description"),children:e.jsxs(F,{onClick:je,children:[e.jsx(Se,{className:"h-4 w-4"}),r("features.business.user.createButton")]})})}),e.jsxs("div",{className:"rounded-md border p-6 mx-4",children:[e.jsx("div",{className:"space-y-2 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(L,{type:"text",placeholder:r("features.business.user.search.userID"),value:j.getColumn("userID")?.getFilterValue()??"",onChange:s=>j.getColumn("userID")?.setFilterValue(s.target.value),className:"h-8 w-[150px]"}),e.jsxs(X,{value:j.getColumn("projectID")?.getFilterValue()||"all",onValueChange:s=>j.getColumn("projectID")?.setFilterValue(s==="all"?void 0:s),children:[e.jsx(Y,{className:"h-8 w-[180px]",children:e.jsx(ee,{placeholder:r("features.business.user.search.project")})}),e.jsxs(se,{children:[e.jsx(M,{value:"all",children:r("features.business.user.search.allProjects")}),oe.map(s=>e.jsx(M,{value:s.projectID,children:s.title},s.projectID))]})]})]})}),e.jsxs(Le,{children:[e.jsx(Fe,{children:j.getHeaderGroups().map(s=>e.jsx(k,{children:s.headers.map(n=>{const w=n.isPlaceholder?null:typeof n.column.columnDef.header=="function"?n.column.columnDef.header(n.getContext()):n.column.columnDef.header,S=n.column.columnDef.meta;return e.jsx(Re,{className:S?.thClassName,children:w},n.id)})},s.id))}),e.jsx(Ue,{children:ue?e.jsx(k,{children:e.jsx(_,{colSpan:U.length,className:"h-24 text-center",children:r("features.business.user.loading")})}):ce?e.jsx(k,{children:e.jsx(_,{colSpan:U.length,className:"h-24 text-center text-destructive",children:r("features.business.user.loadError")})}):j.getRowModel().rows?.length?j.getRowModel().rows.map(s=>e.jsx(k,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(n=>{const w=typeof n.column.columnDef.cell=="function"?n.column.columnDef.cell(n.getContext()):n.column.columnDef.cell,S=n.column.columnDef.meta;return e.jsx(_,{className:S?.tdClassName,children:w},n.id)})},s.id)):e.jsx(k,{children:e.jsx(_,{colSpan:U.length,className:"h-24 text-center",children:r("features.business.user.noData")})})})]}),e.jsx(Pe,{table:j})]}),e.jsx(Ge,{open:c!==null,onOpenChange:s=>{s||(i(null),t(null))},user:l,onSubmit:ge,isLoading:c==="create"?H.isPending:B.isPending}),e.jsx(Je,{open:!!o,onOpenChange:s=>!s&&I(null),userID:o})]})}const Rs=We;export{Rs as component};
